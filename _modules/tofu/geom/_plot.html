<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>tofu.geom._plot &#8212; tofu v1.4</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          tofu</a>
        <span class="navbar-text navbar-version pull-left"><b>1.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../installation.html">Installation</a></li>
                <li><a href="../../../contributing.html">Contributing</a></li>
                <li><a href="../../../auto_examples/index.html">Gallery</a></li>
                <li><a href="../../../aboutus.html">About</a></li>
                <li><a href="../../../releases.html">Releases</a></li>
                <li><a href="../../../tofu.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">How to install tofu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">A guide to contributing to tofu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/tutorials/tuto_plot_gallery_fusion_machines.html">A list of all different device configurations available (ITER, WEST, JET, ...)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/index.html">Tutorials and examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu_from_bash.html">Using tofu from a bash terminal</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.html">tofu package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.geom.html">tofu.geom package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.dumpro.html">tofu.dumpro package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.data.html">tofu.data package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.dust.html">tofu.dust package</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for tofu.geom._plot</h1><div class="highlight"><pre>
<span></span><span class="c1"># Built-in</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">itt</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="c1"># Generic common libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span> <span class="k">as</span> <span class="n">mPolygon</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Wedge</span> <span class="k">as</span> <span class="n">mWedge</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span>  <span class="n">Rectangle</span> <span class="k">as</span> <span class="n">mRectangle</span>
<span class="kn">from</span> <span class="nn">matplotlib.axes._axes</span> <span class="kn">import</span> <span class="n">Axes</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="c1"># ToFu-specific</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tofu.version</span> <span class="kn">import</span> <span class="n">__version__</span>
    <span class="kn">import</span> <span class="nn">tofu.utils</span> <span class="k">as</span> <span class="nn">utils</span>
    <span class="kn">import</span> <span class="nn">tofu.geom._def</span> <span class="k">as</span> <span class="nn">_def</span>
    <span class="kn">import</span> <span class="nn">tofu.geom._GG</span> <span class="k">as</span> <span class="nn">_GG</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tofu.version</span> <span class="kn">import</span> <span class="n">__version__</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">utils</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_def</span> <span class="k">as</span> <span class="n">_def</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_GG</span> <span class="k">as</span> <span class="n">_GG</span>


<span class="c1">#__author_email__ = &#39;didier.vezinet@cea.fr&#39;</span>
<span class="n">_fontsize</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">_labelpad</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">__github</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/ToFuProject/tofu/issues&#39;</span>
<span class="n">_wintit</span> <span class="o">=</span> <span class="s1">&#39;tofu-</span><span class="si">%s</span><span class="s1">        report issues / requests at </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="n">__github</span><span class="p">)</span>
<span class="n">_nchMax</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_cdef</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
<span class="n">_cbck</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">_lcch</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">]]</span>

<span class="c1"># Generic</span>
<span class="k">def</span> <span class="nf">_check_Lax</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="n">lax</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">lax</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span><span class="n">Axes</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lax</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c2</span><span class="p">:</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">aa</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">aa</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span><span class="n">Axes</span><span class="p">)</span> <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">lax</span><span class="p">])</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lax</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">c0</span> <span class="ow">or</span> <span class="n">c1</span><span class="p">,</span> <span class="s2">&quot;Arg ax must be None or a plt.Axes instance !&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">c0</span> <span class="ow">or</span> <span class="n">c1</span> <span class="ow">or</span> <span class="n">c2</span><span class="p">,</span> <span class="s2">&quot;Arg lax must be an Axes or a list/tuple of such !&quot;</span>
        <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
            <span class="n">lax</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">lax</span> <span class="o">=</span> <span class="p">[</span><span class="n">lax</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">c2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lax</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lax</span> <span class="o">=</span> <span class="p">[</span><span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lax</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>





<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                        Ves class and functions</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">############################################</span>
<span class="c1">##### Plotting functions</span>
<span class="c1">############################################</span>


<span class="k">def</span> <span class="nf">_Struct_plot_format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwdargs</span><span class="p">):</span>

    <span class="c1"># Local default</span>
    <span class="n">defplot</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cross&#39;</span><span class="p">:{</span><span class="s1">&#39;Elt&#39;</span><span class="p">:</span><span class="s1">&#39;PIBsBvV&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;dP&#39;</span><span class="p">:{</span><span class="s1">&#39;empty&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorPd</span> <span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">StructPd</span><span class="p">},</span>
                        <span class="s1">&#39;dI&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorId</span><span class="p">,</span>
                        <span class="s1">&#39;dBs&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBsd</span><span class="p">,</span>
                        <span class="s1">&#39;dBv&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBvd</span><span class="p">,</span>
                        <span class="s1">&#39;dVect&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorVind</span><span class="p">},</span>
               <span class="s1">&#39;hor&#39;</span><span class="p">:{</span><span class="s1">&#39;Elt&#39;</span><span class="p">:</span><span class="s1">&#39;PIBsBvV&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;dP&#39;</span><span class="p">:{</span><span class="s1">&#39;empty&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorPd</span> <span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">StructPd_Tor</span><span class="p">},</span>
                      <span class="s1">&#39;dI&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorITord</span><span class="p">,</span>
                      <span class="s1">&#39;dBs&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBsTord</span><span class="p">,</span>
                      <span class="s1">&#39;dBv&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBvTord</span><span class="p">,</span>
                      <span class="s1">&#39;Nstep&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorNTheta</span><span class="p">},</span>
               <span class="s1">&#39;3d&#39;</span><span class="p">:{</span><span class="s1">&#39;Elt&#39;</span><span class="p">:</span><span class="s1">&#39;P&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;dP&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span>
                           <span class="s1">&#39;rstride&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;cstride&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                           <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;antialiased&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                     <span class="s1">&#39;Lim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                     <span class="s1">&#39;Nstep&#39;</span><span class="p">:</span><span class="n">_def</span><span class="o">.</span><span class="n">TorNTheta</span><span class="p">}}</span>

    <span class="c1"># Select keys for proj</span>
    <span class="n">lproj</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span><span class="s1">&#39;hor&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;all&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="n">proj</span><span class="p">]</span>

    <span class="c1"># Match with kwdargs</span>
    <span class="n">dk</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dk</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defplot</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="n">dk</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;Hor&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defplot</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="n">dk</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="s1">&#39;Elt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Elt&#39;</span>
    <span class="n">dk</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="s1">&#39;dP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dP&#39;</span>
    <span class="n">dk</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="s1">&#39;Nstep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Nstep&#39;</span>
    <span class="n">dk</span><span class="p">[</span><span class="s1">&#39;3d&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defplot</span><span class="p">[</span><span class="s1">&#39;3d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

    <span class="c1"># Rename keys (retro-compatibility)</span>
    <span class="n">lrepl</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Elt&#39;</span><span class="p">,</span><span class="s1">&#39;Elt&#39;</span><span class="p">),(</span><span class="s1">&#39;dP&#39;</span><span class="p">,</span><span class="s1">&#39;Pdict&#39;</span><span class="p">),(</span><span class="s1">&#39;dI&#39;</span><span class="p">,</span><span class="s1">&#39;Idict&#39;</span><span class="p">),(</span><span class="s1">&#39;dBs&#39;</span><span class="p">,</span><span class="s1">&#39;Bsdict&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;dBv&#39;</span><span class="p">,</span><span class="s1">&#39;Bvdict&#39;</span><span class="p">),(</span><span class="s1">&#39;dVect&#39;</span><span class="p">,</span><span class="s1">&#39;Vdict&#39;</span><span class="p">),(</span><span class="s1">&#39;dIHor&#39;</span><span class="p">,</span><span class="s1">&#39;IdictHor&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;dBsHor&#39;</span><span class="p">,</span><span class="s1">&#39;BsdictHor&#39;</span><span class="p">),(</span><span class="s1">&#39;dBvHor&#39;</span><span class="p">,</span><span class="s1">&#39;BvdictHor&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Nstep&#39;</span><span class="p">,</span><span class="s1">&#39;Nstep&#39;</span><span class="p">),(</span><span class="s1">&#39;Lim&#39;</span><span class="p">,</span><span class="s1">&#39;Lim&#39;</span><span class="p">)]</span>
    <span class="n">dnk</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lrepl</span><span class="p">)</span>

    <span class="c1"># Map out dict</span>
    <span class="n">dout</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">lproj</span><span class="p">:</span>
        <span class="n">dout</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defplot</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">kwdargs</span><span class="p">[</span><span class="n">dk</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">k</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ss</span><span class="o">.</span><span class="n">_dplot</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">dout</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">dnk</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">_dplot</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;dP&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Ves&#39;</span><span class="p">:</span>
                            <span class="n">dout</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">dnk</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defplot</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;empty&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dout</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">dnk</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defplot</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;full&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dout</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">dnk</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defplot</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dout</span><span class="p">[</span><span class="n">pp</span><span class="p">][</span><span class="n">dnk</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">return</span> <span class="n">dout</span>



<div class="viewcode-block" id="Struct_plot"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.Struct_plot">[docs]</a><span class="k">def</span> <span class="nf">Struct_plot</span><span class="p">(</span><span class="n">lS</span><span class="p">,</span> <span class="n">lax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">dI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dBs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dBv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">dVect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dIHor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dBsHor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dBvHor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">Lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Nstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot the projections of a list of Struct subclass instances</span>

<span class="sd">    D. VEZINET, Aug. 2014</span>
<span class="sd">    Inputs :</span>
<span class="sd">        V           A Ves instance</span>
<span class="sd">        Nstep      An int (the number of points for evaluation of theta by np.linspace)</span>
<span class="sd">        axP         A plt.Axes instance (if given) on which to plot the poloidal projection, otherwise (&#39;None&#39;) a new figure/axes is created</span>
<span class="sd">        axT         A plt.Axes instance (if given) on which to plot the toroidal projection, otherwise (&#39;None&#39;) a new figure/axes is created</span>
<span class="sd">        Tdict       A dictionnary specifying the style of the polygon plot</span>
<span class="sd">        dLeg     A dictionnary specifying the style of the legend box (if None =&gt; no legend)</span>
<span class="sd">    Outputs :</span>
<span class="sd">        axP          The plt.Axes instance on which the poloidal plot was performed</span>
<span class="sd">        axT          The plt.Axes instance on which the toroidal plot was performed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Arg proj must be in [&#39;cross&#39;,&#39;hor&#39;,&#39;all&#39;,&#39;3d&#39;] !&quot;</span>
        <span class="k">assert</span> <span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="s1">&#39;3d&#39;</span><span class="p">],</span> <span class="n">msg</span>
        <span class="n">lax</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">_check_Lax</span><span class="p">(</span><span class="n">lax</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;Arg draw must be a bool !&quot;</span>

    <span class="n">C0</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">lS</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">ToFuObject</span><span class="p">)</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lS</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
          <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">ToFuObject</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">lS</span><span class="p">]))</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Arg lves must be a Struct subclass or a list of such !&quot;</span>
    <span class="k">assert</span> <span class="n">C0</span> <span class="ow">or</span> <span class="n">C1</span><span class="p">,</span> <span class="n">msg</span>
    <span class="k">if</span> <span class="n">C0</span><span class="p">:</span>
        <span class="n">lS</span> <span class="o">=</span> <span class="p">[</span><span class="n">lS</span><span class="p">]</span>
    <span class="n">nS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>

    <span class="n">kwa</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;3d&#39;</span><span class="p">:</span>
        <span class="c1"># Temporary matplotlib issue</span>
        <span class="n">dLeg</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span>  <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nS</span><span class="p">):</span>
        <span class="n">dplot</span> <span class="o">=</span> <span class="n">_Struct_plot_format</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">proj</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="n">Elt</span><span class="o">=</span><span class="n">element</span><span class="p">,</span>
                                    <span class="n">dP</span><span class="o">=</span><span class="n">dP</span><span class="p">,</span> <span class="n">dI</span><span class="o">=</span><span class="n">dI</span><span class="p">,</span> <span class="n">dBs</span><span class="o">=</span><span class="n">dBs</span><span class="p">,</span>
                                    <span class="n">dBv</span><span class="o">=</span><span class="n">dBv</span><span class="p">,</span> <span class="n">dVect</span><span class="o">=</span><span class="n">dVect</span><span class="p">,</span> <span class="n">dIHor</span><span class="o">=</span><span class="n">dIHor</span><span class="p">,</span>
                                    <span class="n">dBsHor</span><span class="o">=</span><span class="n">dBsHor</span><span class="p">,</span> <span class="n">dBvHor</span><span class="o">=</span><span class="n">dBvHor</span><span class="p">,</span>
                                    <span class="n">Lim</span><span class="o">=</span><span class="n">Lim</span><span class="p">,</span> <span class="n">Nstep</span><span class="o">=</span><span class="n">Nstep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dplot</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dplot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwa</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;3d&#39;</span><span class="p">:</span>
            <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Plot_3D_plt_Ves</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LegDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">dplot</span><span class="p">[</span><span class="n">proj</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;cross&#39;</span><span class="p">:</span>
                <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Plot_CrossProj_Ves</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">LegDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                             <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">dplot</span><span class="p">[</span><span class="n">proj</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;hor&#39;</span><span class="p">:</span>
                <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Plot_HorProj_Ves</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">LegDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">dplot</span><span class="p">[</span><span class="n">proj</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_def</span><span class="o">.</span><span class="n">Plot_LOSProj_DefAxes</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                                                         <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                                         <span class="n">Type</span><span class="o">=</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">))</span>
                <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Plot_CrossProj_Ves</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LegDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                             <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
                                             <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">dplot</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">])</span>
                <span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Plot_HorProj_Ves</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">LegDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
                                           <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">dplot</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">])</span>

    <span class="c1"># recompute the ax.dataLim</span>
    <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
    <span class="c1"># update ax.viewLim using the new dataLim</span>
    <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">tit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">dLeg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
        <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lax</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
            <span class="n">lax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
        <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">lax</span> <span class="o">=</span> <span class="n">lax</span> <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;all&#39;</span> <span class="k">else</span> <span class="n">lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lax</span></div>



<span class="k">def</span> <span class="nf">_Plot_CrossProj_Ves</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Elt</span><span class="o">=</span><span class="s1">&#39;PIBsBvV&#39;</span><span class="p">,</span>
                        <span class="n">Pdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorPd</span><span class="p">,</span> <span class="n">Idict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorId</span><span class="p">,</span> <span class="n">Bsdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBsd</span><span class="p">,</span>
                        <span class="n">Bvdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBvd</span><span class="p">,</span> <span class="n">Vdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorVind</span><span class="p">,</span>
                        <span class="n">LegDict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot the poloidal projection of a Ves instance</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        V       :   tfg.Ves / tfg.Struct</span>
<span class="sd">            A Ves instance</span>
<span class="sd">        ax      :   None / plt.Axes</span>
<span class="sd">            A plt.Axes instance (if given) on which to plot, otherwise (&#39;None&#39;) a new figure/axes is created</span>
<span class="sd">        Pdict   :   dict</span>
<span class="sd">            A dictionnary specifying the style of the polygon plot</span>
<span class="sd">        LegDict :   None / dict</span>
<span class="sd">            A dictionnary specifying the style of the legend box (if None =&gt; no legend)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        ax          The plt.Axes instance on which the plot was performed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">_check_Lax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Pdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;Arg Pdict should be a dictionary !&#39;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Idict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg Idict should be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Bsdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg Bsdict should be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Bvdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg Bvdict should be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Vdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg Vdict should be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">LegDict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">LegDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Arg LegDict should be a dictionary !&#39;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span>
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">Elt</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_LOSProj_DefAxes</span><span class="p">(</span><span class="s1">&#39;Cross&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                                       <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">Elt</span> <span class="ow">or</span> <span class="s1">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">P_closed</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">Poly_closed</span>
    <span class="k">if</span> <span class="s1">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">Elt</span> <span class="ow">or</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">midX</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">P_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">midY</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_closed</span><span class="p">[</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">P_closed</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">VInX</span><span class="p">,</span> <span class="n">VInY</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;VIn&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;VIn&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">_InOut</span><span class="o">==</span><span class="s1">&#39;in&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">P_closed</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">,</span><span class="o">**</span><span class="n">Pdict</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">_InOut</span><span class="o">==</span><span class="s1">&#39;out&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mPolygon</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Poly</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">,</span> <span class="o">**</span><span class="n">Pdict</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;self._InOut not defined !&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;I&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">V</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="o">+</span><span class="s2">&quot; Imp&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">Idict</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Bs&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryS&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="o">+</span><span class="s2">&quot; Bs&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">Bsdict</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Bv&#39;</span> <span class="ow">in</span> <span class="n">Elt</span> <span class="ow">and</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryV&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="o">+</span><span class="s2">&quot; Bv&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">Bvdict</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">midX</span><span class="p">,</span> <span class="n">midY</span><span class="p">,</span> <span class="n">VInX</span><span class="p">,</span> <span class="n">VInY</span><span class="p">,</span>
                  <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span>
                  <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="o">+</span><span class="s2">&quot; Vin&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">Vdict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;nP&#39;</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">midX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">midY</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
                        <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">midX</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mf">0.01</span><span class="o">*</span><span class="n">VInX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                  <span class="n">midY</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mf">0.01</span><span class="o">*</span><span class="n">VInY</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">LegDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">LegDict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>




<span class="k">def</span> <span class="nf">_Plot_HorProj_Ves</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Elt</span><span class="o">=</span><span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="n">Nstep</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorNTheta</span><span class="p">,</span>
                      <span class="n">Pdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorPd</span><span class="p">,</span> <span class="n">Idict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorITord</span><span class="p">,</span>
                      <span class="n">Bsdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBsTord</span><span class="p">,</span> <span class="n">Bvdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorBvTord</span><span class="p">,</span>
                      <span class="n">LegDict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plotting the toroidal projection of a Ves instance</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        V           A Ves instance</span>
<span class="sd">        Nstep      An int (the number of points for evaluation of theta by np.linspace)</span>
<span class="sd">        ax          A plt.Axes instance (if given) on which to plot, otherwise (&#39;None&#39;) a new figure/axes is created</span>
<span class="sd">        Tdict       A dictionnary specifying the style of the polygon plot</span>
<span class="sd">        LegDict     A dictionnary specifying the style of the legend box (if None =&gt; no legend)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        ax          The plt.Axes instance on which the plot was performed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Nstep</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">_check_Lax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Pdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;Arg Pdict should be a dictionary !&#39;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Idict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;Arg Idict should be a dictionary !&#39;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">LegDict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">LegDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Arg LegDict should be a dictionary !&#39;</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_LOSProj_DefAxes</span><span class="p">(</span><span class="s1">&#39;Hor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span>
                                       <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">)</span>
    <span class="n">P1Min</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;P1Min&#39;</span><span class="p">]</span>
    <span class="n">P1Max</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;P1Max&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">_InOut</span><span class="o">==</span><span class="s1">&#39;in&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
                <span class="n">Theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">Nstep</span><span class="p">,</span>
                                    <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retstep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">lx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]),</span>
                                     <span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)))</span>
                <span class="n">ly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]),</span>
                                     <span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">:</span>
                <span class="n">lx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">ly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">,</span><span class="o">**</span><span class="n">Pdict</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">_InOut</span><span class="o">==</span><span class="s1">&#39;out&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
                <span class="n">Theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">Nstep</span><span class="p">,</span>
                                    <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retstep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">noccur</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">lx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">),</span>
                                         <span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
                    <span class="n">ly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">),</span>
                                         <span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
                    <span class="n">Lp</span> <span class="o">=</span> <span class="p">[</span><span class="n">mPolygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">,</span> <span class="o">**</span><span class="n">Pdict</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Lp</span> <span class="o">=</span> <span class="p">[</span><span class="n">mWedge</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                 <span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                 <span class="n">width</span><span class="o">=</span><span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">,</span> <span class="o">**</span><span class="n">Pdict</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">:</span>
                    <span class="n">ly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1Max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1Min</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">Lp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">)):</span>
                        <span class="n">lx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                        <span class="n">Lp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mPolygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                           <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">Pdict</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">Lp</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown self._InOut !&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;I&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
            <span class="n">ly</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">)])</span>
            <span class="n">ly</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="o">+</span><span class="s2">&quot; Imp&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">Idict</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Bs&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
            <span class="n">ly</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">)])</span>
            <span class="n">ly</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="o">+</span><span class="s2">&quot; Bs&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">Bsdict</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Bv&#39;</span> <span class="ow">in</span> <span class="n">Elt</span> <span class="ow">and</span> <span class="n">V</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
        <span class="n">lx</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ly</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;BaryV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="o">+</span><span class="s2">&quot; Bv&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">Bvdict</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">indices</span> <span class="ow">and</span> <span class="n">V</span><span class="o">.</span><span class="n">noccur</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">V</span><span class="o">.</span><span class="n">noccur</span><span class="p">):</span>
                <span class="n">R</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;P1Max&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">),</span>
                            <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mf">0.02</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
                                      <span class="n">Y</span><span class="o">+</span><span class="mf">0.02</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">V</span><span class="o">.</span><span class="n">noccur</span><span class="p">):</span>
                <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> <span class="n">V</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;P1Max&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">),</span>
                            <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">+</span><span class="mf">0.02</span><span class="p">),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">LegDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">LegDict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>



<span class="k">def</span> <span class="nf">_Plot_3D_plt_Ves</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Elt</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">Lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">Nstep</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">Tor3DThetamin</span><span class="p">,</span> <span class="n">Pdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorP3Dd</span><span class="p">,</span>
                     <span class="n">LegDict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span>
                     <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Arg ax should a plt.Axes instance !&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">Axes3D</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msg</span>
        <span class="k">assert</span> <span class="n">Lim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">Lim</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Lim</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;Arg Lim should be an iterable of 2 elements !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Pdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">LegDict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">LegDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Args Pdict and LegDict should be dictionnaries !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Elt</span><span class="p">)</span><span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Arg Elt must be a str !&quot;</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_3D_plt_Tor_DefAxes</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">:</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">)</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">lim</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">if</span> <span class="n">lim</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">lim</span>
        <span class="k">if</span> <span class="n">Lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">lim</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lim</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="nb">min</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]])</span> <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">noccur</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Lim</span><span class="p">)</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">lim</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">if</span> <span class="n">lim</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">lim</span>
        <span class="k">if</span> <span class="n">Lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Ves&#39;</span><span class="p">:</span>
            <span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">Lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">lim</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">Lim</span>
    <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">lim</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">Nstep</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">Nstep</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Poly_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Poly_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Poly_closed</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">V</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">Nstep</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="o">.</span><span class="n">Poly_closed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Poly_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">Nstep</span><span class="p">)))</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Poly_closed</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">Nstep</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">,</span> <span class="o">**</span><span class="n">Pdict</span><span class="p">)</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">Pdict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>
        <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">def Plot_3D_mlab_Tor(T,fig=&#39;None&#39;,thetaLim=(np.pi/2,2*np.pi),Tdict=Dict_3D_mlab_Tor_Def,LegDict=LegDict_Def):</span>

<span class="sd">    if fig==&#39;None&#39;:</span>
<span class="sd">        fig = Plot_3D_mlab_Tor_DefFig()</span>
<span class="sd">    thetamin = np.pi/20</span>
<span class="sd">    N = np.ceil((thetaLim[1]-thetaLim[0])/thetamin)</span>
<span class="sd">    theta = np.linspace(thetaLim[0],thetaLim[1],N).reshape((1,N))</span>
<span class="sd">    X = np.dot(T.Poly[0:1,:].T,np.cos(theta))</span>
<span class="sd">    Y = np.dot(T.Poly[0:1,:].T,np.sin(theta))</span>
<span class="sd">    Z = np.dot(T.POly[1:2,:].T,np.ones(theta.shape))</span>
<span class="sd">    Theta = np.dot(np.ones(T.Poly[1:2,:].T.shape),theta)</span>
<span class="sd">    S = mlab.mesh(X,Y,Z,figure=fig,name=T.Id.NameLTX, scalars=Theta,**Tdict)</span>
<span class="sd">    mlab.orientation_axes(figure=fig)</span>
<span class="sd">    #mlab.axes(S)</span>
<span class="sd">    return fig,S</span>
<span class="sd">&quot;&quot;&quot;</span>




<div class="viewcode-block" id="Plot_Impact_PolProjPoly"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.Plot_Impact_PolProjPoly">[docs]</a><span class="k">def</span> <span class="nf">Plot_Impact_PolProjPoly</span><span class="p">(</span><span class="n">lS</span><span class="p">,</span> <span class="n">Leg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span>
                            <span class="n">Sketch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">dLeg</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plotting the toroidal projection of a Ves instance</span>

<span class="sd">    D. VEZINET, Aug. 2014</span>
<span class="sd">    Inputs :</span>
<span class="sd">        T           A Ves instance</span>
<span class="sd">        Leg         A str (the legend label to be used if T is not a Ves instance)</span>
<span class="sd">        ax          A plt.Axes instance (if given) on which to plot the projection space, otherwise (&#39;None&#39;) a new figure/axes is created</span>
<span class="sd">        Dict        A dictionnary specifying the style of the boundary polygon plot</span>
<span class="sd">        dLeg        A dictionnary specifying the style of the legend box</span>
<span class="sd">    Outputs :</span>
<span class="sd">        ax          The plt.Axes instance on which the poloidal plot was performed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="n">Lax</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">_check_Lax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">C0</span> <span class="ow">or</span> <span class="n">C1</span><span class="p">,</span> <span class="s1">&#39;Arg ax should a plt.Axes instance !&#39;</span>
        <span class="k">assert</span> <span class="n">dP</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">dP</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg dP must be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">dLeg</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg dLeg must be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="n">Ang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="s1">&#39;xi&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg Ang must be in [&#39;theta&#39;,&#39;xi&#39;] !&quot;</span>
        <span class="k">assert</span> <span class="n">AngUnit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span><span class="s1">&#39;deg&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg AngUnit must be in [&#39;rad&#39;,&#39;deg&#39;] !&quot;</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">lS</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">ToFuObject</span><span class="p">)</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lS</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
          <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">ToFuObject</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">lS</span><span class="p">]))</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Arg lves must be a Struct subclass or a list of such !&quot;</span>
    <span class="k">assert</span> <span class="n">C0</span> <span class="ow">or</span> <span class="n">C1</span><span class="p">,</span> <span class="n">msg</span>
    <span class="k">if</span> <span class="n">C0</span><span class="p">:</span>
        <span class="n">lS</span> <span class="o">=</span> <span class="p">[</span><span class="n">lS</span><span class="p">]</span>
    <span class="n">nS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lS</span><span class="p">)</span>

    <span class="c1"># Get Sketch</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">axsketch</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_Impact_DefAxes</span><span class="p">(</span><span class="s1">&#39;Cross&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                                <span class="n">Ang</span><span class="o">=</span><span class="n">Ang</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="n">AngUnit</span><span class="p">,</span>
                                                <span class="n">Sketch</span><span class="o">=</span><span class="n">Sketch</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dP</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">dP</span>

    <span class="c1"># Get up/down limits</span>
    <span class="n">pPmax</span><span class="p">,</span> <span class="n">pPmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">lS</span><span class="p">:</span>
        <span class="n">pmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;EnvMinMax&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">pmax</span><span class="o">&gt;</span><span class="n">pPmax</span><span class="p">:</span>
            <span class="n">pPmax</span> <span class="o">=</span> <span class="n">pmax</span>
        <span class="n">pmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;EnvMinMax&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">pmin</span><span class="o">&lt;</span><span class="n">pPmin</span><span class="p">:</span>
            <span class="n">pPmin</span> <span class="o">=</span> <span class="n">pmin</span>
    <span class="k">if</span> <span class="n">nS</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">DoUp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pPmin</span><span class="p">,</span><span class="n">pPmax</span><span class="p">)</span>
        <span class="n">nP</span> <span class="o">=</span> <span class="n">pmax</span><span class="o">.</span><span class="n">size</span>

    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nS</span><span class="p">):</span>

        <span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span> <span class="o">=</span> <span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;EnvTheta&#39;</span><span class="p">],</span> <span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;EnvMinMax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="n">pN</span> <span class="o">=</span> <span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;EnvMinMax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="k">if</span> <span class="n">Ang</span><span class="o">==</span><span class="s1">&#39;xi&#39;</span><span class="p">:</span>
            <span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">pN</span> <span class="o">=</span> <span class="n">_GG</span><span class="o">.</span><span class="n">ConvertImpact_Theta2Xi</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">pN</span><span class="p">)</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">Theta</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dP</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_InOut</span><span class="o">==</span><span class="s1">&#39;in&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">DoUp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nP</span><span class="p">,)),</span><span class="o">**</span><span class="n">dp</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">DoUp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nP</span><span class="p">,)),</span> <span class="n">pN</span><span class="p">,</span><span class="o">**</span><span class="n">dp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_InOut</span><span class="o">==</span><span class="s1">&#39;out&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">pN</span><span class="p">,</span> <span class="o">**</span><span class="n">dp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;self._InOut not defined for </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="s1">&#39;facecolor&#39;</span><span class="p">])</span>
        <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nS</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">DoUp</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="o">**</span><span class="n">dLeg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="c1"># Deprecated ?</span>
<div class="viewcode-block" id="Plot_Impact_3DPoly"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.Plot_Impact_3DPoly">[docs]</a><span class="k">def</span> <span class="nf">Plot_Impact_3DPoly</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Leg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorPAng</span><span class="p">,</span>
                       <span class="n">AngUnit</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorPAngUnit</span><span class="p">,</span> <span class="n">Pdict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorP3DFilld</span><span class="p">,</span>
                       <span class="n">dLeg</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plotting the toroidal projection of a Ves instance</span>

<span class="sd">    D. VEZINET, Aug. 2014</span>
<span class="sd">    Inputs :</span>
<span class="sd">        T           A Ves instance</span>
<span class="sd">        Leg         A str (the legend label to be used if T is not a Ves instance)</span>
<span class="sd">        ax          A plt.Axes instance (if given) on which to plot the projection space, otherwise (&#39;None&#39;) a new figure/axes is created</span>
<span class="sd">        Dict        A dictionnary specifying the style of the boundary polygon plot</span>
<span class="sd">        dLeg        A dictionnary specifying the style of the legend box</span>
<span class="sd">    Outputs :</span>
<span class="sd">        ax          The plt.Axes instance on which the poloidal plot was performed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">T</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Ves&#39;</span><span class="p">,</span><span class="s1">&#39;Struct&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;Arg T must be Ves instance or tuple with (Theta,pP,pN) 3 ndarrays !&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">Axes3D</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Arg ax must be a Axes instance !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Pdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg Pdict must be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">dLeg</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Arg dLeg must be a dictionary !&quot;</span>
        <span class="k">assert</span> <span class="n">Ang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="s1">&#39;xi&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg Ang must be in [&#39;theta&#39;,&#39;xi&#39;] !&quot;</span>
        <span class="k">assert</span> <span class="n">AngUnit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span><span class="s1">&#39;deg&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg AngUnit must be in [&#39;rad&#39;,&#39;deg&#39;] !&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_Impact_DefAxes</span><span class="p">(</span><span class="s1">&#39;3D&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">)</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Ves</span><span class="p">):</span>
        <span class="n">Leg</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span>
        <span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">pN</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">_Imp_EnvTheta</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">_Imp_EnvMinMax</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">T</span><span class="o">.</span><span class="n">_Imp_EnvMinMax</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;Args Theta, pP and pN should be np.ndarrays !&quot;</span>
        <span class="k">assert</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;Args Theta, pP and pN must have same shape !&quot;</span>
        <span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">pN</span> <span class="o">=</span> <span class="n">T</span>
    <span class="n">AngName</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\theta$&quot;</span>
    <span class="k">if</span> <span class="n">Ang</span><span class="o">==</span><span class="s1">&#39;xi&#39;</span><span class="p">:</span>
        <span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">pN</span> <span class="o">=</span> <span class="n">_GG</span><span class="o">.</span><span class="n">ConvertImpact_Theta2Xi</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">pP</span><span class="p">,</span> <span class="n">pN</span><span class="p">)</span>
        <span class="n">AngName</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\xi$&quot;</span>
    <span class="n">yDoUp</span><span class="p">,</span> <span class="n">zDoUp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_zlim</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">Theta</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">zDoUp</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">yP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">pP</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">zDoUp</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">yN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">pN</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">zDoUp</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">pP</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span><span class="n">zDoUp</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yP</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span><span class="o">**</span><span class="n">Pdict</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yN</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span><span class="o">**</span><span class="n">Pdict</span><span class="p">)</span>
    <span class="n">proxy</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">Pdict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>
    <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Leg</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="mf">3.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">AngUnit</span><span class="o">==</span><span class="s1">&#39;rad&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi/4$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi/2$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$3\pi/4$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi$&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s2">&quot;$-\pi/2$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$-\pi/4$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi/4$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi/2$&quot;</span><span class="p">])</span>
        <span class="n">AngUnit</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$(rad.)$&quot;</span>
    <span class="k">elif</span> <span class="n">AngUnit</span><span class="o">==</span><span class="s1">&#39;deg&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$90$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$180$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$270$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$360$&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s2">&quot;$-180$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$-90$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$90$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$180$&quot;</span><span class="p">])</span>
        <span class="n">AngUnit</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$(deg.)$&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">AngName</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">AngUnit</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\phi$ &quot;</span><span class="o">+</span><span class="n">AngUnit</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="o">**</span><span class="n">dLeg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span></div>



<span class="c1">############################################</span>
<span class="c1">#       Phi Theta Prof dist plotting</span>
<span class="c1">############################################</span>


<div class="viewcode-block" id="Config_phithetaproj_dist"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.Config_phithetaproj_dist">[docs]</a><span class="k">def</span> <span class="nf">Config_phithetaproj_dist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">refpt</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">indStruct</span><span class="p">,</span>
                             <span class="n">distonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">invertx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span>
                             <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;touch&#39;</span>
    <span class="n">lS</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lStruct</span>
    <span class="n">indsu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">indStruct</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invertx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">invertx</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># set extent</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">refpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>

    <span class="c1"># set colors</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmin</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmax</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">colshape</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">cbck</span><span class="p">),</span> <span class="n">colshape</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">indsu</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">indStruct</span> <span class="o">==</span> <span class="n">ii</span>
            <span class="n">cols</span><span class="p">[</span><span class="n">ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">lS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">())][</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">cmap</span><span class="p">),</span> <span class="n">colshape</span><span class="p">)</span>
    <span class="n">cols</span><span class="p">[:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">norm</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>


    <span class="c1"># Plotting</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">distonly</span> <span class="ow">or</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">dax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">_Config_phithetaproj_default</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>

    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                          <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                                 <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">ratio</span><span class="p">)</span>



    <span class="c1"># legend proxy</span>
    <span class="c1"># if legend != False:</span>
        <span class="c1"># handles, labels = dax[&#39;cross&#39;][0].get_legend_handles_labels()</span>
        <span class="c1"># for ii in indsu:</span>
            <span class="c1"># handles.append( mRectangle((0.,0.), 1, 1, fc=lS[ii].get_color()) )</span>
            <span class="c1"># labels.append( &#39;%s_%s&#39;%(lS[ii].Id.Cls, lS[ii].Id.Name) )</span>
        <span class="c1"># dax[&#39;cross&#39;][0].legend(handles, labels, frameon=False,</span>
                               <span class="c1"># bbox_to_anchor=(1.01,1.), loc=2, borderaxespad=0.)</span>
    <span class="k">if</span> <span class="n">invertx</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dax</span></div>






<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                        LOS class and functions</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">############################################</span>
<span class="c1">#       Utility functions</span>
<span class="c1">############################################</span>

<span class="k">def</span> <span class="nf">_LOS_calc_InOutPolProj_Debug</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">Ds</span><span class="p">,</span> <span class="n">us</span> <span class="p">,</span><span class="n">PIns</span><span class="p">,</span> <span class="n">POuts</span><span class="p">,</span>
                                 <span class="n">L</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nptstot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Nstep</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                 <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># Preformat</span>
    <span class="k">assert</span> <span class="n">Ds</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">us</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">PIns</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">POuts</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">Ds</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">Ds</span><span class="p">,</span> <span class="n">us</span> <span class="o">=</span> <span class="n">Ds</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">us</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">PIns</span><span class="p">,</span> <span class="n">POuts</span> <span class="o">=</span> <span class="n">PIns</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">POuts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">nP</span> <span class="o">=</span> <span class="n">Ds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]</span>
           <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">][</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">us</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="n">nP</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Plot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">Lim</span><span class="o">=</span><span class="n">Lim</span><span class="p">,</span> <span class="n">Nstep</span><span class="o">=</span><span class="n">Nstep</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;_LOS_calc_InOutPolProj - Debugging </span><span class="si">%s</span><span class="s1"> / </span><span class="si">%s</span><span class="s1"> pts&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nP</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">nptstot</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="c1"># ax.plot(PIns[0,:],PIns[1,:],PIns[2,:],</span>
    <span class="c1">#         c=&#39;b&#39;, ls=&#39;None&#39;, marker=&#39;o&#39;, label=r&quot;PIn&quot;)</span>
    <span class="c1"># ax.plot(POuts[0,:],POuts[1,:],POuts[2,:],</span>
    <span class="c1">#         c=&#39;r&#39;, ls=&#39;None&#39;, marker=&#39;x&#39;, label=r&quot;POut&quot;)</span>
    <span class="c1"># ax.legend(**_def.TorLegd)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_get_LLOS_Leg</span><span class="p">(</span><span class="n">GLLOS</span><span class="p">,</span> <span class="n">Leg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Crit</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">PreExp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">PostExp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Log</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">InOut</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">):</span>

    <span class="c1"># Get Legend</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Leg</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">Leg</span> <span class="o">=</span> <span class="n">GLLOS</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">GLLOS</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">GLLOS</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;LOS&#39;</span><span class="p">:</span>
        <span class="n">GLLOS</span> <span class="o">=</span> <span class="p">[</span><span class="n">GLLOS</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">GLLOS</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">dd</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;LOS&#39;</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">GLLOS</span><span class="p">]),</span> <span class="s2">&quot;GLD must be a list of TFG.LOS instances !&quot;</span>
    <span class="k">elif</span> <span class="n">GLLOS</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;GLOS&#39;</span><span class="p">:</span>
        <span class="n">Leg</span> <span class="o">=</span> <span class="n">GLLOS</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span> <span class="k">if</span> <span class="n">Leg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Leg</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">GLLOS</span><span class="o">.</span><span class="n">nLOS</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="n">ind</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Arg ind must be a np.ndarray with ndim=1 !&quot;</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="nb">bool</span> <span class="k">else</span> <span class="n">ind</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">GLLOS</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Val</span><span class="o">=</span><span class="n">Val</span><span class="p">,</span> <span class="n">Crit</span><span class="o">=</span><span class="n">Crit</span><span class="p">,</span> <span class="n">PreExp</span><span class="o">=</span><span class="n">PreExp</span><span class="p">,</span> <span class="n">PostExp</span><span class="o">=</span><span class="n">PostExp</span><span class="p">,</span> <span class="n">Log</span><span class="o">=</span><span class="n">Log</span><span class="p">,</span> <span class="n">InOut</span><span class="o">=</span><span class="n">InOut</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">GLLOS</span> <span class="o">=</span> <span class="p">[</span><span class="n">GLLOS</span><span class="o">.</span><span class="n">LLOS</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">GLLOS</span><span class="p">,</span> <span class="n">Leg</span>


<div class="viewcode-block" id="Get_FieldsFrom_LLOS"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.Get_FieldsFrom_LLOS">[docs]</a><span class="k">def</span> <span class="nf">Get_FieldsFrom_LLOS</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">Fields</span><span class="p">):</span>
    <span class="c1"># Returns a list of outputs</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="n">ll</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;LOS&#39;</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]),</span> <span class="s2">&quot;Arg L should be a list of LOS&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Fields</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">tuple</span><span class="p">]</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">Fields</span><span class="p">]),</span> <span class="s2">&quot;Arg Fields must be a list of str or tuples !&quot;</span>
    <span class="n">Out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Fields</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">ndim</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">Shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">shape</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">Shape</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="n">ndim</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">Shape</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="n">ndim</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">L</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">L</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ij</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
                    <span class="n">F</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">ij</span><span class="p">],</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ij</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
                    <span class="n">F</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">ij</span><span class="p">],</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="n">Fields</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">Out</span> <span class="o">=</span> <span class="n">Out</span> <span class="o">+</span> <span class="p">[</span><span class="n">F</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Out</span></div>




<span class="c1">############################################</span>
<span class="c1">#       Plotting functions</span>
<span class="c1">############################################</span>



<div class="viewcode-block" id="Rays_plot"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.Rays_plot">[docs]</a><span class="k">def</span> <span class="nf">Rays_plot</span><span class="p">(</span><span class="n">GLos</span><span class="p">,</span> <span class="n">Lax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Proj</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">reflections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">Lplot</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSLplot</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;LDIORP&#39;</span><span class="p">,</span> <span class="n">element_config</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span>
              <span class="n">Leg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dL</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dPtD</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
              <span class="n">dPtI</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtO</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtR</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
              <span class="n">dPtP</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">GLos</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rays&#39;</span><span class="p">,</span><span class="s1">&#39;CamLOS1D&#39;</span><span class="p">,</span><span class="s1">&#39;CamLOS2D&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">C</span><span class="p">,</span> <span class="s2">&quot;Arg GLos must be an object child of tfg.Rays !&quot;</span>
        <span class="n">Proj</span> <span class="o">=</span> <span class="n">Proj</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">Proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="s1">&#39;3d&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">C</span><span class="p">,</span> <span class="s2">&quot;Arg Proj must be in [&#39;cross&#39;,&#39;hor&#39;,&#39;all&#39;,&#39;3d&#39;] !&quot;</span>
        <span class="n">Lax</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">_check_Lax</span><span class="p">(</span><span class="n">Lax</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Arg element must be a str !&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">element_config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">element_config</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Arg element must be None or a str !&quot;</span>
        <span class="k">assert</span> <span class="n">C</span><span class="p">,</span> <span class="n">msg</span>
        <span class="k">assert</span> <span class="n">Lplot</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Tot&#39;</span><span class="p">,</span><span class="s1">&#39;In&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg Lplot must be in [&#39;Tot&#39;,&#39;In&#39;]&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dPtD</span><span class="p">,</span><span class="n">dPtI</span><span class="p">,</span><span class="n">dPtO</span><span class="p">,</span><span class="n">dPtR</span><span class="p">,</span><span class="n">dPtP</span><span class="p">]])</span>
        <span class="k">assert</span> <span class="n">C</span><span class="p">,</span> <span class="s2">&quot;Args dPtD,dPtI,dPtO,dPtR,dPtP must all be dict !&quot;</span>
        <span class="k">assert</span> <span class="n">dL</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">dL</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;Arg dL must be None or a dict&quot;</span>
        <span class="k">assert</span> <span class="n">Leg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Leg</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Arg Leg must be a str !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">dLeg</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;dLeg must be dict !&#39;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;Arg draw must be a bool !&quot;</span>

    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>

    <span class="k">if</span> <span class="n">element_config</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">Lax</span> <span class="o">=</span> <span class="n">GLos</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="n">Lax</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="n">element_config</span><span class="p">,</span>
                               <span class="n">proj</span><span class="o">=</span><span class="n">Proj</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>
        <span class="n">Lax</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">_check_Lax</span><span class="p">(</span><span class="n">Lax</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Select subset</span>
    <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">GLos</span><span class="o">.</span><span class="n">nRays</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

    <span class="n">Leg</span> <span class="o">=</span> <span class="n">GLos</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span> <span class="k">if</span> <span class="n">Leg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Leg</span>
    <span class="n">dL</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">LOSLd</span> <span class="k">if</span> <span class="n">dL</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dL</span>
    <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">GLos</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rays&#39;</span><span class="p">,</span><span class="s1">&#39;LOS&#39;</span><span class="p">]:</span>
            <span class="n">Leg</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Leg</span> <span class="o">=</span> <span class="n">GLos</span><span class="o">.</span><span class="n">LNames</span>
        <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">dL</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">del</span> <span class="n">dL</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>

    <span class="c1"># Check sino</span>
    <span class="k">if</span> <span class="n">GLos</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">element</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Proj</span><span class="o">==</span><span class="s1">&#39;3d&#39;</span><span class="p">:</span>
            <span class="n">Lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Rays_plot_3D</span><span class="p">(</span><span class="n">GLos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Lax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">reflections</span><span class="o">=</span><span class="n">reflections</span><span class="p">,</span>
                                   <span class="n">Elt</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                   <span class="n">Leg</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="n">dL</span><span class="o">=</span><span class="n">dL</span><span class="p">,</span> <span class="n">dPtD</span><span class="o">=</span><span class="n">dPtD</span><span class="p">,</span> <span class="n">dPtI</span><span class="o">=</span><span class="n">dPtI</span><span class="p">,</span>
                                   <span class="n">dPtO</span><span class="o">=</span><span class="n">dPtO</span><span class="p">,</span> <span class="n">dPtR</span><span class="o">=</span><span class="n">dPtR</span><span class="p">,</span> <span class="n">dPtP</span><span class="o">=</span><span class="n">dPtP</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">multi</span><span class="o">=</span><span class="n">multi</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span>
                                   <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Proj</span><span class="o">==</span><span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">Lax</span><span class="p">:</span>
                <span class="n">Lax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_def</span><span class="o">.</span><span class="n">Plot_LOSProj_DefAxes</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span>
                                                     <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                                     <span class="n">Type</span><span class="o">=</span><span class="n">GLos</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Type</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">Proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
                <span class="n">Lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Rays_plot_Cross</span><span class="p">(</span><span class="n">GLos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Lax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">reflections</span><span class="o">=</span><span class="n">reflections</span><span class="p">,</span>
                                          <span class="n">Elt</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                          <span class="n">Leg</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="n">dL</span><span class="o">=</span><span class="n">dL</span><span class="p">,</span> <span class="n">dPtD</span><span class="o">=</span><span class="n">dPtD</span><span class="p">,</span> <span class="n">dPtI</span><span class="o">=</span><span class="n">dPtI</span><span class="p">,</span>
                                          <span class="n">dPtO</span><span class="o">=</span><span class="n">dPtO</span><span class="p">,</span> <span class="n">dPtR</span><span class="o">=</span><span class="n">dPtR</span><span class="p">,</span> <span class="n">dPtP</span><span class="o">=</span><span class="n">dPtP</span><span class="p">,</span>
                                          <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="n">multi</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span>
                                          <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                          <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">Proj</span><span class="o">==</span><span class="s1">&#39;hor&#39;</span> <span class="k">else</span> <span class="mi">1</span>
                <span class="n">Lax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Rays_plot_Hor</span><span class="p">(</span><span class="n">GLos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Lax</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                         <span class="n">reflections</span><span class="o">=</span><span class="n">reflections</span><span class="p">,</span>
                                         <span class="n">Elt</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                         <span class="n">Leg</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="n">dL</span><span class="o">=</span><span class="n">dL</span><span class="p">,</span> <span class="n">dPtD</span><span class="o">=</span><span class="n">dPtD</span><span class="p">,</span> <span class="n">dPtI</span><span class="o">=</span><span class="n">dPtI</span><span class="p">,</span>
                                         <span class="n">dPtO</span><span class="o">=</span><span class="n">dPtO</span><span class="p">,</span> <span class="n">dPtR</span><span class="o">=</span><span class="n">dPtR</span><span class="p">,</span> <span class="n">dPtP</span><span class="o">=</span><span class="n">dPtP</span><span class="p">,</span>
                                         <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="n">multi</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span>
                                         <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                         <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">dLeg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">Lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">Lax</span> <span class="o">=</span> <span class="n">Lax</span> <span class="k">if</span> <span class="n">Proj</span><span class="o">==</span><span class="s1">&#39;all&#39;</span> <span class="k">else</span> <span class="n">Lax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Lax</span></div>



<span class="k">def</span> <span class="nf">_Rays_plot_Cross</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">Leg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reflections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;Tot&#39;</span><span class="p">,</span> <span class="n">Elt</span><span class="o">=</span><span class="s1">&#39;LDIORP&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">dL</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSLd</span><span class="p">,</span> <span class="n">dPtD</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtI</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
                     <span class="n">dPtO</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtR</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtP</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
                     <span class="n">dLeg</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">),</span> <span class="s1">&#39;Wrong input for ax !&#39;</span>
    <span class="n">dPts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">dPtD</span><span class="p">),</span> <span class="s1">&#39;I&#39;</span><span class="p">:(</span><span class="s1">&#39;PkIn&#39;</span><span class="p">,</span><span class="n">dPtI</span><span class="p">),</span> <span class="s1">&#39;O&#39;</span><span class="p">:(</span><span class="s1">&#39;PkOut&#39;</span><span class="p">,</span><span class="n">dPtO</span><span class="p">),</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:(</span><span class="s1">&#39;PRMin&#39;</span><span class="p">,</span><span class="n">dPtR</span><span class="p">),</span><span class="s1">&#39;P&#39;</span><span class="p">:(</span><span class="s1">&#39;RefPt&#39;</span><span class="p">,</span><span class="n">dPtP</span><span class="p">)}</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_LOSProj_DefAxes</span><span class="p">(</span><span class="s1">&#39;Cross&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                       <span class="n">Type</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Ves</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">R</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;Cross&#39;</span><span class="p">,</span>
                                     <span class="n">reflections</span><span class="o">=</span><span class="n">reflections</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="n">multi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dPts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kk</span><span class="o">==</span><span class="s1">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">L</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;pts&#39;</span><span class="p">][:,</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">kk</span><span class="o">==</span><span class="s1">&#39;D&#39;</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">D</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kk</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span> <span class="ow">and</span> <span class="n">L</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;Lin&#39;</span><span class="p">):</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">0</span><span class="p">]][:,</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">L</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Tor&#39;</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]),</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>
            <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
                    <span class="n">leg</span> <span class="o">=</span> <span class="n">kk</span> <span class="k">if</span> <span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="n">kk</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">dLeg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>



<span class="k">def</span> <span class="nf">_Rays_plot_Hor</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Leg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reflections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;Tot&#39;</span><span class="p">,</span> <span class="n">Elt</span><span class="o">=</span><span class="s1">&#39;LDIORP&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">dL</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSLd</span><span class="p">,</span> <span class="n">dPtD</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtI</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
                   <span class="n">dPtO</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtR</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtP</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
                   <span class="n">dLeg</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">),</span> <span class="s1">&#39;Wrong input for ax !&#39;</span>
    <span class="n">dPts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">dPtD</span><span class="p">),</span> <span class="s1">&#39;I&#39;</span><span class="p">:(</span><span class="s1">&#39;PkIn&#39;</span><span class="p">,</span><span class="n">dPtI</span><span class="p">),</span> <span class="s1">&#39;O&#39;</span><span class="p">:(</span><span class="s1">&#39;PkOut&#39;</span><span class="p">,</span><span class="n">dPtO</span><span class="p">),</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:(</span><span class="s1">&#39;PRMin&#39;</span><span class="p">,</span><span class="n">dPtR</span><span class="p">),</span><span class="s1">&#39;P&#39;</span><span class="p">:(</span><span class="s1">&#39;RefPt&#39;</span><span class="p">,</span><span class="n">dPtP</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_LOSProj_DefAxes</span><span class="p">(</span><span class="s1">&#39;Hor&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                                       <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Ves</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span>
                                     <span class="n">reflections</span><span class="o">=</span><span class="n">reflections</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="n">multi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dPts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kk</span><span class="o">==</span><span class="s1">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">L</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;pts&#39;</span><span class="p">][:,</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">kk</span><span class="o">==</span><span class="s1">&#39;D&#39;</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">D</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kk</span><span class="o">==</span><span class="s1">&#39;R&#39;</span> <span class="ow">and</span> <span class="n">L</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="o">==</span><span class="s1">&#39;Lin&#39;</span><span class="p">):</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">0</span><span class="p">]][:,</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
                    <span class="n">leg</span> <span class="o">=</span> <span class="n">kk</span> <span class="k">if</span> <span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="n">kk</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">dLeg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>



<span class="k">def</span>  <span class="nf">_Rays_plot_3D</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Leg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reflections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;Tot&#39;</span><span class="p">,</span><span class="n">Elt</span><span class="o">=</span><span class="s1">&#39;LDIORr&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">dL</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSLd</span><span class="p">,</span> <span class="n">dPtD</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtI</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
                   <span class="n">dPtO</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtR</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span> <span class="n">dPtP</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMd</span><span class="p">,</span>
                   <span class="n">dLeg</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">Axes3D</span><span class="p">),</span> <span class="s1">&#39;Arg ax should be plt.Axes instance !&#39;</span>
    <span class="n">dPts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">dPtD</span><span class="p">),</span> <span class="s1">&#39;I&#39;</span><span class="p">:(</span><span class="s1">&#39;PkIn&#39;</span><span class="p">,</span><span class="n">dPtI</span><span class="p">),</span> <span class="s1">&#39;O&#39;</span><span class="p">:(</span><span class="s1">&#39;PkOut&#39;</span><span class="p">,</span><span class="n">dPtO</span><span class="p">),</span>
            <span class="s1">&#39;R&#39;</span><span class="p">:(</span><span class="s1">&#39;PRMin&#39;</span><span class="p">,</span><span class="n">dPtR</span><span class="p">),</span><span class="s1">&#39;P&#39;</span><span class="p">:(</span><span class="s1">&#39;RefPt&#39;</span><span class="p">,</span><span class="n">dPtP</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_3D_plt_Tor_DefAxes</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span>
                                     <span class="n">reflections</span><span class="o">=</span><span class="n">reflections</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="n">multi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dPts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">][:,</span><span class="n">ind</span><span class="p">]</span> <span class="k">if</span> <span class="n">kk</span><span class="o">==</span><span class="s1">&#39;P&#39;</span> <span class="k">else</span> <span class="n">L</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">0</span><span class="p">]][:,</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
                    <span class="n">leg</span> <span class="o">=</span> <span class="n">kk</span> <span class="k">if</span> <span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Leg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="n">kk</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dPts</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dLeg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">dLeg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>



<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">def  Plot_3D_mlab_GLOS(L,Leg =&#39;&#39;,Lplot=&#39;Tot&#39;,PDIOR=&#39;DIOR&#39;,fig=&#39;None&#39;, dL=dL_mlab_Def, Mdict=Mdict_mlab_Def,LegDict=LegDict_Def):</span>
<span class="sd">    assert isinstance(L,LOS) or isinstance(L,list) or isinstance(L,GLOS), &#39;Arg L should a LOS instance or a list of LOS !&#39;</span>
<span class="sd">    assert Lplot==&#39;Tot&#39; or Lplot==&#39;In&#39;, &quot;Arg Lplot should be str &#39;Tot&#39; or &#39;In&#39; !&quot;</span>
<span class="sd">    assert isinstance(PDIOR,basestring), &#39;Arg PDIOR should be string !&#39;</span>
<span class="sd">    #assert fig==&#39;None&#39; or isinstance(fig,mlab.Axes), &#39;Arg ax should be plt.Axes instance !&#39;</span>
<span class="sd">    assert type(dL) is dict and type(Mdict) is dict and type(LegDict) is dict, &#39;dL, Mdict and LegDict should be dictionaries !&#39;</span>
<span class="sd">    LegDict[&#39;frameon&#39;] = LegDict[&#39;frameon&#39;]==&#39;True&#39; or (type(LegDict[&#39;frameon&#39;]) is bool and LegDict[&#39;frameon&#39;])</span>
<span class="sd">    if isinstance(L,LOS):</span>
<span class="sd">        L = [L]</span>
<span class="sd">    elif isinstance(L, GLOS):</span>
<span class="sd">    Leg = L.Id.NameLTX</span>
<span class="sd">        L = L.LLOS</span>
<span class="sd">    if Lplot==&#39;Tot&#39;:</span>
<span class="sd">        Pfield = &#39;PplotOut&#39;</span>
<span class="sd">    else:</span>
<span class="sd">        Pfield = &#39;PplotIn&#39;</span>
<span class="sd">    PDIORind = np.array([&#39;D&#39; in PDIOR, &#39;I&#39; in PDIOR, &#39;O&#39; in PDIOR, &#39;R&#39; in PDIOR],dtype=np.bool_)</span>

<span class="sd">    if fig==&#39;None&#39;:</span>
<span class="sd">        fig = Plot_3D_mlab_Tor_DefFig()</span>
<span class="sd">    if Leg == &#39;&#39;:</span>
<span class="sd">        for i in range(len(L)):</span>
<span class="sd">            P = getattr(L[i],Pfield)</span>
<span class="sd">            mlab.plot3d(P[0,:],P[1,:],P[2,:],name=L[i].Id.NameLTX, figure=fig, **dL)</span>
<span class="sd">        if np.any(PDIORind):</span>
<span class="sd">            for i in range(len(L)):</span>
<span class="sd">                P = np.concatenate((L[i].D,L[i].PIn,L[i].POut,L[i].P1Min),axis=1)</span>
<span class="sd">                P = P[:,PDIORind]</span>
<span class="sd">                mlab.points3d(P[0,:],P[1,:],P[2,:],name=L[i].Id.NameLTX+&#39; &#39;+PDIOR, figure=fig, **Mdict)</span>
<span class="sd">    else:</span>
<span class="sd">        Pl,Pm = np.nan*np.ones((3,1)), np.nan*np.ones((3,1))</span>
<span class="sd">        for i in range(len(L)):</span>
<span class="sd">            P = getattr(L[i],Pfield)</span>
<span class="sd">            Pl = np.concatenate((Pl,P,np.nan*np.ones((3,1))),axis=1)</span>
<span class="sd">            P = np.concatenate((L[i].D,L[i].PIn,L[i].POut,L[i].P1Min),axis=1)</span>
<span class="sd">            P = P[:,PDIORind]</span>
<span class="sd">            Pm = np.concatenate((Pm,P),axis=1)</span>
<span class="sd">        mlab.plot3d(Pl[0,:],Pl[1,:],Pl[2,:],name=Leg, figure=fig, **dL)</span>
<span class="sd">        if np.any(PDIORind):</span>
<span class="sd">            mlab.points3d(Pm[0,:],Pm[1,:],Pm[2,:],name=Leg+&#39; &#39;+PDIOR, figure=fig, **Mdict)</span>
<span class="sd">    #ax.legend(**LegDict)</span>
<span class="sd">    return fig</span>
<span class="sd">&quot;&quot;&quot;</span>



<div class="viewcode-block" id="GLOS_plot_Sino"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.GLOS_plot_Sino">[docs]</a><span class="k">def</span> <span class="nf">GLOS_plot_Sino</span><span class="p">(</span><span class="n">GLos</span><span class="p">,</span> <span class="n">Proj</span><span class="o">=</span><span class="s1">&#39;Cross&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Elt</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSImpElt</span><span class="p">,</span>
                   <span class="n">Sketch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSImpAng</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSImpAngUnit</span><span class="p">,</span>
                   <span class="n">Leg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dL</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMImpd</span><span class="p">,</span> <span class="n">dVes</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorPFilld</span><span class="p">,</span>
                   <span class="n">dLeg</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">Proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Cross&#39;</span><span class="p">,</span><span class="s1">&#39;3d&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg Proj must be in [&#39;Pol&#39;,&#39;3d&#39;] !&quot;</span>
        <span class="k">assert</span> <span class="n">Ang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="s1">&#39;xi&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg Ang must be in [&#39;theta&#39;,&#39;xi&#39;] !&quot;</span>
        <span class="k">assert</span> <span class="n">AngUnit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span><span class="s1">&#39;deg&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg Ang must be in [&#39;rad&#39;,&#39;deg&#39;] !&quot;</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">GLos</span><span class="o">.</span><span class="n">dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">GLos</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">plot_sino</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">dP</span><span class="o">=</span><span class="n">dVes</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="n">Ang</span><span class="p">,</span>
                                   <span class="n">AngUnit</span><span class="o">=</span><span class="n">AngUnit</span><span class="p">,</span> <span class="n">Sketch</span><span class="o">=</span><span class="n">Sketch</span><span class="p">,</span>
                                   <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                                   <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>

        <span class="c1"># Select subset</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">GLos</span><span class="o">.</span><span class="n">nRays</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

        <span class="n">Leg</span> <span class="o">=</span> <span class="n">GLos</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">NameLTX</span> <span class="k">if</span> <span class="n">Leg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Leg</span>
        <span class="n">dL</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">LOSLd</span> <span class="k">if</span> <span class="n">dL</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dL</span>
        <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">GLos</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rays&#39;</span><span class="p">,</span><span class="s1">&#39;LOS&#39;</span><span class="p">]:</span>
                <span class="n">Leg</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Leg</span> <span class="o">=</span> <span class="n">GLos</span><span class="o">.</span><span class="n">LNames</span>
            <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">dL</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">dL</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">Elt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Proj</span><span class="o">==</span><span class="s1">&#39;Cross&#39;</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">_Plot_Sinogram_CrossProj</span><span class="p">(</span><span class="n">GLos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="n">Ang</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="n">AngUnit</span><span class="p">,</span>
                                              <span class="n">Sketch</span><span class="o">=</span><span class="n">Sketch</span><span class="p">,</span> <span class="n">dL</span><span class="o">=</span><span class="n">dL</span><span class="p">,</span> <span class="n">LegDict</span><span class="o">=</span><span class="n">dLeg</span><span class="p">,</span>
                                              <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                                              <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">_Plot_Sinogram_3D</span><span class="p">(</span><span class="n">GLos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="n">Ang</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="n">AngUnit</span><span class="p">,</span>
                                       <span class="n">dL</span><span class="o">=</span><span class="n">dL</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">LegDict</span><span class="o">=</span><span class="n">dLeg</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="n">Test</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span></div>



<span class="k">def</span> <span class="nf">_Plot_Sinogram_CrossProj</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Leg</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span>
                             <span class="n">Sketch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dL</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMImpd</span><span class="p">,</span> <span class="n">LegDict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">,</span>
                             <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">Test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Test</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">),</span> <span class="s1">&#39;Arg ax should be Axes instance !&#39;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">axSketch</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_Impact_DefAxes</span><span class="p">(</span><span class="s1">&#39;Cross&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                                <span class="n">Ang</span><span class="o">=</span><span class="n">Ang</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="n">AngUnit</span><span class="p">,</span>
                                                <span class="n">Sketch</span><span class="o">=</span><span class="n">Sketch</span><span class="p">)</span>
    <span class="n">Impp</span><span class="p">,</span> <span class="n">Imptheta</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">L</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Ang</span><span class="o">==</span><span class="s1">&#39;xi&#39;</span><span class="p">:</span>
        <span class="n">Imptheta</span><span class="p">,</span> <span class="n">Impp</span><span class="p">,</span> <span class="n">bla</span> <span class="o">=</span> <span class="n">_GG</span><span class="o">.</span><span class="n">ConvertImpact_Theta2Xi</span><span class="p">(</span><span class="n">Imptheta</span><span class="p">,</span> <span class="n">Impp</span><span class="p">,</span> <span class="n">Impp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dsino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Imptheta</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">Impp</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Imptheta</span><span class="p">,</span><span class="n">Impp</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">LegDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">LegDict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">_Plot_Sinogram_3D</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Leg</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">Ang</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">AngUnit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span>
                      <span class="n">dL</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">LOSMImpd</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">LegDict</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">TorLegd</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">),</span> <span class="s1">&#39;Arg ax should be Axes instance !&#39;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">Plot_Impact_DefAxes</span><span class="p">(</span><span class="s1">&#39;3D&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">)</span>
    <span class="n">Impp</span><span class="p">,</span> <span class="n">Imptheta</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sino</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">L</span><span class="o">.</span><span class="n">sino</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">ImpPhi</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sino</span><span class="p">[</span><span class="s1">&#39;Phi&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Ang</span><span class="o">==</span><span class="s1">&#39;xi&#39;</span><span class="p">:</span>
        <span class="n">Imptheta</span><span class="p">,</span> <span class="n">Impp</span><span class="p">,</span> <span class="n">bla</span> <span class="o">=</span> <span class="n">_GG</span><span class="o">.</span><span class="n">ConvertImpact_Theta2Xi</span><span class="p">(</span><span class="n">Imptheta</span><span class="p">,</span> <span class="n">Impp</span><span class="p">,</span> <span class="n">Impp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Sino_RefPt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">Imptheta</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="p">[</span><span class="n">Impp</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="p">[</span><span class="n">ImpPhi</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Imptheta</span><span class="p">,</span><span class="n">Impp</span><span class="p">,</span><span class="n">ImpPhi</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">Leg</span><span class="p">,</span> <span class="o">**</span><span class="n">dL</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">LegDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">LegDict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>



<span class="c1">########################################################</span>
<span class="c1">########################################################</span>
<span class="c1">########################################################</span>
<span class="c1">#           plot_touch</span>
<span class="c1">########################################################</span>
<span class="c1">########################################################</span>


<div class="viewcode-block" id="Rays_plot_touch"><a class="viewcode-back" href="../../../tofu.geom.html#tofu.geom._plot.Rays_plot_touch">[docs]</a><span class="k">def</span> <span class="nf">Rays_plot_touch</span><span class="p">(</span><span class="n">cam</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quant</span><span class="o">=</span><span class="s1">&#39;lengths&#39;</span><span class="p">,</span> <span class="n">cdef</span><span class="o">=</span><span class="n">_cdef</span><span class="p">,</span>
                    <span class="n">invert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">_cbck</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                    <span class="n">incch</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;touch&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">fmt_ch</span><span class="o">=</span><span class="s1">&#39;02.0f&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">_labelpad</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">nchMax</span><span class="o">=</span><span class="n">_nchMax</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">_lcch</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">_fontsize</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="c1">########</span>
    <span class="c1"># Prepare</span>
    <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_check_indch</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">ToFuObject</span><span class="p">)</span>
            <span class="ow">and</span> <span class="s1">&#39;cam&#39;</span> <span class="ow">in</span> <span class="n">cam</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="n">nD</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">cam</span><span class="o">.</span><span class="n">_is2D</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">invert</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">invert</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">invert</span>


    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">lok</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lengths&#39;</span><span class="p">,</span> <span class="s1">&#39;indices&#39;</span><span class="p">,</span> <span class="s1">&#39;angles&#39;</span><span class="p">,</span> <span class="s1">&#39;Etendues&#39;</span><span class="p">,</span> <span class="s1">&#39;Surfaces&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quant</span> <span class="ow">in</span> <span class="n">lok</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Valid flags for kwarg quant are:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    [&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lok</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    Provided: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">quant</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quant</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Etendues&#39;</span><span class="p">,</span><span class="s1">&#39;Surfaces&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cam</span><span class="p">,</span><span class="n">quant</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Required quantity is not set:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    self.</span><span class="si">%s</span><span class="s2"> = None</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">quant</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;  =&gt; use self.set_</span><span class="si">%s</span><span class="s2">() first&quot;</span><span class="o">%</span><span class="n">quant</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">quant</span> <span class="o">=</span> <span class="n">quant</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">quant</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">nRays</span><span class="p">,):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Provided quant has wrong shape!</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    - Expected: (</span><span class="si">%s</span><span class="s2">,)&quot;</span><span class="o">%</span><span class="n">cam</span><span class="o">.</span><span class="n">nRays</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    - Provided: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">quant</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1">########</span>
    <span class="c1"># Plot</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">_Cam12D_plottouch</span><span class="p">(</span><span class="n">cam</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">quant</span><span class="o">=</span><span class="n">quant</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span>
                            <span class="n">Bck</span><span class="o">=</span><span class="n">Bck</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">lcch</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                            <span class="n">incch</span><span class="o">=</span><span class="n">incch</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                            <span class="n">fmt_ch</span><span class="o">=</span><span class="n">fmt_ch</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">,</span>
                            <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span>
                            <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="n">connect</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>



<span class="k">def</span> <span class="nf">_Cam12D_plot_touch_init</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                            <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="n">_nchMax</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="c1"># Figure</span>
    <span class="n">axCol</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="k">if</span> <span class="n">fs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">fs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;a4&#39;</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mf">8.27</span><span class="p">,</span><span class="mf">11.69</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">axCol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">wintit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dmargin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmargin</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span><span class="mf">0.03</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span><span class="mf">0.99</span><span class="p">,</span>
                   <span class="s1">&#39;bottom&#39;</span><span class="p">:</span><span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span><span class="mf">0.92</span><span class="p">,</span>
                   <span class="s1">&#39;wspace&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span><span class="mf">0.4</span><span class="p">}</span>

    <span class="c1"># Axes</span>
    <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">**</span><span class="n">dmargin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axp</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">5</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
        <span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">axp</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">5</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axH</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">axC</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>

    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">axp</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axp</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">DY</span> <span class="o">=</span> <span class="mf">0.02</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">axp</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DX</span> <span class="o">=</span> <span class="n">axp</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">axtxtch</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span>
    <span class="n">axtxtg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># Dict</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:[</span><span class="n">axp</span><span class="p">],</span>
           <span class="s1">&#39;cross&#39;</span><span class="p">:[</span><span class="n">axC</span><span class="p">],</span>
           <span class="s1">&#39;hor&#39;</span><span class="p">:[</span><span class="n">axH</span><span class="p">],</span>
           <span class="s1">&#39;txtg&#39;</span><span class="p">:[</span><span class="n">axtxtg</span><span class="p">],</span>
           <span class="s1">&#39;txtch&#39;</span><span class="p">:[</span><span class="n">axtxtch</span><span class="p">]}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cax</span><span class="p">]</span>

    <span class="c1"># Formatting</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dax</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">])):</span>
            <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;txt&#39;</span> <span class="ow">in</span> <span class="n">kk</span><span class="p">:</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">]:</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([]),</span> <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>  <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dax</span>


<span class="k">def</span> <span class="nf">_Cam12D_plottouch</span><span class="p">(</span><span class="n">cam</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quant</span><span class="o">=</span><span class="s1">&#39;lengths&#39;</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="n">_nchMax</span><span class="p">,</span>
                      <span class="n">Bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">_lcch</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">_cbck</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                      <span class="n">incch</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">plotmethod</span><span class="o">=</span><span class="s1">&#39;imshow&#39;</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">fmt_ch</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Dlab</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">fontsize</span><span class="o">=</span><span class="n">_fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">_labelpad</span><span class="p">,</span>
                      <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="k">assert</span> <span class="n">plotmethod</span> <span class="o">==</span> <span class="s1">&#39;imshow&#39;</span><span class="p">,</span> <span class="s2">&quot;plotmethod </span><span class="si">%s</span><span class="s2"> not coded yet !&quot;</span><span class="o">%</span><span class="n">plotmethod</span>

    <span class="c1">#########</span>
    <span class="c1"># Prepare</span>
    <span class="c1">#########</span>
    <span class="n">fldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">)</span>


    <span class="c1"># ---------</span>
    <span class="c1"># Check nch and X</span>
    <span class="n">nch</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">nRays</span>

    <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Xlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;index&quot;</span>
        <span class="n">Xtype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">nch</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">indr</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Bck</span><span class="p">:</span>
            <span class="n">indbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">idx12</span> <span class="o">=</span> <span class="nb">id</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">))</span>
        <span class="n">n12</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="n">Xtype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span>
    <span class="n">idX</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># dchans</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">dchans</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">idchans</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dchans</span><span class="p">)</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check colors</span>

    <span class="n">dElt</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">get_touch_dict</span><span class="p">(</span><span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check data</span>

    <span class="c1"># data</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">quant</span> <span class="o">==</span> <span class="s1">&#39;lengths&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cam</span><span class="o">.</span><span class="n">_isLOS</span><span class="p">():</span>
                <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;LOS length&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$m$&#39;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">kOut</span><span class="o">-</span><span class="n">cam</span><span class="o">.</span><span class="n">kIn</span>
                <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;VOS volume&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$m^3$&#39;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not coded yet !&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">quant</span> <span class="o">==</span> <span class="s1">&#39;indices&#39;</span><span class="p">:</span>
            <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;index&#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39; ($a.u.$)&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cam</span><span class="o">.</span><span class="n">nRays</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">quant</span> <span class="o">==</span> <span class="s1">&#39;angles&#39;</span><span class="p">:</span>
            <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;angle of incidence (rad.)&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">u</span><span class="o">*</span><span class="n">cam</span><span class="o">.</span><span class="n">dgeom</span><span class="p">[</span><span class="s1">&#39;vperp&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cam</span><span class="p">,</span> <span class="n">quant</span><span class="p">)</span>
            <span class="n">Dlab</span> <span class="o">=</span> <span class="n">quant</span>
            <span class="n">Dlab</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; ($m^2/sr$)&#39;</span> <span class="k">if</span> <span class="n">quant</span> <span class="o">==</span> <span class="s1">&#39;Etendues&#39;</span> <span class="k">else</span> <span class="sa">r</span><span class="s1">&#39; ($m^2$)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">quant</span>
        <span class="n">Dlab</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">Dlab</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Dlab</span>

    <span class="n">iddata</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmin</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmax</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Dlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmax</span><span class="p">)]</span>
        <span class="n">Dd</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">),</span> <span class="n">Dlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">get_touch_colors</span><span class="p">(</span><span class="n">dElt</span><span class="o">=</span><span class="n">dElt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">cmap</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nRays</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">norm</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">cols</span><span class="p">[:,</span><span class="n">indr</span><span class="o">.</span><span class="n">T</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#########</span>
    <span class="c1"># Plot</span>
    <span class="c1">#########</span>

    <span class="c1"># Format axes</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="n">_Cam12D_plot_touch_init</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span>
                                  <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

    <span class="k">if</span> <span class="n">tit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">cam</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="n">cam</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>

    <span class="c1"># -----------------</span>
    <span class="c1"># Plot conf and bck</span>
    <span class="k">if</span> <span class="n">cam</span><span class="o">.</span><span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                              <span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

    <span class="k">if</span> <span class="n">cam</span><span class="o">.</span><span class="n">_isLOS</span><span class="p">():</span>
        <span class="n">lCross</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                                <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">lHor</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span>
                              <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Bck</span> <span class="ow">and</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">crossbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                        <span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
            <span class="n">crossbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crossbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">horbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                      <span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
            <span class="n">horbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">horbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crossbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crossbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                 <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">horbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">horbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                 <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kn</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dElt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indok&#39;</span><span class="p">]):</span>
                    <span class="n">crok</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lCross</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">nan2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;indok&#39;</span><span class="p">]]</span>
                    <span class="n">crok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crok</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crok</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span>  <span class="n">crok</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>  <span class="n">c</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">crok</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lHor</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">nan2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;indok&#39;</span><span class="p">]]</span>
                    <span class="n">crok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crok</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crok</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span>  <span class="n">crok</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>  <span class="n">c</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indout&#39;</span><span class="p">]):</span>
                    <span class="n">crout</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lCross</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">nan2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;indout&#39;</span><span class="p">]]</span>
                    <span class="n">crout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crout</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crout</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crout</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">crout</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lHor</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">nan2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;indout&#39;</span><span class="p">]]</span>
                    <span class="n">crout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crout</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crout</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crout</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">lHor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
        <span class="n">idlCross</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lCross</span><span class="p">)</span>
        <span class="n">idlHor</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># data, TBF</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">kn</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dElt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indok&#39;</span><span class="p">]],</span> <span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indok&#39;</span><span class="p">]],</span>
                             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">c</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indout&#39;</span><span class="p">]],</span> <span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indout&#39;</span><span class="p">]],</span>
                             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                           <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cmapdef</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span> <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span> <span class="k">else</span> <span class="n">cmap</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">cmap</span><span class="o">=</span><span class="n">cmapdef</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                       <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">Dlab</span><span class="p">)</span>
        <span class="c1"># Define datanorm because colorbar =&gt; xlim in (0,1)</span>
        <span class="k">if</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">):</span>
            <span class="n">datanorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datanorm</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">iddatanorm</span><span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">datanorm</span><span class="p">)</span>


    <span class="c1"># ---------------</span>
    <span class="c1"># Lims and labels</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">DX</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Xlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

    <span class="c1">##################</span>
    <span class="c1"># Interactivity dict</span>
    <span class="n">dgroup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channel&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nchMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]}}</span>

    <span class="c1"># Group info (make dynamic in later versions ?)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dgroup</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="c1"># dref</span>
    <span class="n">dref</span> <span class="o">=</span> <span class="p">{</span><span class="n">idX</span><span class="p">:{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incch</span><span class="p">}}</span>

    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">idX</span><span class="p">][</span><span class="s1">&#39;2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>

    <span class="c1"># ddata</span>
    <span class="n">ddat</span> <span class="o">=</span> <span class="p">{</span><span class="n">iddata</span><span class="p">:{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}}</span>
    <span class="n">ddat</span><span class="p">[</span><span class="n">idchans</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dchans</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
    <span class="k">if</span> <span class="n">lCross</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlCross</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lCross</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlHor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lHor</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idx12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">iddatanorm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ddat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ddat</span><span class="p">[</span><span class="n">iddatanorm</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">datanorm</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>

    <span class="c1"># dax</span>
    <span class="n">lax_fix</span> <span class="o">=</span> <span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtch&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">dax2</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span><span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">}</span>

    <span class="n">dobj</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="c1">##################</span>
    <span class="c1"># Populating dobj</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot channels</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

        <span class="c1"># Channel text</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtch&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">nchMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idchans</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_ch</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
        <span class="c1"># los</span>
        <span class="k">if</span> <span class="n">cam</span><span class="o">.</span><span class="n">_isLOS</span><span class="p">():</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                      <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlCross</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlHor</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># Data-specific</span>


    <span class="c1"># Channel</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

        <span class="c1"># Channel vlines or pixels</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                   <span class="n">mec</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                                   <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idx12</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Channel colorbar indicators</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">iddatanorm</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>


    <span class="c1">##################</span>
    <span class="c1"># Instanciate KeyHandler</span>
    <span class="n">can</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
    <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">kh</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">KeyHandler_mpl</span><span class="p">(</span><span class="n">can</span><span class="o">=</span><span class="n">can</span><span class="p">,</span>
                              <span class="n">dgroup</span><span class="o">=</span><span class="n">dgroup</span><span class="p">,</span> <span class="n">dref</span><span class="o">=</span><span class="n">dref</span><span class="p">,</span> <span class="n">ddata</span><span class="o">=</span><span class="n">ddat</span><span class="p">,</span>
                              <span class="n">dobj</span><span class="o">=</span><span class="n">dobj</span><span class="p">,</span> <span class="n">dax</span><span class="o">=</span><span class="n">dax2</span><span class="p">,</span> <span class="n">lax_fix</span><span class="o">=</span><span class="n">lax_fix</span><span class="p">,</span>
                              <span class="n">groupinit</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">disconnect_old</span><span class="p">()</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">kh</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2016-2019, Tofu contributors.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>