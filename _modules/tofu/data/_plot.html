<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>tofu.data._plot &#8212; Tofu 1.4.15</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          tofu</a>
        <span class="navbar-text navbar-version pull-left"><b>1.4.15</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../installation.html">Installation</a></li>
                <li><a href="../../../contributing.html">Contributing</a></li>
                <li><a href="../../../auto_examples/index.html">Gallery</a></li>
                <li><a href="../../../aboutus.html">About</a></li>
                <li><a href="../../../releases.html">Releases</a></li>
                <li><a href="../../../tofu.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">How to install tofu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">A guide to contributing to tofu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/tutorials/tuto_plot_gallery_fusion_machines.html">A list of all different device configurations available (ITER, WEST, JET, ...)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/index.html">Tutorials and examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu_from_bash.html">Using tofu from a bash terminal</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.html">tofu package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.geom.html">tofu.geom package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.dumpro.html">tofu.dumpro package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.data.html">tofu.data package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tofu.dust.html">tofu.dust package</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for tofu.data._plot</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding utf-8</span>

<span class="c1"># Built-in</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">itt</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Common</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">scpinteg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>

<span class="c1"># tofu</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tofu.version</span> <span class="k">import</span> <span class="n">__version__</span>
    <span class="kn">import</span> <span class="nn">tofu.utils</span> <span class="k">as</span> <span class="nn">utils</span>
    <span class="kn">import</span> <span class="nn">tofu.data._def</span> <span class="k">as</span> <span class="nn">_def</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tofu.version</span> <span class="k">import</span> <span class="n">__version__</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">utils</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_def</span> <span class="k">as</span> <span class="n">_def</span>



<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Data_plot&#39;</span><span class="p">,</span> <span class="s1">&#39;Data_plot_combine&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Data_plot_spectrogram&#39;</span><span class="p">]</span>
<span class="c1">#__author_email__ = &#39;didier.vezinet@cea.fr&#39;</span>
<span class="n">__github</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/ToFuProject/tofu/issues&#39;</span>
<span class="n">_wintit</span> <span class="o">=</span> <span class="s1">&#39;tofu-</span><span class="si">%s</span><span class="s1">        report issues / requests at </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="n">__github</span><span class="p">)</span>
<span class="n">_nchMax</span><span class="p">,</span> <span class="n">_ntMax</span><span class="p">,</span> <span class="n">_nfMax</span><span class="p">,</span> <span class="n">_nlbdMax</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">_fontsize</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">_labelpad</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">_lls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">]</span>
<span class="n">_lct</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span>
<span class="n">_lcch</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">]]</span>
<span class="n">_lclbd</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">]]</span>
<span class="n">_lcm</span> <span class="o">=</span> <span class="n">_lclbd</span>
<span class="n">_cbck</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">_dmarker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}</span>


<div class="viewcode-block" id="Data_plot"><a class="viewcode-back" href="../../../tofu.data.html#tofu.data._plot.Data_plot">[docs]</a><span class="k">def</span> <span class="nf">Data_plot</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indref</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">vmin_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">ntMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nlbdMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">inclbd</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span>
              <span class="n">lls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lclbd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">fmt_l</span><span class="o">=</span><span class="s1">&#39;07.3f&#39;</span><span class="p">,</span>
              <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="n">dmarker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharelamb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>


    <span class="c1"># ------------------</span>
    <span class="c1"># Preliminary checks</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">lData</span> <span class="o">=</span> <span class="p">[</span><span class="n">lData</span><span class="p">]</span>

    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">_is2D</span><span class="p">()</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_is2D</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All Data objects must be either 1D or 2D, not mixed !</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    (check on self._is2D())&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">_isSpectral</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All Data should be either spectral or non-spectral !</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    (check self._isSpectral())&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">nD</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_is2D</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="n">nD</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Compare not implemented for more than 2 CamLOS2D yet!&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cases with indtX != None not properly handled yet !&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># ------------------</span>
    <span class="c1"># Input formatting</span>
    <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">_fontsize</span>
    <span class="k">if</span> <span class="n">ntMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ntMax</span> <span class="o">=</span> <span class="n">_ntMax</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ntMax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ntMax</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nchMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nchMax</span> <span class="o">=</span> <span class="n">_nchMax</span>
    <span class="k">if</span> <span class="n">cmap_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>
    <span class="k">if</span> <span class="n">labelpad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labelpad</span> <span class="o">=</span> <span class="n">_labelpad</span>
    <span class="k">if</span> <span class="n">lct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lct</span> <span class="o">=</span> <span class="n">_lct</span>
    <span class="k">if</span> <span class="n">lcch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lcch</span> <span class="o">=</span> <span class="n">_lcch</span>
    <span class="k">if</span> <span class="n">lclbd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lclbd</span> <span class="o">=</span> <span class="n">_lclbd</span>
    <span class="k">if</span> <span class="n">lls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lls</span> <span class="o">=</span> <span class="n">_lls</span>
    <span class="k">if</span> <span class="n">cbck</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbck</span> <span class="o">=</span> <span class="n">_cbck</span>
    <span class="k">if</span> <span class="n">dmarker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmarker</span> <span class="o">=</span> <span class="n">_dmarker</span>

    <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_isSpectral</span><span class="p">():</span>
        <span class="n">nchMax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nchMax</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Colormap</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Option cmap=&#39;touch&#39; will be available in future releases  :-)&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


    <span class="c1"># ------------------</span>
    <span class="c1"># Plot</span>
    <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_isSpectral</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot compare more than 2 DataCam2DSpectral instances !&quot;</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ntMax</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">kh</span> <span class="o">=</span> <span class="n">_DataCam12D_plot_spectral</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                       <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">nlbdMax</span><span class="o">=</span><span class="n">nlbdMax</span><span class="p">,</span>
                                       <span class="n">indref</span><span class="o">=</span><span class="n">indref</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="n">bck</span><span class="p">,</span> <span class="n">lls</span><span class="o">=</span><span class="n">lls</span><span class="p">,</span>
                                       <span class="n">lct</span><span class="o">=</span><span class="n">lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">lcch</span><span class="p">,</span> <span class="n">lclbd</span><span class="o">=</span><span class="n">lclbd</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span>
                                       <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                       <span class="n">tit</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span>
                                       <span class="n">inct</span><span class="o">=</span><span class="n">inct</span><span class="p">,</span> <span class="n">incX</span><span class="o">=</span><span class="n">incX</span><span class="p">,</span> <span class="n">inclbd</span><span class="o">=</span><span class="n">inclbd</span><span class="p">,</span>
                                       <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                                       <span class="n">vmin_map</span><span class="o">=</span><span class="n">vmin_map</span><span class="p">,</span> <span class="n">vmax_map</span><span class="o">=</span><span class="n">vmax_map</span><span class="p">,</span>
                                       <span class="n">cmap_map</span><span class="o">=</span><span class="n">cmap_map</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="n">normt_map</span><span class="p">,</span>
                                       <span class="n">fmt_t</span><span class="o">=</span><span class="n">fmt_t</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="n">fmt_X</span><span class="p">,</span> <span class="n">fmt_l</span><span class="o">=</span><span class="n">fmt_l</span><span class="p">,</span>
                                       <span class="n">dmarker</span><span class="o">=</span><span class="n">dmarker</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                                       <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span>
                                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="n">connect</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">,</span>
                                       <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span> <span class="n">sharelamb</span><span class="o">=</span><span class="n">sharelamb</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">kh</span> <span class="o">=</span> <span class="n">_DataCam12D_plot</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indref</span><span class="o">=</span><span class="n">indref</span><span class="p">,</span>
                              <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">inct</span><span class="o">=</span><span class="n">inct</span><span class="p">,</span> <span class="n">incX</span><span class="o">=</span><span class="n">incX</span><span class="p">,</span>
                              <span class="n">bck</span><span class="o">=</span><span class="n">bck</span><span class="p">,</span> <span class="n">lls</span><span class="o">=</span><span class="n">lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">lcch</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                              <span class="n">cmap_map</span><span class="o">=</span><span class="n">cmap_map</span><span class="p">,</span> <span class="n">vmin_map</span><span class="o">=</span><span class="n">vmin_map</span><span class="p">,</span>
                              <span class="n">vmax_map</span><span class="o">=</span><span class="n">vmax_map</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="n">normt_map</span><span class="p">,</span>
                              <span class="n">fmt_t</span><span class="o">=</span><span class="n">fmt_t</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="n">fmt_X</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">,</span>
                              <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span> <span class="n">dmarker</span><span class="o">=</span><span class="n">dmarker</span><span class="p">,</span>
                              <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span>
                              <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="n">connect</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kh</span></div>



<div class="viewcode-block" id="Data_plot_combine"><a class="viewcode-back" href="../../../tofu.data.html#tofu.data._plot.Data_plot_combine">[docs]</a><span class="k">def</span> <span class="nf">Data_plot_combine</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indref</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">vmin_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">ntMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nlbdMax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
              <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">inclbd</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span>
              <span class="n">lls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lclbd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="n">dmarker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>


    <span class="c1"># ------------------</span>
    <span class="c1"># Preliminary checks</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">lData</span> <span class="o">=</span> <span class="p">[</span><span class="n">lData</span><span class="p">]</span>

    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">_isSpectral</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Only provide non-spectral Data !</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    (check self._isSpectral()&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cases with indtX != None not properly handled yet !&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">lis2D</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">_is2D</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>

    <span class="c1"># ------------------</span>
    <span class="c1"># Input formatting</span>
    <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">_fontsize</span>
    <span class="k">if</span> <span class="n">ntMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ntMax</span> <span class="o">=</span> <span class="n">_ntMax</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">lis2D</span><span class="p">):</span>
        <span class="n">ntMax</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">nchMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nchMax</span> <span class="o">=</span> <span class="n">_nchMax</span>
    <span class="k">if</span> <span class="n">cmap_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>
    <span class="k">if</span> <span class="n">labelpad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labelpad</span> <span class="o">=</span> <span class="n">_labelpad</span>
    <span class="k">if</span> <span class="n">lct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lct</span> <span class="o">=</span> <span class="n">_lct</span>
    <span class="k">if</span> <span class="n">lcch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lcch</span> <span class="o">=</span> <span class="n">_lcch</span>
    <span class="k">if</span> <span class="n">lclbd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lctlbd</span> <span class="o">=</span> <span class="n">_lclbd</span>
    <span class="k">if</span> <span class="n">lls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lls</span> <span class="o">=</span> <span class="n">_lls</span>
    <span class="k">if</span> <span class="n">cbck</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbck</span> <span class="o">=</span> <span class="n">_cbck</span>
    <span class="k">if</span> <span class="n">dmarker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmarker</span> <span class="o">=</span> <span class="n">_dmarker</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Colormap</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Option cmap=&#39;touch&#39; will be available in future releases  :-)&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># ------------------</span>
    <span class="c1"># Plot</span>
    <span class="n">kh</span> <span class="o">=</span> <span class="n">_DataCam12D_plot_combine</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">lis2D</span><span class="o">=</span><span class="n">lis2D</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indref</span><span class="o">=</span><span class="n">indref</span><span class="p">,</span>
                                  <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">inct</span><span class="o">=</span><span class="n">inct</span><span class="p">,</span> <span class="n">incX</span><span class="o">=</span><span class="n">incX</span><span class="p">,</span>
                                  <span class="n">bck</span><span class="o">=</span><span class="n">bck</span><span class="p">,</span> <span class="n">lls</span><span class="o">=</span><span class="n">lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">lcch</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                                  <span class="n">cmap_map</span><span class="o">=</span><span class="n">cmap_map</span><span class="p">,</span> <span class="n">vmin_map</span><span class="o">=</span><span class="n">vmin_map</span><span class="p">,</span>
                                  <span class="n">vmax_map</span><span class="o">=</span><span class="n">vmax_map</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="n">normt_map</span><span class="p">,</span>
                                  <span class="n">fmt_t</span><span class="o">=</span><span class="n">fmt_t</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="n">fmt_X</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">,</span>
                                  <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span> <span class="n">dmarker</span><span class="o">=</span><span class="n">dmarker</span><span class="p">,</span>
                                  <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span>
                                  <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span>
                                  <span class="n">connect</span><span class="o">=</span><span class="n">connect</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kh</span></div>


<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#               Plot data</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>


<span class="k">def</span> <span class="nf">_init_DataCam12D</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span>
                     <span class="n">nchMax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nDat</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Figure</span>
    <span class="n">axCol</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_figuresize</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">fsdef</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">fs1D</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dmargin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmargin</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">dmargin1D</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">axCol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">wintit</span><span class="p">)</span>

    <span class="c1"># Axes</span>
    <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">dmargin</span><span class="p">)</span>
    <span class="n">Laxt</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
    <span class="n">Laxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">3</span><span class="p">:,:</span><span class="mi">2</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">Laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nDat</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntMax</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">nDat</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntMax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
            <span class="n">Laxp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                        <span class="n">sharex</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">nDat</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ntMax</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
            <span class="n">Laxp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                        <span class="n">sharex</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
            <span class="n">Laxp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                     <span class="n">sharex</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                     <span class="n">sharex</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span><span class="mi">3</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                     <span class="n">sharex</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="c1"># Do not specify datalim due to both axis shared (depends on</span>
            <span class="c1"># matplotlib version)</span>
            <span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">axH</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>

    <span class="c1"># Text</span>
    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">DY</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Ytxt</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DX</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">axtxtch</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">),</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DX</span> <span class="o">=</span> <span class="n">Laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">axtxtt</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="o">+</span><span class="mf">0.2</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">),</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span>
    <span class="n">axtxtg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># dax</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="n">Laxt</span><span class="p">,</span>
           <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">Laxp</span><span class="p">,</span>
           <span class="s1">&#39;cross&#39;</span><span class="p">:[</span><span class="n">axC</span><span class="p">],</span>
           <span class="s1">&#39;hor&#39;</span><span class="p">:[</span><span class="n">axH</span><span class="p">],</span>
           <span class="s1">&#39;txtg&#39;</span><span class="p">:[</span><span class="n">axtxtg</span><span class="p">],</span>
           <span class="s1">&#39;txtx&#39;</span><span class="p">:[</span><span class="n">axtxtch</span><span class="p">],</span>
           <span class="s1">&#39;txtt&#39;</span><span class="p">:[</span><span class="n">axtxtt</span><span class="p">]}</span>

    <span class="c1"># Format all axes</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dax</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">])):</span>
            <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;txt&#39;</span> <span class="ow">in</span> <span class="n">kk</span><span class="p">:</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">]:</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([]),</span> <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>  <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dax</span>



<span class="k">def</span> <span class="nf">_DataCam12D_plot</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="n">_nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">_ntMax</span><span class="p">,</span>
                     <span class="n">indref</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lls</span><span class="o">=</span><span class="n">_lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">_lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">_lcch</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">_cbck</span><span class="p">,</span>
                     <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                     <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">vmin_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">cmap_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">dmarker</span><span class="o">=</span><span class="n">_dmarker</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="n">_fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">_labelpad</span><span class="p">,</span>
                     <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>



    <span class="c1">#########</span>
    <span class="c1"># Prepare</span>
    <span class="c1">#########</span>
    <span class="n">fldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">)</span>

    <span class="c1"># Use tuple unpacking to make sure indref is 0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">indref</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lData</span><span class="p">[</span><span class="n">indref</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">indref</span><span class="p">],</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nDat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">)</span>

    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">all</span><span class="p">([</span><span class="n">dd</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
          <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All Data objects do not have the same:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    dlabels[&#39;t&#39;], dlabels[&#39;X&#39;] and dlabels[&#39;data&#39;] !&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


    <span class="c1"># ---------</span>
    <span class="c1"># Get time</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">t</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nt</span>
    <span class="k">if</span> <span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.001</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">])</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Dt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Dt</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">tlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="n">lidt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">]</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check nch and X</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">nch</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nch</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;All Data objects must have the same nb. of channels</span><span class="se">\n</span><span class="s2">&quot;</span>
               <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">- self.nch: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="n">dd</span><span class="o">.</span><span class="n">nch</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">])</span>
               <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  =&gt; use self.set_indch()&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">nch</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nch</span>

    <span class="c1">#X, nch, nnch, indtX = lData[0][&#39;X&#39;], lData[0][&#39;nch&#39;], lData[0][&#39;nnch&#39;], lData[0][&#39;indtX&#39;]</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">X</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">X</span><span class="p">)]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">])</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">DX</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">DX</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">Xlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                   <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>

        <span class="n">lXtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;x1&#39;</span>
                  <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
        <span class="n">lXother</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                   <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
        <span class="n">lindtX</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
                   <span class="k">else</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">])</span>
                  <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;DataCam2D cannot have nnch &gt; 1 !&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All DataCam2D objects must have indtX is None !&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">all</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)])</span>
              <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">c0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All DataCam2D must have the same (x1,x2,indr,extent) !</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    Check x1, x2, indr, extent = self.get_X12plot(&#39;imshow&#39;)&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">indr</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
            <span class="n">indbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">idx12</span> <span class="o">=</span> <span class="nb">id</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">))</span>
        <span class="n">n12</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="c1"># Other</span>
        <span class="n">lXtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nDat</span>
        <span class="n">lXother</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">nDat</span>
        <span class="n">lindtX</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">nDat</span>

    <span class="n">lX</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lidX</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">lX</span><span class="p">]</span>

    <span class="c1"># dchans</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dchans</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">idchans</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dchans</span><span class="p">)</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check data</span>
    <span class="n">ldata</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">indany</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dat</span><span class="p">))</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">indany</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ldata</span><span class="p">)</span>
                           <span class="k">if</span> <span class="n">indany</span><span class="p">[</span><span class="n">ii</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ldata</span><span class="p">)</span>
                           <span class="k">if</span> <span class="n">indany</span><span class="p">[</span><span class="n">ii</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="n">Dlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)]</span>
    <span class="n">Dd</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">),</span> <span class="n">Dlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">)]</span>
    <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">liddata</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">nan2_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span><span class="p">:</span>
            <span class="n">lcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_get_touchcols</span><span class="p">(</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                <span class="n">cdef</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span>
                <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
            <span class="c1"># To be finished</span>

    <span class="k">if</span> <span class="n">vmin_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmin_map</span> <span class="o">=</span> <span class="n">vmin</span>
    <span class="k">if</span> <span class="n">vmax_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmax_map</span> <span class="o">=</span> <span class="n">vmax</span>


    <span class="c1"># ---------</span>
    <span class="c1"># Extra</span>
    <span class="n">lkex</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                               <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)</span>
                                               <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">is</span> <span class="ow">not</span>
                                               <span class="kc">None</span><span class="p">])))</span>
    <span class="n">dEq_corres</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;sep&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k0</span> <span class="ow">in</span> <span class="n">dEq_corres</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">lkEq_temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">kk</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">lkex</span>
                              <span class="k">if</span> <span class="n">k0</span> <span class="o">==</span> <span class="n">kk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lkEq_temp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lkEq_temp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dEq_corres</span><span class="p">[</span><span class="n">k0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lkEq_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k0</span> <span class="ow">in</span> <span class="n">dmarker</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dmarker</span><span class="p">[</span><span class="n">lkEq_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmarker</span><span class="p">[</span><span class="n">k0</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">dmarker</span><span class="p">[</span><span class="n">k0</span><span class="p">]</span>

    <span class="n">lkEq</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">vv</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">dEq_corres</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">vv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">kSep</span> <span class="o">=</span> <span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;sep&#39;</span><span class="p">]</span>
    <span class="n">lkEqmap</span> <span class="o">=</span> <span class="n">lkEq</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>

    <span class="n">dlextra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lkEqmap</span><span class="p">])</span>
    <span class="n">dteq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ii</span><span class="p">,{})</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEqmap</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">idteq</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">idteq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># test if any existing t matches values</span>
                    <span class="n">lidalready</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k1</span> <span class="k">for</span> <span class="n">k1</span><span class="p">,</span><span class="n">v1</span> <span class="ow">in</span> <span class="n">v0</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                   <span class="k">if</span> <span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
                                       <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]))]</span>
                                  <span class="k">for</span> <span class="n">v0</span> <span class="ow">in</span> <span class="n">dteq</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                    <span class="n">lidalready</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)))</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">idteq</span> <span class="o">=</span> <span class="n">lidalready</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">idteq</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
                <span class="n">idteq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">kk</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                        <span class="k">if</span> <span class="ow">not</span> <span class="n">kk</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">])</span>
                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">])</span>
                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idteq</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]]</span>
                    <span class="ow">and</span> <span class="s1">&#39;marker&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmarker</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Several distinct time bases in self.dextra for:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    - lData[</span><span class="si">%s</span><span class="s2">]: </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;        - &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        - &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lkEqmap</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>



    <span class="c1">#########</span>
    <span class="c1"># Plot</span>
    <span class="c1">#########</span>

    <span class="c1"># Format axes</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="n">_init_DataCam12D</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                        <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">,</span> <span class="n">nDat</span><span class="o">=</span><span class="n">nDat</span><span class="p">)</span>
    <span class="n">fig</span>  <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0:05.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">))</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>


    <span class="c1"># -----------------</span>
    <span class="c1"># Plot conf and bck</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span> <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                             <span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span>
                                             <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
        <span class="k">if</span> <span class="n">c1</span> <span class="ow">and</span> <span class="s1">&#39;LOS&#39;</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span><span class="p">,</span> <span class="n">llab</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]:</span>
                <span class="n">lCross</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                                        <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">lHor</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span>
                                      <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bck</span> <span class="ow">and</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                                <span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crossbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                              <span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">horbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crossbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crossbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">horbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">horbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">bck</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="n">element</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                  <span class="n">dL</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
                                  <span class="n">wintit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

            <span class="n">lHor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
            <span class="n">idlCross</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lCross</span><span class="p">)</span>
            <span class="n">idlHor</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Background (optional)</span>
    <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lX</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
            <span class="n">tbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">nch</span><span class="p">)</span>
            <span class="n">dbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ldata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">nch</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tbck</span><span class="p">,</span> <span class="n">dbck</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                     <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>

    <span class="c1"># Static extra (time traces)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">lk</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lkEqmap</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">lk</span><span class="p">:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">co</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;k&#39;</span>
                        <span class="n">lab</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                         <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">co</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>

    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.01</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;expand&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="n">fontsize</span><span class="p">})</span>


    <span class="c1"># ---------------</span>
    <span class="c1"># Lims and labels</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Dt</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dd</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">tlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">DX</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Xlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


    <span class="c1">##################</span>
    <span class="c1"># Interactivity dict</span>

    <span class="n">dgroup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>      <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">ntMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]},</span>
              <span class="s1">&#39;channel&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nchMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]}}</span>

    <span class="c1"># Group info (make dynamic in later versions ?)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dgroup</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>


    <span class="c1"># dref</span>
    <span class="n">dref</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">}</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incX</span><span class="p">,</span>
                          <span class="s1">&#39;otherid&#39;</span><span class="p">:</span><span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;indother&#39;</span><span class="p">:</span><span class="n">lindtX</span><span class="p">[</span><span class="n">ii</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dref</span><span class="p">[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="s1">&#39;2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idteq</span><span class="p">,</span> <span class="n">teq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">idteq</span><span class="p">,</span> <span class="n">teq</span> <span class="o">=</span> <span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dref</span><span class="p">[</span><span class="n">idteq</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">teq</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">}</span>


    <span class="c1"># ddata</span>
    <span class="n">ddat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]})</span>
                 <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span>
    <span class="n">ddat</span><span class="p">[</span><span class="n">idchans</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dchans</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>
    <span class="k">if</span> <span class="n">lCross</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlCross</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lCross</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlHor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lHor</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idx12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>

    <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEq</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">dlextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">ddat</span><span class="p">[</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">],</span>
                                              <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}</span>

    <span class="c1"># dax</span>
    <span class="n">lax_fix</span> <span class="o">=</span> <span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">dax2</span> <span class="o">=</span> <span class="p">{</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">([(</span><span class="n">idt</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">idt</span> <span class="ow">in</span> <span class="n">lidt</span><span class="p">]),</span>
                          <span class="s1">&#39;graph&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="s1">&#39;x&#39;</span><span class="p">}},</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{},</span>
                          <span class="s1">&#39;graph&#39;</span><span class="p">:{}}}</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ref&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;graph&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>

    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">([(</span><span class="n">idX</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">idX</span> <span class="ow">in</span> <span class="n">lidX</span><span class="p">]),</span>
                                   <span class="s1">&#39;graph&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="s1">&#39;x&#39;</span><span class="p">}}})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">*</span><span class="n">ntMax</span><span class="o">+</span><span class="n">jj</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span><span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">}</span>

    <span class="n">dobj</span> <span class="o">=</span> <span class="p">{}</span>



    <span class="c1">##################</span>
    <span class="c1"># Populating dobj</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot and one-time 2D map</span>
    <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">map_</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">normt_map</span><span class="p">:</span>
            <span class="n">map_</span> <span class="o">=</span> <span class="n">map_</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">map_</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:]</span>
        <span class="n">vmin_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">map_</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmin_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmin_map</span>
        <span class="n">vmax_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">map_</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmax_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmax_map</span>
        <span class="n">norm_map</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin_map</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_map</span><span class="p">)</span>
        <span class="n">nan2_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">map_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2_map</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                    <span class="n">extent</span><span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;extent&#39;</span><span class="p">],</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_map</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_map</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]:</span><span class="mi">0</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot channels</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

        <span class="c1"># Channel text</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">nchMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idchans</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_X</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
        <span class="c1"># los</span>
        <span class="k">if</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                      <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlCross</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlHor</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot time</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
        <span class="c1"># Time txt</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">ntMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">} s&#39;</span><span class="o">%</span><span class="n">fmt_t</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>


    <span class="c1"># -------------</span>
    <span class="c1"># Data-specific</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>

        <span class="c1"># Time</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>

            <span class="c1"># Time vlines</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])):</span>
                <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Time data profiles</span>
            <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lX</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nch</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                       <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                <span class="k">if</span> <span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">*</span><span class="n">ntMax</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
                    <span class="n">nan2_data</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">n12</span><span class="p">,</span>
                                                       <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Time equilibrium and map</span>
            <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEq</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">id_</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="n">idt</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">kk</span> <span class="o">==</span> <span class="n">kSep</span><span class="p">:</span>
                        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                   <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                   <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">marker</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                   <span class="n">mec</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                   <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">id_</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>


        <span class="c1"># Channel</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

            <span class="c1"># Channel time trace</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                   <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Channel vlines or pixels</span>
            <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                        <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">,</span> <span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">}}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                    <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">*</span><span class="n">ntMax</span><span class="o">+</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                 <span class="n">mec</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                                                 <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="c1"># Here we put lidX[0] because all have the same (and it</span>
                    <span class="c1"># avoids overdefining ddat[idx12]</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idx12</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>


    <span class="c1">##################</span>
    <span class="c1"># Instanciate KeyHandler</span>
    <span class="n">can</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
    <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">kh</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">KeyHandler_mpl</span><span class="p">(</span><span class="n">can</span><span class="o">=</span><span class="n">can</span><span class="p">,</span>
                              <span class="n">dgroup</span><span class="o">=</span><span class="n">dgroup</span><span class="p">,</span> <span class="n">dref</span><span class="o">=</span><span class="n">dref</span><span class="p">,</span> <span class="n">ddata</span><span class="o">=</span><span class="n">ddat</span><span class="p">,</span>
                              <span class="n">dobj</span><span class="o">=</span><span class="n">dobj</span><span class="p">,</span> <span class="n">dax</span><span class="o">=</span><span class="n">dax2</span><span class="p">,</span> <span class="n">lax_fix</span><span class="o">=</span><span class="n">lax_fix</span><span class="p">,</span>
                              <span class="n">groupinit</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">disconnect_old</span><span class="p">()</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">kh</span>




<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#               Plot data spectral</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>


<span class="k">def</span> <span class="nf">_init_DataCam12D_spectral</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharelamb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span>
                              <span class="n">nchMax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">nch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nDat</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Figure</span>
    <span class="n">axCol</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_figuresize</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">fsdef</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">fs1D</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dmargin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmargin</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span>
                       <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">axCol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">wintit</span><span class="p">)</span>

    <span class="c1"># -------------</span>
    <span class="c1"># Axes grid</span>
    <span class="c1"># -------</span>

    <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">dmargin</span><span class="p">)</span>

    <span class="c1"># time</span>
    <span class="k">if</span> <span class="n">nch</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nchMax</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axH</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">axC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">laxt</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">4</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
        <span class="n">laxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">laxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">8</span><span class="p">:,:</span><span class="mi">2</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axH</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">axC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">laxt</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
        <span class="n">laxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">shy</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">sharey</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">laxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                    <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">shy</span><span class="p">))</span>
        <span class="n">laxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">9</span><span class="p">:,:</span><span class="mi">2</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># lambda and profiles</span>
    <span class="k">if</span> <span class="n">nch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">laxp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">laxl</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="k">elif</span> <span class="n">nchMax</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">laxl</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">shy</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">8</span><span class="p">:,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">shy</span><span class="p">)]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">laxl</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">nchMax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">shl</span> <span class="o">=</span> <span class="n">laxl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">sharelamb</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">laxl</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                     <span class="n">sharex</span><span class="o">=</span><span class="n">shl</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
        <span class="n">shy</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ntMax</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">nDat</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">9</span><span class="p">:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">shy</span><span class="p">)]</span>
            <span class="n">laxp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">9</span><span class="p">:,</span><span class="mi">3</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                     <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">9</span><span class="p">:,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">shy</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">laxp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="ow">and</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
        <span class="n">ax_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">laxcb</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">laxcb</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">axC</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>

    <span class="c1"># -------------</span>
    <span class="c1"># txt axes</span>
    <span class="c1"># -------</span>

    <span class="n">DX0</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">DY0</span> <span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">DX1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">laxl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">DY1</span> <span class="o">=</span> <span class="n">laxl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># text ch</span>
    <span class="k">if</span> <span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">laxl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">laxtxtch</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX1</span><span class="p">,</span> <span class="n">DY1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">nchMax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">laxtxtch</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX1</span><span class="p">,</span> <span class="n">DY1</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">laxtxtch</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># text t</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">laxl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">laxtxtt</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX0</span><span class="p">,</span> <span class="n">DY0</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">nchMax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">laxtxtt</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX0</span><span class="p">,</span> <span class="n">DY0</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">laxtxtt</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX0</span><span class="p">,</span> <span class="n">DY0</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>

    <span class="c1"># text lambda</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">laxtxtl</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX0</span><span class="p">,</span> <span class="n">DY0</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">nchMax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">laxtxtl</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX0</span><span class="p">,</span> <span class="n">DY0</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">laxtxtl</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX0</span><span class="p">,</span> <span class="n">DY0</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)]</span>

    <span class="c1"># text group</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">DY0</span>
    <span class="n">axtxtg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY0</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>


    <span class="c1"># -------------</span>
    <span class="c1"># format output</span>
    <span class="c1"># -------</span>

    <span class="c1"># dax</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="n">laxt</span><span class="p">,</span>
           <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">laxp</span><span class="p">,</span>
           <span class="s1">&#39;lamb&#39;</span><span class="p">:</span><span class="n">laxl</span><span class="p">,</span>
           <span class="s1">&#39;cross&#39;</span><span class="p">:[</span><span class="n">axC</span><span class="p">],</span>
           <span class="s1">&#39;hor&#39;</span><span class="p">:[</span><span class="n">axH</span><span class="p">],</span>
           <span class="s1">&#39;txtg&#39;</span><span class="p">:[</span><span class="n">axtxtg</span><span class="p">],</span>
           <span class="s1">&#39;txtx&#39;</span><span class="p">:</span><span class="n">laxtxtch</span><span class="p">,</span>
           <span class="s1">&#39;txtl&#39;</span><span class="p">:</span><span class="n">laxtxtl</span><span class="p">,</span>
           <span class="s1">&#39;txtt&#39;</span><span class="p">:</span><span class="n">laxtxtt</span><span class="p">}</span>

    <span class="c1"># Format all axes</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dax</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">])):</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;txt&#39;</span> <span class="ow">in</span> <span class="n">kk</span><span class="p">:</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">]:</span>
                        <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([]),</span> <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>  <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dax</span>



<span class="k">def</span> <span class="nf">_DataCam12D_plot_spectral</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">nchMax</span><span class="o">=</span><span class="n">_nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">_ntMax</span><span class="p">,</span> <span class="n">nlbdMax</span><span class="o">=</span><span class="n">_nlbdMax</span><span class="p">,</span>
                              <span class="n">indref</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lls</span><span class="o">=</span><span class="n">_lls</span><span class="p">,</span>
                              <span class="n">lct</span><span class="o">=</span><span class="n">_lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">_lcch</span><span class="p">,</span> <span class="n">lclbd</span><span class="o">=</span><span class="n">_lclbd</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">_cbck</span><span class="p">,</span>
                              <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                              <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">inclbd</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">vmin_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">cmap_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">fmt_l</span><span class="o">=</span><span class="s1">&#39;07.3f&#39;</span><span class="p">,</span> <span class="n">dmarker</span><span class="o">=</span><span class="n">_dmarker</span><span class="p">,</span>
                              <span class="n">fontsize</span><span class="o">=</span><span class="n">_fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">_labelpad</span><span class="p">,</span>
                              <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharelamb</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>



    <span class="c1">#########</span>
    <span class="c1"># Prepare</span>
    <span class="c1">#########</span>
    <span class="n">fldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">)</span>

    <span class="c1"># Use tuple unpacking to make sure indref is 0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">indref</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lData</span><span class="p">[</span><span class="n">indref</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">indref</span><span class="p">],</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nDat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">)</span>

    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">all</span><span class="p">([</span><span class="n">dd</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
          <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;lamb&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All Data objects must have the same:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    dlabels[k], for k in [&#39;t&#39;,&#39;X&#39;,&#39;lambda&#39;,&#39;data&#39;] !&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


    <span class="c1"># ---------</span>
    <span class="c1"># Get time</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">t</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nt</span>
    <span class="k">if</span> <span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">])</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Dt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Dt</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">tlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="n">lidt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">]</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check nch and X</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">nch</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nch</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All Data objects must have the same number of channels (self.nch)&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You can set the indices of the channels with self.set_indch()&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">nch</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nch</span>

    <span class="c1">#X, nch, nnch, indtX = lData[0][&#39;X&#39;], lData[0][&#39;nch&#39;], lData[0][&#39;nnch&#39;], lData[0][&#39;indtX&#39;]</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">X</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">X</span><span class="p">)]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">])</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">DX</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">DX</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">Xlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                   <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>

        <span class="n">lXtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;x1&#39;</span>
                  <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
        <span class="n">lXother</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                   <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
        <span class="n">lindtX</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
                   <span class="k">else</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">])</span>
                  <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;DataCam2D cannot have nnch &gt; 1 !&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All DataCam2D objects must have indtX is None !&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">all</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)])</span>
              <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">c0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All DataCam2D must have the same (x1,x2,indr,extent) !</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    Check x1, x2, indr, extent = self.get_X12plot(&#39;imshow&#39;)&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">indr</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
            <span class="n">indbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">idx12</span> <span class="o">=</span> <span class="nb">id</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">))</span>
        <span class="n">n12</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="c1"># Other</span>
        <span class="n">lXtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nDat</span>
        <span class="n">lXother</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">nDat</span>
        <span class="n">lindtX</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">nDat</span>

    <span class="n">lX</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lidX</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">lX</span><span class="p">]</span>

    <span class="c1"># dchans</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dchans</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">idchans</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dchans</span><span class="p">)</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check nlamb and lambda</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">nlamb</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nlamb</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c0</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All Data objects must have the same number of wavelengths&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You can set the indices of lambda with self.set_indlamb()&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">nlamb</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nlamb</span>
    <span class="n">Dlamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">lamb</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">lamb</span><span class="p">)]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">])</span>
    <span class="n">Dlamb</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Dlamb</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Dlamb</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">lamblab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>

    <span class="n">llambtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnlamb&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;x1&#39;</span>
                 <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">llambother</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnlamb&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">lindXlamb</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnlamb&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
                  <span class="k">else</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indXlamb&#39;</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">llamb</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">lamb</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lidlamb</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">lamb</span><span class="p">)</span> <span class="k">for</span> <span class="n">lamb</span> <span class="ow">in</span> <span class="n">llamb</span><span class="p">]</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check data</span>
    <span class="n">ldata</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">])</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">])</span>
    <span class="n">Dlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmax</span><span class="p">)]</span>
    <span class="n">Dd</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">),</span> <span class="n">Dlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">)]</span>
    <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">liddata</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">])</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">nan2_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s1">&#39;touch&#39;</span><span class="p">:</span>
            <span class="n">lcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_get_touchcols</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cdef</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span>
                                                  <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
            <span class="c1"># To be finished</span>

    <span class="c1"># --------------</span>
    <span class="c1"># data sum</span>
    <span class="n">ldataint</span> <span class="o">=</span> <span class="p">[</span><span class="n">scpinteg</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">llamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">llambother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">scpinteg</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">][:,</span><span class="n">jj</span><span class="p">,:],</span>
                                               <span class="n">x</span><span class="o">=</span><span class="n">llamb</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">liddataint</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">ldataint</span><span class="p">]</span>
    <span class="n">Dintlab</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
               <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">Dintlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\int_{\lambda}$</span><span class="si">%s</span><span class="s2"> ($\int_{\lambda}$</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">Dintlab</span>




    <span class="c1"># ---------</span>
    <span class="c1"># Extra</span>
    <span class="n">lkex</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                               <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)</span>
                                               <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">is</span> <span class="ow">not</span>
                                               <span class="kc">None</span><span class="p">])))</span>
    <span class="n">dEq_corres</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;sep&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k0</span> <span class="ow">in</span> <span class="n">dEq_corres</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">lkEq_temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">kk</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">lkex</span>
                              <span class="k">if</span> <span class="n">k0</span> <span class="o">==</span> <span class="n">kk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lkEq_temp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lkEq_temp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dEq_corres</span><span class="p">[</span><span class="n">k0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lkEq_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k0</span> <span class="ow">in</span> <span class="n">dmarker</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dmarker</span><span class="p">[</span><span class="n">lkEq_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmarker</span><span class="p">[</span><span class="n">k0</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">dmarker</span><span class="p">[</span><span class="n">k0</span><span class="p">]</span>

    <span class="n">lkEq</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">vv</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">dEq_corres</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">vv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">kSep</span> <span class="o">=</span> <span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;sep&#39;</span><span class="p">]</span>
    <span class="n">lkEqmap</span> <span class="o">=</span> <span class="n">lkEq</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>

    <span class="n">dlextra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lkEqmap</span><span class="p">])</span>
    <span class="n">dteq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ii</span><span class="p">,{})</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEqmap</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">idteq</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">idteq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># test if any existing t matches values</span>
                    <span class="n">lidalready</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k1</span> <span class="k">for</span> <span class="n">k1</span><span class="p">,</span><span class="n">v1</span> <span class="ow">in</span> <span class="n">v0</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                   <span class="k">if</span> <span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
                                       <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]))]</span>
                                  <span class="k">for</span> <span class="n">v0</span> <span class="ow">in</span> <span class="n">dteq</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                    <span class="n">lidalready</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)))</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">idteq</span> <span class="o">=</span> <span class="n">lidalready</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">idteq</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
                <span class="n">idteq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">kk</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                        <span class="k">if</span> <span class="ow">not</span> <span class="n">kk</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">])</span>
                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">])</span>
                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idteq</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">],</span><span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]]</span>
                    <span class="ow">and</span> <span class="s1">&#39;marker&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmarker</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Several distinct time bases in self.dextra for:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    - lData[</span><span class="si">%s</span><span class="s2">]: </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;        - &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        - &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lkEqmap</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


    <span class="c1">#########</span>
    <span class="c1"># Plot</span>
    <span class="c1">#########</span>

    <span class="c1"># Format axes</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="n">_init_DataCam12D_spectral</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span>
                                    <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span> <span class="n">sharelamb</span><span class="o">=</span><span class="n">sharelamb</span><span class="p">,</span>
                                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                    <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span> <span class="n">nch</span><span class="o">=</span><span class="n">nch</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">,</span>
                                    <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">nDat</span><span class="o">=</span><span class="n">nDat</span><span class="p">)</span>
    <span class="n">fig</span>  <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0:05.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">))</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>


    <span class="c1"># -----------------</span>
    <span class="c1"># Plot conf and bck</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span> <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                             <span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                             <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
        <span class="k">if</span> <span class="n">c1</span> <span class="ow">and</span> <span class="s1">&#39;LOS&#39;</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span><span class="p">,</span> <span class="n">llab</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]:</span>
                <span class="n">lCross</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                                        <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">lHor</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span>
                                      <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bck</span> <span class="ow">and</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                                <span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crossbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                              <span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">horbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crossbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crossbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">horbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">horbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                       <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">bck</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="n">element</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                  <span class="n">dL</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
                                  <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

            <span class="n">lHor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
            <span class="n">idlCross</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lCross</span><span class="p">)</span>
            <span class="n">idlHor</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Background (optional)</span>
    <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ldataint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ldataint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lX</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
            <span class="n">tbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">nch</span><span class="p">)</span>
            <span class="n">dbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ldataint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">nch</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tbck</span><span class="p">,</span> <span class="n">dbck</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ldataint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ldataint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>

    <span class="c1"># Static extra (time traces)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">lk</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lkEqmap</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">lk</span><span class="p">:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">co</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;k&#39;</span>
                    <span class="n">lab</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                     <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">co</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>

    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.01</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;expand&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="n">fontsize</span><span class="p">})</span>


    <span class="c1"># ---------------</span>
    <span class="c1"># Lims and labels</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Dt</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dd</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dintlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">tlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Dlamb</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">lamblab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nchMax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sharey</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">DX</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Xlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


    <span class="c1">##################</span>
    <span class="c1"># Interactivity dict</span>

    <span class="n">dgroup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>      <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">ntMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]}}</span>

    <span class="k">if</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">dgroup</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nchMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span>

    <span class="n">dgroup</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nlbdMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dgroup</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                        <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span>

    <span class="c1"># Group info (make dynamic in later versions ?)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dgroup</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

    <span class="c1"># dref</span>
    <span class="n">dref</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">}</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incX</span><span class="p">,</span>
                          <span class="s1">&#39;otherid&#39;</span><span class="p">:</span><span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;indother&#39;</span><span class="p">:</span><span class="n">lindtX</span><span class="p">[</span><span class="n">ii</span><span class="p">]}</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">llamb</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inclbd</span><span class="p">,</span>
                             <span class="s1">&#39;otherid&#39;</span><span class="p">:</span><span class="n">llambother</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;indother&#39;</span><span class="p">:</span><span class="n">lindXlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dref</span><span class="p">[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="s1">&#39;2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idteq</span><span class="p">,</span> <span class="n">teq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">idteq</span><span class="p">,</span> <span class="n">teq</span> <span class="o">=</span> <span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dref</span><span class="p">[</span><span class="n">idteq</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">teq</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">}</span>




    <span class="c1"># ddata</span>
    <span class="n">ddat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]]})</span>
                 <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span>
    <span class="n">ddat</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">liddataint</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">ldataint</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                        <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]})</span>
                 <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]))</span>
    <span class="n">ddat</span><span class="p">[</span><span class="n">idchans</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dchans</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>

    <span class="k">if</span> <span class="n">lCross</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlCross</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lCross</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlHor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lHor</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idx12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>

    <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEq</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">dlextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">ddat</span><span class="p">[</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">],</span>
                                              <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}</span>

    <span class="c1"># dax</span>
    <span class="n">lax_fix</span> <span class="o">=</span> <span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">]</span>
               <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtl&#39;</span><span class="p">])</span>

    <span class="n">dax2</span> <span class="o">=</span> <span class="p">{</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{},</span>
                          <span class="s1">&#39;graph&#39;</span><span class="p">:{}}}</span>
    <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">([(</span><span class="n">idt</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">idt</span> <span class="ow">in</span> <span class="n">lidt</span><span class="p">]),</span>
                                      <span class="s1">&#39;graph&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span>
                      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]))]))</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ref&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;graph&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>

    <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">([(</span><span class="n">idl</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">idl</span> <span class="ow">in</span> <span class="n">lidlamb</span><span class="p">]),</span>
                                         <span class="s1">&#39;graph&#39;</span><span class="p">:{</span><span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span>
                      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]))]))</span>

    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">([(</span><span class="n">idX</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">idX</span> <span class="ow">in</span> <span class="n">lidX</span><span class="p">]),</span>
                                   <span class="s1">&#39;graph&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="s1">&#39;x&#39;</span><span class="p">}}})</span>
    <span class="k">elif</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">*</span><span class="n">ntMax</span><span class="o">+</span><span class="n">jj</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span><span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">}</span>


    <span class="n">dobj</span> <span class="o">=</span> <span class="p">{}</span>



    <span class="c1">##################</span>
    <span class="c1"># Populating dobj</span>


    <span class="c1"># -------------</span>
    <span class="c1"># One-shot and one-time 2D map</span>
    <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">map_</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">normt_map</span><span class="p">:</span>
            <span class="n">map_</span> <span class="o">=</span> <span class="n">map_</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">map_</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:]</span>
        <span class="n">vmin_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">map_</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmin_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmin_map</span>
        <span class="n">vmax_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">map_</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmax_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmax_map</span>
        <span class="n">norm_map</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin_map</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_map</span><span class="p">)</span>
        <span class="n">nan2_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">map_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2_map</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                    <span class="n">extent</span><span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;extent&#39;</span><span class="p">],</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_map</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_map</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]:</span><span class="mi">0</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot channels</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

        <span class="c1"># Channel text</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                  <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idchans</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;channel {0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_X</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
        <span class="c1"># los</span>
        <span class="k">if</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                      <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlCross</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlHor</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot time</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
        <span class="c1"># Time txt</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">])):</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">ntMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                      <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                          <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">} s&#39;</span><span class="o">%</span><span class="n">fmt_t</span><span class="p">}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot lambda</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nlbdMax</span><span class="p">):</span>
        <span class="c1"># lambda txt</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
                <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtl&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">nlbdMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="n">lclbd</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                          <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">llambother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                  <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_l</span><span class="p">}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">llambother</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                  <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_l</span><span class="p">}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">llambother</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">,</span> <span class="n">lidlamb</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># Data-specific</span>

    <span class="n">nanch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nch</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">nant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">nanlamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nlamb</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="c1"># Time</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>

            <span class="c1"># Time vlines</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])):</span>
                <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Time data profiles if nch &gt; 1</span>
            <span class="k">if</span> <span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lX</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">nanch</span><span class="p">,</span>
                                           <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddataint</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                    <span class="k">if</span> <span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                        <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2_data</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                                <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                                <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddataint</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">n12</span><span class="p">,</span>
                                                           <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Time equilibrium and map</span>
            <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEq</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">id_</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="n">idt</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">kk</span> <span class="o">==</span> <span class="n">kSep</span><span class="p">:</span>
                        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                   <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                   <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">marker</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                   <span class="n">mec</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                   <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">id_</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Channel</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

            <span class="c1"># Channel time trace</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">nant</span><span class="p">,</span>
                                    <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddataint</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Channel vlines or pixels</span>
            <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                        <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">,</span> <span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">}}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                    <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">*</span><span class="n">ntMax</span><span class="o">+</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                 <span class="n">mec</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                                                 <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="c1"># Here we put lidX[0] because all have the same (and it</span>
                    <span class="c1"># avoids overdefining ddat[idx12]</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idx12</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># -------</span>
            <span class="c1"># lambda</span>
            <span class="c1"># lambda time trace</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nlbdMax</span><span class="p">):</span>
                <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">nant</span><span class="p">,</span>
                                          <span class="n">c</span><span class="o">=</span><span class="n">lclbd</span><span class="p">[</span><span class="n">ll</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">,</span> <span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">}}</span>

            <span class="c1"># lambda profile</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">llamb</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">nanlamb</span><span class="p">,</span>
                                           <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">ll</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">,</span> <span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># lambda vlines</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nlbdMax</span><span class="p">):</span>
                <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lclbd</span><span class="p">[</span><span class="n">ll</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">llambother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">}}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">,</span> <span class="n">lidlamb</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">}}</span>


    <span class="c1">##################</span>
    <span class="c1"># Instanciate KeyHandler</span>
    <span class="n">can</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
    <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">kh</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">KeyHandler_mpl</span><span class="p">(</span><span class="n">can</span><span class="o">=</span><span class="n">can</span><span class="p">,</span>
                              <span class="n">dgroup</span><span class="o">=</span><span class="n">dgroup</span><span class="p">,</span> <span class="n">dref</span><span class="o">=</span><span class="n">dref</span><span class="p">,</span> <span class="n">ddata</span><span class="o">=</span><span class="n">ddat</span><span class="p">,</span>
                              <span class="n">dobj</span><span class="o">=</span><span class="n">dobj</span><span class="p">,</span> <span class="n">dax</span><span class="o">=</span><span class="n">dax2</span><span class="p">,</span> <span class="n">lax_fix</span><span class="o">=</span><span class="n">lax_fix</span><span class="p">,</span>
                              <span class="n">groupinit</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">disconnect_old</span><span class="p">()</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">kh</span>














<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#               Plot combine</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>




<span class="k">def</span> <span class="nf">_init_DataCam12D_combine</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">fldict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">nchMax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nDat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lis2D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">nDat</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Cannot display more than 5 Data objects !&quot;</span>
    <span class="k">assert</span> <span class="n">nDat</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis2D</span><span class="p">)</span>

    <span class="n">axCol</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_figuresize</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">fsdef</span><span class="o">=</span><span class="n">_def</span><span class="o">.</span><span class="n">fs2D</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dmargin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmargin</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">dmargin_combine</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">axCol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">wintit</span><span class="p">)</span>

    <span class="c1"># Axes</span>
    <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">nDat</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">dmargin</span><span class="p">)</span>

    <span class="n">laxp</span><span class="p">,</span> <span class="n">laxc</span><span class="p">,</span> <span class="n">laxC</span><span class="p">,</span> <span class="n">laxtxtch</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Laxt</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
    <span class="n">axH</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;X ($m$)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Y ($m$)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nDat</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Laxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">ii</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">Laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">axp</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axp</span><span class="p">)</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;10%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sharex</span> <span class="ow">and</span> <span class="n">ii</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">axp</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                      <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axp</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">Laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">laxp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axp</span><span class="p">)</span>
        <span class="n">laxc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
        <span class="n">axC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">axC</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
        <span class="n">axC</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Z ($m$)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
        <span class="n">laxC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axC</span><span class="p">)</span>

        <span class="c1"># Text boxes</span>
        <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">DY</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Ytxt</span>
            <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="n">Laxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">laxtxtch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">),</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">laxC</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R ($m$)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>

    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DX</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">axtxtt</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="o">+</span><span class="mf">0.2</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">),</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span>
    <span class="n">axtxtg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># dax</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="n">Laxt</span><span class="p">,</span>
           <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">laxp</span><span class="p">,</span>
           <span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">laxC</span><span class="p">,</span>
           <span class="s1">&#39;hor&#39;</span><span class="p">:[</span><span class="n">axH</span><span class="p">],</span>
           <span class="s1">&#39;txtg&#39;</span><span class="p">:[</span><span class="n">axtxtg</span><span class="p">],</span>
           <span class="s1">&#39;txtx&#39;</span><span class="p">:</span><span class="n">laxtxtch</span><span class="p">,</span>
           <span class="s1">&#39;txtt&#39;</span><span class="p">:[</span><span class="n">axtxtt</span><span class="p">]}</span>

    <span class="c1"># Format all axes</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dax</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;txt&#39;</span> <span class="ow">in</span> <span class="n">kk</span><span class="p">:</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">]:</span>
                        <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([]),</span> <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>  <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dax</span>



<span class="k">def</span> <span class="nf">_DataCam12D_plot_combine</span><span class="p">(</span><span class="n">lData</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="n">_nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">_ntMax</span><span class="p">,</span>
                             <span class="n">indref</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lls</span><span class="o">=</span><span class="n">_lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">_lct</span><span class="p">,</span>
                             <span class="n">lcch</span><span class="o">=</span><span class="n">_lcch</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">_cbck</span><span class="p">,</span>
                             <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                             <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">vmin_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">cmap_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normt_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">dmarker</span><span class="o">=</span><span class="n">_dmarker</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="n">_fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">_labelpad</span><span class="p">,</span>
                             <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lis2D</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>


    <span class="c1">#########</span>
    <span class="c1"># Prepare</span>
    <span class="c1">#########</span>
    <span class="n">fldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">)</span>

    <span class="c1"># Use tuple unpacking to make sure indref is 0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">indref</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lData</span><span class="p">[</span><span class="n">indref</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">indref</span><span class="p">],</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nDat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">)</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Get time</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">t</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lnt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">nt</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">Dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">])</span>
    <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Dt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Dt</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">tlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="n">lidt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">]</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check nch and X</span>
    <span class="n">lnch</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">nch</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lX</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lidX</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">lX</span><span class="p">]</span>
    <span class="n">lDX</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)]</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">lX</span><span class="p">]</span>
    <span class="n">lXlab</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
             <span class="k">else</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                              <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
             <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>

    <span class="n">lnnX</span> <span class="o">=</span> <span class="p">[</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">lnnX</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No DataCam2D can have nnX &gt; 1!&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">lXtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;x1&#39;</span>
              <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">lXother</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
               <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">lindtX</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
               <span class="k">else</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">])</span>
              <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>

    <span class="n">lx1</span><span class="p">,</span> <span class="n">lx2</span><span class="p">,</span> <span class="n">lindr</span><span class="p">,</span> <span class="n">lextent</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                                     <span class="k">else</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span>
    <span class="n">lidx12</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span> <span class="k">if</span> <span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
              <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lx1</span><span class="p">,</span> <span class="n">lx2</span><span class="p">)]</span>
    <span class="n">ln12</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lx1</span><span class="p">,</span> <span class="n">lx2</span><span class="p">)]</span>


    <span class="c1"># dchans</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ldchans</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dd</span><span class="o">.</span><span class="n">nch</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ldchans</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">dchans</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lidchans</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">dchans</span><span class="p">)</span> <span class="k">for</span> <span class="n">dchans</span> <span class="ow">in</span> <span class="n">ldchans</span><span class="p">]</span>

    <span class="c1"># ---------</span>
    <span class="c1"># Check data</span>
    <span class="n">ldata</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">lvmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">]</span>
    <span class="n">lvmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">]</span>
    <span class="n">lDd</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
           <span class="k">else</span> <span class="p">(</span><span class="n">lvmin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">lvmax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">lvmin</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
                 <span class="n">lvmax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">lvmax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">lvmin</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">lDlab</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                         <span class="n">dd</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">]</span>
    <span class="n">liddata</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">]</span>

    <span class="n">lnorm</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">lvmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">lvmax</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
             <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">lnan2_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ln12</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                  <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>


    <span class="c1"># ---------</span>
    <span class="c1"># Extra</span>
    <span class="n">lkex</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                               <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)</span>
                                               <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">is</span> <span class="ow">not</span>
                                               <span class="kc">None</span><span class="p">])))</span>
    <span class="n">dEq_corres</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;sep&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k0</span> <span class="ow">in</span> <span class="n">dEq_corres</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">lkEq_temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">kk</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">lkex</span>
                              <span class="k">if</span> <span class="n">k0</span> <span class="o">==</span> <span class="n">kk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lkEq_temp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lkEq_temp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dEq_corres</span><span class="p">[</span><span class="n">k0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lkEq_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k0</span> <span class="ow">in</span> <span class="n">dmarker</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dmarker</span><span class="p">[</span><span class="n">lkEq_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmarker</span><span class="p">[</span><span class="n">k0</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">dmarker</span><span class="p">[</span><span class="n">k0</span><span class="p">]</span>

    <span class="n">lkEq</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">vv</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">dEq_corres</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                   <span class="k">if</span> <span class="n">vv</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]])</span>
    <span class="n">kSep</span> <span class="o">=</span> <span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;sep&#39;</span><span class="p">]</span>
    <span class="n">lkEqmap</span> <span class="o">=</span> <span class="n">lkEq</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>

    <span class="n">dlextra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lkEqmap</span><span class="p">])</span>
    <span class="n">dteq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ii</span><span class="p">,{})</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEqmap</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">idteq</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">idteq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># test if any existing t matches values</span>
                    <span class="n">lidalready</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k1</span> <span class="k">for</span> <span class="n">k1</span><span class="p">,</span><span class="n">v1</span> <span class="ow">in</span> <span class="n">v0</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                   <span class="k">if</span> <span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
                                       <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]))]</span>
                                  <span class="k">for</span> <span class="n">v0</span> <span class="ow">in</span> <span class="n">dteq</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                    <span class="n">lidalready</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)))</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lidalready</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">idteq</span> <span class="o">=</span> <span class="n">lidalready</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">idteq</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
                <span class="n">idteq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">kk</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                        <span class="k">if</span> <span class="ow">not</span> <span class="n">kk</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">])</span>
                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">])</span>
                <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idteq</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">],</span> <span class="n">dEq_corres</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]]</span>
                    <span class="ow">and</span> <span class="s1">&#39;marker&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmarker</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Several distinct time bases in self.dextra for:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;    - lData[</span><span class="si">%s</span><span class="s2">]: </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;        - &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        - &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lkEqmap</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


    <span class="c1">#########</span>
    <span class="c1"># Plot</span>
    <span class="c1">#########</span>

    <span class="c1"># Format axes</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="n">_init_DataCam12D_combine</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                   <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">nDat</span><span class="o">=</span><span class="n">nDat</span><span class="p">,</span>
                                   <span class="n">lis2D</span><span class="o">=</span><span class="n">lis2D</span><span class="p">,</span> <span class="n">fldict</span><span class="o">=</span><span class="n">fldict</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">)</span>
    <span class="n">fig</span>  <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">aa</span><span class="p">))</span> <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="s1">&#39;shot&#39;</span><span class="p">]</span>
               <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">aa</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]]</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>

    <span class="c1"># -----------------</span>
    <span class="c1"># Plot ref dextra and ref conf H</span>

    <span class="c1"># conf</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span>
                                                       <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># dextra</span>
    <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">lk</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lkEqmap</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">lk</span><span class="p">:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">co</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;k&#39;</span>
                <span class="n">lab</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">co</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>

    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.01</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;expand&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="n">fontsize</span><span class="p">})</span>


    <span class="c1"># -----------------</span>
    <span class="c1"># Plot cross config, los and bck for each Data</span>

    <span class="n">llCross</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">llHor</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">lidCross</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">lidHor</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>

        <span class="c1"># cross config</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
              <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span>
                                                     <span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                     <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                     <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># los</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
              <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c1</span> <span class="ow">and</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_isLOS</span>
        <span class="k">if</span> <span class="n">c2</span><span class="p">:</span>
            <span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]))]</span>
            <span class="n">llHor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]))]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">])):</span>
                <span class="n">cc</span> <span class="o">=</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                                                <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">llHor</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span>
                                              <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c2</span> <span class="ow">and</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">and</span> <span class="n">bck</span><span class="p">:</span>
            <span class="n">indbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">lindr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">lindr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">lindr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">lindr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">])):</span>
                <span class="n">crossbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                            <span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                <span class="n">crossbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crossbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crossbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crossbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">c2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">])):</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                                               <span class="n">element</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                               <span class="n">dL</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
                                               <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c2</span><span class="p">:</span>
            <span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span> <span class="o">*</span><span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">llHor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">itt</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span> <span class="o">*</span><span class="n">llHor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">))</span>
            <span class="n">lidCross</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">lidHor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">llHor</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>


        <span class="c1"># bck signal</span>
        <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">and</span> <span class="n">bck</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">bck</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lX</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
            <span class="n">tbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">lnch</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">dbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">lnch</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tbck</span><span class="p">,</span> <span class="n">dbck</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>


    <span class="c1"># ---------------</span>
    <span class="c1"># Lims and labels</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Dt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lDd</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">lDlab</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lextent</span><span class="p">[</span><span class="n">ii</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lextent</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sharex</span><span class="p">:</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lDX</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">lXlab</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sharex</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lDX</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lDX</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1">##################</span>
    <span class="c1"># Interactivity dict</span>

    <span class="n">dgroup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>      <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">ntMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]}}</span>
    <span class="n">lgroup</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;channel-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;f</span><span class="si">{0:01.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dgroup</span><span class="p">[</span><span class="n">lgroup</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nchMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">key</span><span class="p">,</span>
                              <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]}</span>

    <span class="c1"># Group info (make dynamic in later versions ?)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="n">dgroup</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
                     <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">lgroup</span><span class="p">])</span>
    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="c1"># dref</span>
    <span class="n">dref</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">}</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="n">lgroup</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incX</span><span class="p">,</span>
                          <span class="s1">&#39;otherid&#39;</span><span class="p">:</span><span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;indother&#39;</span><span class="p">:</span><span class="n">lindtX</span><span class="p">[</span><span class="n">ii</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
            <span class="n">dref</span><span class="p">[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="s1">&#39;2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lx1</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lx2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idteq</span><span class="p">,</span> <span class="n">teq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dteq</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">idteq</span><span class="p">,</span> <span class="n">teq</span> <span class="o">=</span> <span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dref</span><span class="p">[</span><span class="n">idteq</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">teq</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">}</span>


    <span class="c1"># ddata</span>
    <span class="n">ddat</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">ldata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">lidchans</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">ldchans</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>

        <span class="k">if</span> <span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">ddat</span><span class="p">[</span><span class="n">lidCross</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">llCross</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>
            <span class="n">ddat</span><span class="p">[</span><span class="n">lidHor</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">llHor</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>
        <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
            <span class="n">ddat</span><span class="p">[</span><span class="n">lidx12</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:(</span><span class="n">lx1</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lx2</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>

        <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">ddat</span><span class="p">[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">],</span>
                                              <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEq</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">dlextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">ddat</span><span class="p">[</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">],</span>
                                              <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}</span>

    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">ddat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># DB</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ddat</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s1">&#39;val&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">ipdb</span>
            <span class="n">ipdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>

    <span class="c1"># dax</span>
    <span class="n">lax_fix</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">]</span>

    <span class="n">dax2</span> <span class="o">=</span> <span class="p">{</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idteq</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}}}</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="s1">&#39;x&#39;</span><span class="p">}}</span>
        <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
            <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span><span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="s1">&#39;x&#39;</span><span class="p">}}</span>

    <span class="n">dobj</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="c1">##################</span>
    <span class="c1"># Populating dobj</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot and one-time 2D map</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">map_</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;data2D&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">normt_map</span><span class="p">:</span>
                <span class="n">map_</span> <span class="o">=</span> <span class="n">map_</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">map_</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:]</span>
            <span class="n">vmin_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">map_</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmin_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmin_map</span>
            <span class="n">vmax_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">map_</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmax_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmax_map</span>
            <span class="n">norm_map</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin_map</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_map</span><span class="p">)</span>
            <span class="n">nan2_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">map_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2_map</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                         <span class="n">extent</span><span class="o">=</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;extent&#39;</span><span class="p">],</span>
                                         <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                         <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_map</span><span class="p">,</span>
                                         <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_map</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                           <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">dlextra</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]:</span><span class="mi">0</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot channels</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

            <span class="c1"># Channel text</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">nchMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidchans</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span>
                                          <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_X</span><span class="p">}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="c1"># los</span>
            <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_isLOS</span><span class="p">:</span>
                <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                           <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidCross</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                        <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidHor</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># One-shot time</span>

    <span class="c1"># Time vlines on first axes</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idteq</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idteq</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idteq</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># time txt</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
        <span class="c1"># Time txt</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">ntMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">} s&#39;</span><span class="o">%</span><span class="n">fmt_t</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># -------------</span>
    <span class="c1"># Data-specific</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nDat</span><span class="p">):</span>

        <span class="c1"># Time</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>

            <span class="c1"># Time vlines</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Time data profiles</span>
            <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lnan2_data</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">extent</span><span class="o">=</span><span class="n">lextent</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                         <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                         <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">lnorm</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                         <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                       <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">ln12</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                       <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lX</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">lnch</span><span class="p">[</span><span class="n">ii</span><span class="p">],),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                        <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                <span class="k">if</span> <span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}</span>

            <span class="c1"># Time equilibrium and map</span>
            <span class="k">if</span> <span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lkEq</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lData</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">dextra</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">id_</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="n">idt</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;idt&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">kk</span> <span class="o">==</span> <span class="n">kSep</span><span class="p">:</span>
                        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                   <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">marker</span> <span class="o">=</span> <span class="n">dlextra</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                                    <span class="n">mec</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                                    <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">id_</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>


        <span class="c1"># Channel</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

            <span class="c1"># Channel time trace</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">lnt</span><span class="p">[</span><span class="n">ii</span><span class="p">],),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                      <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">liddata</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="c1"># Channel vlines or pixels</span>
            <span class="k">if</span> <span class="n">lis2D</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
                <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                         <span class="n">mec</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="c1"># Here we put lidX[0] because all have the same (and it</span>
                <span class="c1"># avoids overdefining ddat[idx12]</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidx12</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lXother</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                    <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">}}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">lls</span><span class="p">[</span><span class="n">ll</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                        <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]]}},</span>
                                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">lidX</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">jj</span><span class="p">,</span> <span class="n">lidt</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span><span class="n">ll</span><span class="p">}}</span>

    <span class="c1">##################</span>
    <span class="c1"># Instanciate KeyHandler</span>
    <span class="n">can</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
    <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">kh</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">KeyHandler_mpl</span><span class="p">(</span><span class="n">can</span><span class="o">=</span><span class="n">can</span><span class="p">,</span>
                              <span class="n">dgroup</span><span class="o">=</span><span class="n">dgroup</span><span class="p">,</span> <span class="n">dref</span><span class="o">=</span><span class="n">dref</span><span class="p">,</span> <span class="n">ddata</span><span class="o">=</span><span class="n">ddat</span><span class="p">,</span>
                              <span class="n">dobj</span><span class="o">=</span><span class="n">dobj</span><span class="p">,</span> <span class="n">dax</span><span class="o">=</span><span class="n">dax2</span><span class="p">,</span> <span class="n">lax_fix</span><span class="o">=</span><span class="n">lax_fix</span><span class="p">,</span>
                              <span class="n">groupinit</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">disconnect_old</span><span class="p">()</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">kh</span>






<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#               Plot spectrogram</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>


<div class="viewcode-block" id="Data_plot_spectrogram"><a class="viewcode-back" href="../../../tofu.data.html#tofu.data._plot.Data_plot_spectrogram">[docs]</a><span class="k">def</span> <span class="nf">Data_plot_spectrogram</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lpsd</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indref</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                          <span class="n">cmap_f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap_img</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                          <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">normt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ntMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nfMax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                          <span class="n">lls</span><span class="o">=</span><span class="n">_lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">_lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">_lcch</span><span class="p">,</span>
                          <span class="n">plotmethod</span><span class="o">=</span><span class="s1">&#39;imshow&#39;</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>
    <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">_fontsize</span>

    <span class="n">ntMax</span> <span class="o">=</span> <span class="n">_ntMax</span> <span class="k">if</span> <span class="n">ntMax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ntMax</span>
    <span class="n">nfMax</span> <span class="o">=</span> <span class="n">_nfMax</span> <span class="k">if</span> <span class="n">nfMax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nfMax</span>
    <span class="n">nD</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">_is2D</span><span class="p">():</span>
        <span class="n">nD</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ntMax</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">nfMax</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">kh</span> <span class="o">=</span> <span class="n">_Data1D_plot_spectrogram</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lpsd</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span>
                                  <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">,</span>
                                  <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">nfMax</span><span class="o">=</span><span class="n">nfMax</span><span class="p">,</span>
                                  <span class="n">bck</span><span class="o">=</span><span class="n">bck</span><span class="p">,</span> <span class="n">llsf</span><span class="o">=</span><span class="n">lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">lct</span><span class="p">,</span>
                                  <span class="n">cmap_f</span><span class="o">=</span><span class="n">cmap_f</span><span class="p">,</span> <span class="n">cmap_img</span><span class="o">=</span><span class="n">cmap_img</span><span class="p">,</span>
                                  <span class="n">normt</span><span class="o">=</span><span class="n">normt</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span>
                                  <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                                  <span class="n">tit</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                                  <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="n">connect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kh</span></div>



<span class="k">def</span> <span class="nf">_init_Data1D_spectrogram</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">):</span>
    <span class="n">axCol</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_figuresize</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dmargin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmargin</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">dmargin1D</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">axCol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">wintit</span><span class="p">)</span>

    <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">dmargin</span><span class="p">)</span>
    <span class="n">laxt</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">2</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
    <span class="n">laxt</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">laxt</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">4</span><span class="p">:,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">laxp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                 <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
        <span class="n">laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
        <span class="n">laxp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                 <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                 <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                 <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">laxcb</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">laxp</span><span class="p">)):</span>
            <span class="n">ax_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">laxp</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">laxcb</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                                               <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">)</span>

    <span class="n">axH</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>

    <span class="c1"># text group</span>
    <span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span>
    <span class="n">axtxtg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># text x</span>
    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">DY</span> <span class="o">=</span> <span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="o">-</span> <span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DX</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">xtxt</span> <span class="o">=</span> <span class="n">Xtxt</span> <span class="o">+</span> <span class="mf">0.15</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">DX</span> <span class="o">-</span> <span class="mf">0.15</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">)</span>
    <span class="n">axtxtx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># text t and f</span>
    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DX</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">xtxt</span> <span class="o">=</span> <span class="n">Xtxt</span> <span class="o">+</span> <span class="mf">0.15</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">DX</span> <span class="o">-</span> <span class="mf">0.15</span><span class="o">*</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">Xtxt</span><span class="p">)</span>
    <span class="n">axtxtt</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">laxp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">axtxtf</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># formatting text</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">axtxtg</span><span class="p">,</span> <span class="n">axtxtx</span><span class="p">,</span> <span class="n">axtxtt</span><span class="p">,</span> <span class="n">axtxtf</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([]),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Return ax dict</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="n">laxt</span><span class="p">,</span>
           <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">laxp</span><span class="p">,</span>
           <span class="s1">&#39;cross&#39;</span><span class="p">:[</span><span class="n">axC</span><span class="p">],</span>
           <span class="s1">&#39;hor&#39;</span><span class="p">:[</span><span class="n">axH</span><span class="p">],</span>
           <span class="s1">&#39;txtg&#39;</span><span class="p">:[</span><span class="n">axtxtg</span><span class="p">],</span>
           <span class="s1">&#39;txtx&#39;</span><span class="p">:[</span><span class="n">axtxtx</span><span class="p">],</span>
           <span class="s1">&#39;txtt&#39;</span><span class="p">:[</span><span class="n">axtxtt</span><span class="p">],</span>
           <span class="s1">&#39;txtf&#39;</span><span class="p">:[</span><span class="n">axtxtf</span><span class="p">]}</span>

    <span class="c1"># Add colorbars if 2D</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">laxcb</span>

    <span class="c1"># Format all axes</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dax</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">])):</span>
            <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="c1"># For faster plotting :</span>
            <span class="k">if</span> <span class="n">kk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span><span class="s1">&#39;hor&#39;</span><span class="p">]:</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">use_sticky_edges</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">dax</span>




<span class="k">def</span> <span class="nf">_Data1D_plot_spectrogram</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lpsd</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span>
                             <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">ntMax</span><span class="o">=</span><span class="n">_ntMax</span><span class="p">,</span> <span class="n">nfMax</span><span class="o">=</span><span class="n">_nfMax</span><span class="p">,</span>
                             <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">llsf</span><span class="o">=</span><span class="n">_lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">_lct</span><span class="p">,</span>
                             <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">incf</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span>
                             <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">fmt_f</span><span class="o">=</span><span class="s1">&#39;05.2f&#39;</span><span class="p">,</span>
                             <span class="n">cmap_f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap_img</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">normt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">_cbck</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                             <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="n">_fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">_labelpad</span><span class="p">,</span>
                             <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="k">assert</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DataCam1D&#39;</span><span class="p">,</span><span class="s1">&#39;DataCam2D&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">nD</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cmap_f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap_f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span>
    <span class="k">if</span> <span class="n">cmap_img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span>

    <span class="c1">#########</span>
    <span class="c1"># Prepare</span>
    <span class="c1">#########</span>

    <span class="c1"># Start extracting data</span>
    <span class="n">fldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">)</span>
    <span class="n">Dt</span><span class="p">,</span> <span class="n">Dch</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

    <span class="c1"># Force update for safety</span>
    <span class="n">ddata</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">ddata</span>

    <span class="c1"># t</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nt&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.001</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
    <span class="n">tlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="n">idt</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="c1"># X</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">nnch</span><span class="p">,</span> <span class="n">indtX</span> <span class="o">=</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nch&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)]</span>
        <span class="n">Xlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                   <span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">nnch</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">indtX</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">indr</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
            <span class="n">indbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">idx12</span> <span class="o">=</span> <span class="nb">id</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">))</span>
        <span class="n">n12</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">nnch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Xtype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">Xother</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">indtX</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Xtype</span> <span class="o">=</span> <span class="s1">&#39;x1&#39;</span>
        <span class="n">Xother</span> <span class="o">=</span> <span class="n">idt</span>
    <span class="n">idX</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># dchans</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">dchans</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">idchans</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dchans</span><span class="p">)</span>

    <span class="c1"># data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">data</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">Dlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmax</span><span class="p">)]</span>
    <span class="n">Dd</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">),</span> <span class="n">Dlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">)]</span>
    <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">iddata</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># tf</span>
    <span class="n">Dtf</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">tf</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">tf</span><span class="p">)]</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">idtf</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>

    <span class="c1"># f</span>
    <span class="n">Df</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
    <span class="n">flab</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;f ($Hz$)&#39;</span>
    <span class="n">psdlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\|F\|^2$ (a.u.)&#39;</span>
    <span class="n">anglab</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$ang(F)$ ($rad$)&#39;</span>
    <span class="n">ftype</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
    <span class="n">idf</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">extentf</span> <span class="o">=</span> <span class="p">(</span><span class="n">Dtf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">dtf</span><span class="p">,</span><span class="n">Dtf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dtf</span><span class="p">,</span> <span class="n">Df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">,</span> <span class="n">Df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># lpsd and lang</span>
    <span class="n">lpsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lpsd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lpsd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">lpsd_norm</span> <span class="o">=</span> <span class="n">lpsd</span> <span class="o">/</span> <span class="n">maxx</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">normt</span><span class="p">:</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lpsd_norm</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">lpsd_norm</span> <span class="o">=</span> <span class="n">lpsd_norm</span> <span class="o">/</span> <span class="n">maxx</span>
    <span class="n">lang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Dpsd</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lpsd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lpsd</span><span class="p">)]</span>
    <span class="n">Dpsd_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lpsd_norm</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lpsd_norm</span><span class="p">)]</span>
    <span class="n">angmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">idlpsd</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lpsd</span><span class="p">)</span>
    <span class="n">idlpsd_norm</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lpsd_norm</span><span class="p">)</span>
    <span class="n">idlang</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>


    <span class="c1">############</span>
    <span class="c1"># Format axes</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="n">_init_Data1D_spectrogram</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span>
                                   <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

    <span class="k">if</span> <span class="n">tit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0:05.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">))</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>

    <span class="c1"># Plot vessel</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span> <span class="ow">and</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                         <span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
        <span class="k">if</span> <span class="n">c1</span> <span class="ow">and</span> <span class="s1">&#39;LOS&#39;</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span><span class="p">,</span> <span class="n">llab</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]:</span>
                <span class="n">lCross</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                                        <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">lHor</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span>
                                      <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bck</span> <span class="ow">and</span> <span class="n">cc</span><span class="o">.</span><span class="n">_is2D</span><span class="p">():</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                                <span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crossbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                              <span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">horbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crossbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crossbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">horbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">horbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">bck</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="n">element</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                  <span class="n">dL</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
                                  <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

            <span class="n">lHor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
            <span class="n">idlCross</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lCross</span><span class="p">)</span>
            <span class="n">idlHor</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nnch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
            <span class="n">tbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">nch</span><span class="p">)</span>
            <span class="n">dbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">nch</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tbck</span><span class="p">,</span> <span class="n">dbck</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                     <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>

    <span class="c1"># Colorbars if 2D</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">norm_data</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_img</span><span class="p">,</span>
                                       <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm_data</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>

        <span class="n">norm_psd0</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">Dpsd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Dpsd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_img</span><span class="p">,</span>
                                       <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm_psd0</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">psdlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>

        <span class="n">norm_ang</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="n">angmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">angmax</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span><span class="p">,</span>
                                       <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm_ang</span><span class="p">,</span>
                                       <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">angmax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angmax</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">anglab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">norm_psd1</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">Dpsd_norm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Dpsd_norm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


    <span class="c1"># ---------------</span>
    <span class="c1"># Lims and labels</span>
    <span class="n">fmax</span> <span class="o">=</span> <span class="n">extentf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">fmax</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Dt</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dd</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extentf</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fmax</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">tlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">flab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">flab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">DX</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dd</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dpsd</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Xlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">psdlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">anglab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

    <span class="c1"># invert</span>
    <span class="k">if</span> <span class="n">invert</span> <span class="ow">and</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>



    <span class="c1">##################</span>
    <span class="c1"># Interactivity dict</span>

    <span class="n">dgroup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>      <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">ntMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">idtf</span><span class="p">,</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]},</span>
              <span class="s1">&#39;channel&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]},</span>
              <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nfMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f3&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">idf</span><span class="p">,</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]}}</span>

    <span class="c1"># Group info (make dynamic in later versions ?)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dgroup</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>


    <span class="n">dref</span> <span class="o">=</span> <span class="p">{</span><span class="n">idt</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">},</span>
            <span class="n">idtf</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">tf</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">},</span>
            <span class="n">idX</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incX</span><span class="p">,</span>
                   <span class="s1">&#39;otherid&#39;</span><span class="p">:</span><span class="n">Xother</span><span class="p">,</span> <span class="s1">&#39;indother&#39;</span><span class="p">:</span><span class="n">indtX</span><span class="p">},</span>
            <span class="n">idf</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incf</span><span class="p">}}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">idX</span><span class="p">][</span><span class="s1">&#39;2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>

    <span class="n">ddat</span> <span class="o">=</span> <span class="p">{</span><span class="n">iddata</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">,</span><span class="n">idX</span><span class="p">]},</span>
            <span class="n">idlpsd</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lpsd</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">,</span><span class="n">idf</span><span class="p">,</span><span class="n">idtf</span><span class="p">]},</span>
            <span class="n">idlpsd_norm</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lpsd_norm</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">,</span><span class="n">idf</span><span class="p">,</span><span class="n">idtf</span><span class="p">]},</span>
            <span class="n">idlang</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lang</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">,</span><span class="n">idf</span><span class="p">,</span><span class="n">idtf</span><span class="p">]},</span>
            <span class="n">idchans</span><span class="p">:{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dchans</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}}</span>
    <span class="k">if</span> <span class="n">lCross</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlCross</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lCross</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlHor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lHor</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idx12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>

    <span class="n">lax_fix</span> <span class="o">=</span> <span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtf&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">dax2</span> <span class="o">=</span> <span class="p">{</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}},</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idtf</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">idf</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">},</span> <span class="s1">&#39;defrefid&#39;</span><span class="p">:</span><span class="n">idf</span><span class="p">},</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idtf</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">idf</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">},</span> <span class="s1">&#39;defrefid&#39;</span><span class="p">:</span><span class="n">idf</span><span class="p">}}</span>

    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}},</span>
                     <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}},</span>
                     <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}}})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span> <span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">},</span>
                     <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span> <span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">},</span>
                     <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span> <span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">}})</span>
    <span class="n">dobj</span> <span class="o">=</span> <span class="p">{}</span>



    <span class="c1">##################</span>
    <span class="c1"># Populating dobj</span>
    <span class="c1">##################</span>


    <span class="c1"># Channel</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>

        <span class="c1"># Channel text</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idchans</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_X</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Channel time trace</span>
        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nt</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                               <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">iddata</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Channel vlines or pixels</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Xother</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])):</span>
                    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span>
                                                        <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">,</span><span class="n">idX</span><span class="p">]}},</span>
                                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">,</span> <span class="n">idt</span><span class="p">:</span><span class="n">ii</span><span class="p">}}</span>


        <span class="c1"># psd imshow</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">lpsd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_f</span><span class="p">,</span>
                                <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                <span class="n">extent</span><span class="o">=</span><span class="n">extentf</span><span class="p">,</span>
                                <span class="n">norm</span><span class="o">=</span><span class="n">norm_psd1</span><span class="p">,</span>
                                <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlpsd_norm</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># ang imshow</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">lang</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span><span class="p">,</span>
                                <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extentf</span><span class="p">,</span>
                                <span class="n">vmin</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlang</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># los</span>
        <span class="k">if</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                      <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlCross</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlHor</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># Time</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
        <span class="c1"># Time txt</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">ntMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idt</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">} s&#39;</span><span class="o">%</span><span class="n">fmt_t</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Time vlines</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])):</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idt</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Time data profiles</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nch</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                   <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">iddata</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="k">if</span> <span class="n">Xother</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">Xother</span><span class="p">]}</span>

            <span class="c1"># lpsd and ang profiles</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nfMax</span><span class="p">):</span>
                <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nch</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                       <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">llsf</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlpsd</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idtf</span><span class="p">,</span><span class="n">idf</span><span class="p">]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idtf</span><span class="p">:</span><span class="n">jj</span><span class="p">,</span> <span class="n">idf</span><span class="p">:</span><span class="n">ii</span><span class="p">}}</span>
                <span class="n">l1</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nch</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                       <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">llsf</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlang</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idtf</span><span class="p">,</span><span class="n">idf</span><span class="p">]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idtf</span><span class="p">:</span><span class="n">jj</span><span class="p">,</span> <span class="n">idf</span><span class="p">:</span><span class="n">ii</span><span class="p">}}</span>

                <span class="k">if</span> <span class="n">Xother</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">Xother</span><span class="p">]}</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;drefid&#39;</span><span class="p">][</span><span class="n">Xother</span><span class="p">]</span> <span class="o">=</span> <span class="n">jj</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l1</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">Xother</span><span class="p">]}</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l1</span><span class="p">][</span><span class="s1">&#39;drefid&#39;</span><span class="p">][</span><span class="n">Xother</span><span class="p">]</span> <span class="o">=</span> <span class="n">jj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_data</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_img</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">iddata</span><span class="p">,</span> <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">n12</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

            <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_psd0</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_img</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlpsd</span><span class="p">,</span> <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">n12</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idtf</span><span class="p">,</span><span class="n">idf</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idtf</span><span class="p">:</span><span class="n">jj</span><span class="p">,</span> <span class="n">idf</span><span class="p">:</span><span class="mi">0</span><span class="p">}}</span>

            <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_ang</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlang</span><span class="p">,</span> <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">n12</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idtf</span><span class="p">,</span><span class="n">idf</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idtf</span><span class="p">:</span><span class="n">jj</span><span class="p">,</span> <span class="n">idf</span><span class="p">:</span><span class="mi">0</span><span class="p">}}</span>

    <span class="c1"># pixel on top of imshows</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])):</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                    <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                                    <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idx12</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># Frequency</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nfMax</span><span class="p">):</span>
        <span class="c1"># Frequency text</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtf&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">ntMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idf</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idf</span><span class="p">],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">} Hz&#39;</span><span class="o">%</span><span class="n">fmt_t</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idf</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Frequency hlines x 2</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">llsf</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idf</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idf</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idf</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">llsf</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idf</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idf</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idf</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>




    <span class="c1"># Instanciate KeyHandler</span>
    <span class="n">can</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
    <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">kh</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">KeyHandler_mpl</span><span class="p">(</span><span class="n">can</span><span class="o">=</span><span class="n">can</span><span class="p">,</span>
                              <span class="n">dgroup</span><span class="o">=</span><span class="n">dgroup</span><span class="p">,</span> <span class="n">dref</span><span class="o">=</span><span class="n">dref</span><span class="p">,</span> <span class="n">ddata</span><span class="o">=</span><span class="n">ddat</span><span class="p">,</span>
                              <span class="n">dobj</span><span class="o">=</span><span class="n">dobj</span><span class="p">,</span> <span class="n">dax</span><span class="o">=</span><span class="n">dax2</span><span class="p">,</span> <span class="n">lax_fix</span><span class="o">=</span><span class="n">lax_fix</span><span class="p">,</span>
                              <span class="n">groupinit</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">disconnect_old</span><span class="p">()</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">kh</span>




<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>
<span class="c1">#               Plot svd</span>
<span class="c1">#######################################################################</span>
<span class="c1">#######################################################################</span>


<span class="k">def</span> <span class="nf">Data_plot_svd</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">chronos</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">topos</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">cmap_topos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin_topos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax_topos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">ntMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                  <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">incm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                  <span class="n">lls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lcm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">fmt_m</span><span class="o">=</span><span class="s1">&#39;03.0f&#39;</span><span class="p">,</span>
                  <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">ToFuObject</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Data</span><span class="o">.</span><span class="n">_isSpectral</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="n">nD</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">_is2D</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="c1"># ------------------</span>
    <span class="c1"># Input formatting</span>
    <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">_fontsize</span>
    <span class="k">if</span> <span class="n">ntMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ntMax</span> <span class="o">=</span> <span class="n">_ntMax</span>
    <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">_is2D</span><span class="p">():</span>
        <span class="n">ntMax</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">nchMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nchMax</span> <span class="o">=</span> <span class="n">_nchMax</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span>
    <span class="k">if</span> <span class="n">cmap_topos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wintit</span> <span class="o">=</span> <span class="n">_wintit</span>
    <span class="k">if</span> <span class="n">labelpad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labelpad</span> <span class="o">=</span> <span class="n">_labelpad</span>
    <span class="k">if</span> <span class="n">lct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lct</span> <span class="o">=</span> <span class="n">_lct</span>
    <span class="k">if</span> <span class="n">lcch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lcch</span> <span class="o">=</span> <span class="n">_lcch</span>
    <span class="k">if</span> <span class="n">lcm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lcm</span> <span class="o">=</span> <span class="n">_lcm</span>
    <span class="k">if</span> <span class="n">lls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lls</span> <span class="o">=</span> <span class="n">_lls</span>
    <span class="k">if</span> <span class="n">cbck</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbck</span> <span class="o">=</span> <span class="n">_cbck</span>
    <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># ------------------</span>
    <span class="c1"># Plotting</span>
    <span class="n">kh</span> <span class="o">=</span> <span class="n">_Data_plot_svd</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">chronos</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">topos</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span>
                        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="n">bck</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                        <span class="n">cmap_topos</span><span class="o">=</span><span class="n">cmap_topos</span><span class="p">,</span> <span class="n">vmin_topos</span><span class="o">=</span><span class="n">vmin_topos</span><span class="p">,</span>
                        <span class="n">vmax_topos</span><span class="o">=</span><span class="n">vmax_topos</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">,</span>
                        <span class="n">ntMax</span><span class="o">=</span><span class="n">ntMax</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="n">nchMax</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span>
                        <span class="n">inct</span><span class="o">=</span><span class="n">inct</span><span class="p">,</span> <span class="n">incX</span><span class="o">=</span><span class="n">incX</span><span class="p">,</span> <span class="n">incm</span><span class="o">=</span><span class="n">incm</span><span class="p">,</span>
                        <span class="n">lls</span><span class="o">=</span><span class="n">lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">lcch</span><span class="p">,</span> <span class="n">lcm</span><span class="o">=</span><span class="n">lcm</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span>
                        <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span> <span class="n">fmt_t</span><span class="o">=</span><span class="n">fmt_t</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="n">fmt_X</span><span class="p">,</span> <span class="n">fmt_m</span><span class="o">=</span><span class="n">fmt_m</span><span class="p">,</span>
                        <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span>
                        <span class="n">tit</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="n">connect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kh</span>



<span class="k">def</span> <span class="nf">_init_Data_svd</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">):</span>

    <span class="c1"># Prepare</span>
    <span class="n">axCol</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_figuresize</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dmargin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dmargin</span> <span class="o">=</span> <span class="n">_def</span><span class="o">.</span><span class="n">dmargin1D</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">axCol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wintit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">wintit</span><span class="p">)</span>

    <span class="c1"># Axes array</span>
    <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">dmargin</span><span class="p">)</span>
    <span class="n">laxt</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
    <span class="n">laxt</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">laxt</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">ii</span><span class="p">,:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                 <span class="n">sharex</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">laxp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">laxp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                     <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
        <span class="n">laxp</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">laxp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ii</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">ii</span><span class="o">%</span><span class="mi">2</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                     <span class="n">sharex</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">ax_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">laxcb</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;15%&quot;</span><span class="p">)]</span>
        <span class="n">laxcb</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ax_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;30%&quot;</span><span class="p">)]</span>

    <span class="n">axm</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">axH</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">4</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>
    <span class="n">axH</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">)</span>

    <span class="c1"># text x</span>
    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">DY</span> <span class="o">=</span> <span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DX</span> <span class="o">=</span> <span class="n">laxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">axtxtx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># text t</span>
    <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">axtxtt</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># text group</span>
    <span class="n">xtxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">Ytxt</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">DY</span>
    <span class="n">axtxtg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

    <span class="c1"># texts modes</span>
    <span class="n">laxtxtm</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">Xtxt</span> <span class="o">=</span> <span class="n">laxp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ii</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">DX</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">indax</span> <span class="o">=</span> <span class="n">ii</span><span class="o">//</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">nD</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">Ytxt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laxp</span><span class="p">[</span><span class="n">indax</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">Xtxt</span><span class="p">,</span> <span class="n">Ytxt</span><span class="p">,</span> <span class="n">DX</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">DY</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">laxtxtm</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>

    <span class="c1"># Return ax dict</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="n">laxt</span><span class="p">,</span>
           <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">laxp</span><span class="p">,</span>
           <span class="s1">&#39;m&#39;</span><span class="p">:[</span><span class="n">axm</span><span class="p">],</span>
           <span class="s1">&#39;cross&#39;</span><span class="p">:[</span><span class="n">axC</span><span class="p">],</span>
           <span class="s1">&#39;hor&#39;</span><span class="p">:[</span><span class="n">axH</span><span class="p">],</span>
           <span class="s1">&#39;txtg&#39;</span><span class="p">:[</span><span class="n">axtxtg</span><span class="p">],</span>
           <span class="s1">&#39;txtx&#39;</span><span class="p">:[</span><span class="n">axtxtx</span><span class="p">],</span>
           <span class="s1">&#39;txtt&#39;</span><span class="p">:[</span><span class="n">axtxtt</span><span class="p">],</span>
           <span class="s1">&#39;txtm&#39;</span><span class="p">:</span><span class="n">laxtxtm</span><span class="p">}</span>

    <span class="c1"># Add colorbars if 2D</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">laxcb</span>

    <span class="c1"># Format all axes</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">dax</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">])):</span>
            <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="c1"># For faster plotting :</span>
            <span class="k">if</span> <span class="n">kk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span><span class="s1">&#39;hor&#39;</span><span class="p">]:</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">use_sticky_edges</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;txt&#39;</span> <span class="ow">in</span> <span class="n">kk</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">])):</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">]:</span>
                    <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([]),</span> <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>  <span class="n">dax</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dax</span>



<span class="k">def</span> <span class="nf">_Data_plot_svd</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">chronos</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">topos</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">cmap_topos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin_topos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax_topos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">ntMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nchMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                   <span class="n">inct</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">incX</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">incm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                   <span class="n">lls</span><span class="o">=</span><span class="n">_lls</span><span class="p">,</span> <span class="n">lct</span><span class="o">=</span><span class="n">_lct</span><span class="p">,</span> <span class="n">lcch</span><span class="o">=</span><span class="n">_lcch</span><span class="p">,</span> <span class="n">lcm</span><span class="o">=</span><span class="n">_lcm</span><span class="p">,</span> <span class="n">cbck</span><span class="o">=</span><span class="n">_cbck</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">fmt_t</span><span class="o">=</span><span class="s1">&#39;06.3f&#39;</span><span class="p">,</span> <span class="n">fmt_X</span><span class="o">=</span><span class="s1">&#39;01.0f&#39;</span><span class="p">,</span> <span class="n">fmt_m</span><span class="o">=</span><span class="s1">&#39;03.0f&#39;</span><span class="p">,</span>
                   <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wintit</span><span class="o">=</span><span class="n">_wintit</span><span class="p">,</span> <span class="n">tit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="k">assert</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DataCam1D&#39;</span><span class="p">,</span><span class="s1">&#39;DataCam2D&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">nD</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span>
    <span class="k">if</span> <span class="n">cmap_topos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap_topos</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span>
    <span class="n">nmMax</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="n">invert</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">#########</span>
    <span class="c1"># Prepare</span>
    <span class="c1">#########</span>

    <span class="c1"># Start extracting data</span>
    <span class="n">fldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">)</span>
    <span class="n">Dt</span><span class="p">,</span> <span class="n">Dch</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

    <span class="c1"># Force update for safety</span>
    <span class="n">ddata</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">ddata</span>

    <span class="c1"># t</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nt&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.001</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
    <span class="n">tlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="n">idt</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="c1">#------</span>
    <span class="c1"># X</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">nnch</span><span class="p">,</span> <span class="n">indtX</span> <span class="o">=</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nch&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;nnch&#39;</span><span class="p">],</span> <span class="n">ddata</span><span class="p">[</span><span class="s1">&#39;indtX&#39;</span><span class="p">]</span>

    <span class="c1"># svd will only be displayed vs channel (no varying X, for the topos)</span>
    <span class="k">if</span> <span class="n">nnch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>
        <span class="n">nnch</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DX</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)]</span>
        <span class="n">Xlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                   <span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">nnch</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">indtX</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">indr</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">get_X12plot</span><span class="p">(</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
            <span class="n">indbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">indr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">idx12</span> <span class="o">=</span> <span class="nb">id</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">))</span>
        <span class="n">n12</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>

    <span class="n">Xtype</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="n">Xother</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">idX</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># dchans</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dchans</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">dchans</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">idchans</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">dchans</span><span class="p">)</span>

    <span class="c1"># data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">data</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">Dlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">vmax</span><span class="p">)]</span>
    <span class="n">Dd</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">),</span> <span class="n">Dlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Dlim</span><span class="p">)]</span>
    <span class="n">Dlab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">Data</span><span class="o">.</span><span class="n">dlabels</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
    <span class="n">iddata</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># singular values</span>
    <span class="n">Ds</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">Ds</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Ds</span><span class="p">))</span>
    <span class="n">indmodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">Dm</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">idm</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">indmodes</span><span class="p">)</span>

    <span class="c1"># chronos</span>
    <span class="n">vabs_chronos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chronos</span><span class="p">[:,</span><span class="n">modes</span><span class="p">]))</span>
    <span class="n">Dchronos</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">vabs_chronos</span><span class="p">,</span> <span class="n">vabs_chronos</span><span class="p">)</span>
    <span class="n">idchronos</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">chronos</span><span class="p">)</span>

    <span class="c1"># topos</span>
    <span class="n">vabs_topos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">topos</span><span class="p">[</span><span class="n">modes</span><span class="p">,:]))</span>
    <span class="n">Dtopos</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">vabs_topos</span><span class="p">,</span> <span class="n">vabs_topos</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vmin_topos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmin_topos</span> <span class="o">=</span> <span class="o">-</span><span class="n">vabs_topos</span>
    <span class="k">if</span> <span class="n">vmax_topos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmax_topos</span> <span class="o">=</span> <span class="n">vabs_topos</span>
    <span class="n">idtopos</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">topos</span><span class="p">)</span>

    <span class="c1">############</span>
    <span class="c1"># Format axes</span>
    <span class="c1">############</span>
    <span class="n">dax</span> <span class="o">=</span> <span class="n">_init_Data_svd</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">dmargin</span><span class="o">=</span><span class="n">dmargin</span><span class="p">,</span>
                         <span class="n">wintit</span><span class="o">=</span><span class="n">wintit</span><span class="p">,</span> <span class="n">nD</span><span class="o">=</span><span class="n">nD</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

    <span class="k">if</span> <span class="n">tit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">tit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0:05.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">))</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tit</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>

    <span class="c1">############</span>
    <span class="c1"># Plot static</span>
    <span class="c1">############</span>

    <span class="c1"># Config and LOS</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span> <span class="ow">and</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
          <span class="ow">and</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                         <span class="n">element</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
        <span class="k">if</span> <span class="n">c1</span> <span class="ow">and</span> <span class="s1">&#39;LOS&#39;</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span><span class="p">,</span> <span class="n">llab</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">_dgeom</span><span class="p">[</span><span class="s1">&#39;lCam&#39;</span><span class="p">]:</span>
                <span class="n">lCross</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                                        <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">lHor</span> <span class="o">+=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_plotL</span><span class="p">(</span><span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;hor&#39;</span><span class="p">,</span>
                                      <span class="n">return_pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bck</span> <span class="ow">and</span> <span class="n">cc</span><span class="o">.</span><span class="n">_is2D</span><span class="p">():</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                                <span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lCross</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">crossbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">crossbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="p">[</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span>
                              <span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">nan2</span><span class="p">,</span><span class="n">lHor</span><span class="p">[</span><span class="n">indbck</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>
                    <span class="n">horbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">horbck</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">crossbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">crossbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">horbck</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">horbck</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span>
                                         <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">bck</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lax</span><span class="o">=</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="n">element</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">Lplot</span><span class="o">=</span><span class="n">Lplot</span><span class="p">,</span>
                                  <span class="n">dL</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
                                  <span class="n">dLeg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

            <span class="n">lHor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
            <span class="n">idlCross</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lCross</span><span class="p">)</span>
            <span class="n">idlHor</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">lHor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lCross</span><span class="p">,</span> <span class="n">lHor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Background</span>
    <span class="k">if</span> <span class="n">bck</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nnch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
            <span class="n">tbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">nch</span><span class="p">)</span>
            <span class="n">dbck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">nch</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tbck</span><span class="p">,</span> <span class="n">dbck</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                     <span class="n">facecolor</span><span class="o">=</span><span class="n">cbck</span><span class="p">)</span>

    <span class="c1"># Colorbars if 2D</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Data</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                                       <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>

        <span class="c1"># topos</span>
        <span class="n">norm_topos</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin_topos</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_topos</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_topos</span><span class="p">,</span>
                                       <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm_topos</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;topos (a.u.)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>

    <span class="c1"># modes</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>

    <span class="c1"># Zero for chronos and topos</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])):</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])):</span>
            <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>


    <span class="c1"># ---------------</span>
    <span class="c1"># Lims and labels</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Dt</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dd</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dchronos</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])):</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Dlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">tlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mode index&#39;</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;sing. value&#39;</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Dm</span><span class="p">)</span>
    <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Ds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">DX</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Xlab</span><span class="p">,</span> <span class="o">**</span><span class="n">fldict</span><span class="p">)</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Dtopos</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

    <span class="c1"># invert</span>
    <span class="k">if</span> <span class="n">invert</span> <span class="ow">and</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># shared axis =&gt; inverting the reference is enough</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
        <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>


    <span class="c1">##################</span>
    <span class="c1"># Interactivity dict</span>
    <span class="c1">##################</span>

    <span class="c1"># dgroup</span>
    <span class="n">dgroup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">ntMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">idt</span><span class="p">,</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]},</span>
              <span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nchMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]},</span>
              <span class="s1">&#39;mode&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;nMax&#39;</span><span class="p">:</span><span class="n">nmMax</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;f3&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;defid&#39;</span><span class="p">:</span><span class="n">idm</span><span class="p">,</span> <span class="s1">&#39;defax&#39;</span><span class="p">:</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]}}</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dgroup</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="c1"># dref</span>
    <span class="n">dref</span> <span class="o">=</span> <span class="p">{</span><span class="n">idt</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">inct</span><span class="p">},</span>
            <span class="n">idX</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incX</span><span class="p">,</span>
                   <span class="s1">&#39;otherid&#39;</span><span class="p">:</span><span class="n">Xother</span><span class="p">,</span> <span class="s1">&#39;indother&#39;</span><span class="p">:</span><span class="n">indtX</span><span class="p">},</span>
            <span class="n">idm</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">indmodes</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span><span class="n">incm</span><span class="p">}}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dref</span><span class="p">[</span><span class="n">idX</span><span class="p">][</span><span class="s1">&#39;2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>

    <span class="c1"># ddata</span>
    <span class="n">ddat</span> <span class="o">=</span> <span class="p">{</span><span class="n">iddata</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">,</span><span class="n">idX</span><span class="p">]},</span>
            <span class="n">idchans</span><span class="p">:{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">dchans</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]},</span>
            <span class="n">idchronos</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">chronos</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idm</span><span class="p">]},</span>
            <span class="n">idtopos</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">topos</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idm</span><span class="p">]}}</span>
    <span class="k">if</span> <span class="n">lCross</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlCross</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lCross</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idlHor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span><span class="n">lHor</span><span class="p">,</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ddat</span><span class="p">[</span><span class="n">idx12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;refids&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}</span>

    <span class="c1"># dax</span>
    <span class="n">lax_fix</span> <span class="o">=</span> <span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">]</span>
               <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtm&#39;</span><span class="p">])</span>
    <span class="n">dax2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ax</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">ax</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dax2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">ax</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="s1">&#39;2d&#39;</span><span class="p">},</span> <span class="s1">&#39;invert&#39;</span><span class="p">:</span><span class="n">invert</span><span class="p">})</span>
                          <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]]))</span>
    <span class="n">dax2</span><span class="p">[</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:{</span><span class="n">idm</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}}</span>

    <span class="c1"># dobj</span>
    <span class="n">dobj</span> <span class="o">=</span> <span class="p">{}</span>



    <span class="c1">##################</span>
    <span class="c1"># Populating dobj</span>
    <span class="c1">##################</span>

    <span class="n">nant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nt</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">nanch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nch</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># Channel</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>

        <span class="c1"># Channel text</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">nchMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idchans</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_X</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Channel time trace</span>
        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">nant</span><span class="p">,</span>
                               <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">iddata</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Channel vlines or pixels</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Xother</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])):</span>
                    <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                                <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
                        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span>
                                                        <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">,</span><span class="n">idX</span><span class="p">]}},</span>
                                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">,</span> <span class="n">idt</span><span class="p">:</span><span class="n">ii</span><span class="p">}}</span>

        <span class="c1"># los</span>
        <span class="k">if</span> <span class="n">c1</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                      <span class="n">c</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlCross</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;hor&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idlHor</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># Time</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">nan2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntMax</span><span class="p">):</span>
        <span class="c1"># Time txt</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mf">0.5</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">ntMax</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idt</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;{0:</span><span class="si">%s</span><span class="s1">} s&#39;</span><span class="o">%</span><span class="n">fmt_t</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Time vlines</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])):</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idt</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Time data profiles</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">nanch</span><span class="p">,</span>
                                   <span class="n">c</span><span class="o">=</span><span class="n">lct</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">iddata</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="k">if</span> <span class="n">Xother</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">Xother</span><span class="p">]}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">iddata</span><span class="p">,</span> <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">n12</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idt</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idt</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># modes</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nmMax</span><span class="p">):</span>
        <span class="c1"># mode txt</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;txtm&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">lcm</span><span class="p">[</span><span class="n">jj</span><span class="o">%</span><span class="mi">2</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                  <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;txt&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idm</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idm</span><span class="p">],</span>
                                      <span class="s1">&#39;bstr&#39;</span><span class="p">:</span><span class="s1">&#39;mode {0:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt_m</span><span class="p">}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idm</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># mode vlines</span>
        <span class="n">l0</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">lcm</span><span class="p">[</span><span class="n">jj</span><span class="o">%</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;xdata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idm</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idm</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idm</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Chronos</span>
        <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">jj</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">nant</span><span class="p">,</span>
                                     <span class="n">c</span><span class="o">=</span><span class="n">lcm</span><span class="p">[</span><span class="n">jj</span><span class="o">%</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idchronos</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idm</span><span class="p">]}},</span>
                    <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idm</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

        <span class="c1"># Topos</span>
        <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">jj</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">nanch</span><span class="p">,</span>
                                   <span class="n">c</span><span class="o">=</span><span class="n">lcm</span><span class="p">[</span><span class="n">jj</span><span class="o">%</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;ydata&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idtopos</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idm</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idm</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>
            <span class="k">if</span> <span class="n">Xother</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">][</span><span class="s1">&#39;dupdate&#39;</span><span class="p">][</span><span class="s1">&#39;xdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idX</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">Xother</span><span class="p">]}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nan2</span><span class="p">,</span>
                                       <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                       <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_topos</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_topos</span><span class="p">)</span>
            <span class="n">dobj</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data-reshape&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idtopos</span><span class="p">,</span> <span class="s1">&#39;n12&#39;</span><span class="p">:</span><span class="n">n12</span><span class="p">,</span>
                                                   <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idm</span><span class="p">]}},</span>
                        <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idm</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># pixel on top of imshows</span>
    <span class="k">if</span> <span class="n">nD</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nchMax</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])):</span>
                <span class="n">l0</span><span class="p">,</span> <span class="o">=</span> <span class="n">dax</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                                        <span class="n">mec</span><span class="o">=</span><span class="n">lcch</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                                        <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">dobj</span><span class="p">[</span><span class="n">l0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dupdate&#39;</span><span class="p">:{</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">idx12</span><span class="p">,</span> <span class="s1">&#39;lrid&#39;</span><span class="p">:[</span><span class="n">idX</span><span class="p">]}},</span>
                            <span class="s1">&#39;drefid&#39;</span><span class="p">:{</span><span class="n">idX</span><span class="p">:</span><span class="n">jj</span><span class="p">}}</span>

    <span class="c1"># Instanciate KeyHandler</span>
    <span class="n">can</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
    <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">kh</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">KeyHandler_mpl</span><span class="p">(</span><span class="n">can</span><span class="o">=</span><span class="n">can</span><span class="p">,</span>
                              <span class="n">dgroup</span><span class="o">=</span><span class="n">dgroup</span><span class="p">,</span> <span class="n">dref</span><span class="o">=</span><span class="n">dref</span><span class="p">,</span> <span class="n">ddata</span><span class="o">=</span><span class="n">ddat</span><span class="p">,</span>
                              <span class="n">dobj</span><span class="o">=</span><span class="n">dobj</span><span class="p">,</span> <span class="n">dax</span><span class="o">=</span><span class="n">dax2</span><span class="p">,</span> <span class="n">lax_fix</span><span class="o">=</span><span class="n">lax_fix</span><span class="p">,</span>
                              <span class="n">groupinit</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">disconnect_old</span><span class="p">()</span>
        <span class="n">kh</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
        <span class="n">can</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">kh</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2016-2021, Tofu contributors.<br/>
      Last updated on Oct 06, 2021.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>