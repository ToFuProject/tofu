<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tofu.pathfile &#8212; Tofu 1.5.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          tofu</a>
        <span class="navbar-text navbar-version pull-left"><b>1.5.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../installation.html">Installation</a></li>
                <li><a href="../../contributing.html">Contributing</a></li>
                <li><a href="../../auto_examples/index.html">Gallery</a></li>
                <li><a href="../../aboutus.html">About</a></li>
                <li><a href="../../releases.html">Releases</a></li>
                <li><a href="../../tofu.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">How to install tofu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">A guide to contributing to tofu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/tutorials/tuto_plot_gallery_fusion_machines.html">A list of all different device configurations available (ITER, WEST, JET, ...)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/index.html">Tutorials and examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tofu_from_bash.html">Using tofu from a bash terminal</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tofu.html">tofu package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tofu.geom.html">tofu.geom package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tofu.dumpro.html">tofu.dumpro package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tofu.data.html">tofu.data package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tofu.dust.html">tofu.dust package</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for tofu.pathfile</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Wed Jul 30 14:37:31 2014</span>

<span class="sd">@author: didiervezinet</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Built-in</span>
<span class="kn">import</span> <span class="nn">os</span>                   <span class="c1"># For accessing cuurent working direcVesy</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Common</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dtm</span>

<span class="c1"># ToFu specific</span>
<span class="kn">from</span> <span class="nn">tofu</span> <span class="kn">import</span> <span class="n">__version__</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Didier Vezinet&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span>
           <span class="s2">&quot;SaveName_Conv&quot;</span><span class="p">,</span><span class="s2">&quot;CheckSameObj&quot;</span><span class="p">,</span><span class="s2">&quot;SelectFromListId&quot;</span><span class="p">,</span>
           <span class="s2">&quot;get_InfoFromFileName&quot;</span><span class="p">,</span><span class="s2">&quot;get_FileFromInfos&quot;</span><span class="p">,</span>
           <span class="s2">&quot;convert_units&quot;</span><span class="p">,</span><span class="s2">&quot;get_PolyFromPolyFileObj&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Save_Generic&quot;</span><span class="p">,</span><span class="s2">&quot;Open&quot;</span><span class="p">]</span>

<span class="n">dModes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;geom&#39;</span><span class="p">:</span><span class="s1">&#39;TFG&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="s1">&#39;TFD&#39;</span><span class="p">}</span>
<span class="n">lCls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ves&#39;</span><span class="p">,</span><span class="s1">&#39;Struct&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Rays&#39;</span><span class="p">,</span><span class="s1">&#39;LOS&#39;</span><span class="p">,</span><span class="s1">&#39;LOSCam1D&#39;</span><span class="p">,</span><span class="s1">&#39;LOSCam2D&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GDetect&#39;</span><span class="p">,</span><span class="s1">&#39;Detect&#39;</span><span class="p">,</span><span class="s1">&#39;Cam1D&#39;</span><span class="p">,</span><span class="s1">&#39;Cam2D&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Data&#39;</span><span class="p">]</span>
<span class="n">dPref</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Exp&#39;</span><span class="p">:</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Diag&#39;</span><span class="p">:</span><span class="s1">&#39;Dg&#39;</span><span class="p">,</span><span class="s1">&#39;shot&#39;</span><span class="p">:</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;Deg&#39;</span><span class="p">:</span><span class="s1">&#39;Deg&#39;</span><span class="p">,</span>
         <span class="s1">&#39;version&#39;</span><span class="p">:</span><span class="s1">&#39;Vers&#39;</span><span class="p">,</span><span class="s1">&#39;usr&#39;</span><span class="p">:</span><span class="s1">&#39;U&#39;</span><span class="p">}</span>
<span class="n">defInclude</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">,</span><span class="s1">&#39;Cls&#39;</span><span class="p">,</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Deg&#39;</span><span class="p">,</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;shot&#39;</span><span class="p">]</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                Path Handling</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">_set_arrayorder</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">arrayorder</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">arrayorder</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg arrayorder must be in [&#39;C&#39;,&#39;F&#39;]&quot;</span>
    <span class="n">Lattr</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">Lattr</span><span class="p">:</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="ow">and</span> <span class="n">bb</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arrayorder</span><span class="o">==</span><span class="s1">&#39;C&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">bb</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">bb</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span> <span class="o">=</span> <span class="n">arrayorder</span>


<div class="viewcode-block" id="convert_units"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.convert_units">[docs]</a><span class="k">def</span> <span class="nf">convert_units</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">In</span><span class="o">=</span><span class="s1">&#39;cm&#39;</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quickly convert distance units between meters, centimeters and millimeters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;m&#39;</span><span class="p">:{</span><span class="s1">&#39;mm&#39;</span><span class="p">:</span><span class="mf">1000.</span><span class="p">,</span><span class="s1">&#39;cm&#39;</span><span class="p">:</span><span class="mf">100.</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">},</span>
            <span class="s1">&#39;cm&#39;</span><span class="p">:{</span><span class="s1">&#39;mm&#39;</span><span class="p">:</span><span class="mf">10.</span><span class="p">,</span><span class="s1">&#39;cm&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">},</span>
            <span class="s1">&#39;mm&#39;</span><span class="p">:{</span><span class="s1">&#39;mm&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span><span class="s1">&#39;cm&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">0.001</span><span class="p">}}</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="n">In</span><span class="p">][</span><span class="n">Out</span><span class="p">]</span><span class="o">*</span><span class="n">P</span></div>



<div class="viewcode-block" id="get_PolyFromPolyFileObj"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.get_PolyFromPolyFileObj">[docs]</a><span class="k">def</span> <span class="nf">get_PolyFromPolyFileObj</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">,</span> <span class="n">SavePathInp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape0</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a polygon as a np.ndarray, extracted from a txt file or from a ToFu object, with appropriate units</span>

<span class="sd">    Useful for :meth:`tofu.plugins.AUG.Ves._create()`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    PolyFileObj :   str / :mod:`tofu.geom` object / np.ndarray</span>
<span class="sd">        The source where the polygon is to be found, either:</span>
<span class="sd">            - str: the name of a file containing the coorindates of a polygon to be loaded with :meth:`numpy.loadtxt()`</span>
<span class="sd">            - A :mod:`tofu.geom` object: with attribute &#39;Poly&#39;</span>
<span class="sd">            - np.ndarray: an 2-dimensional array containing the 2D cartesian coordinates of a polygon</span>
<span class="sd">    SavePathInp :   str / None</span>
<span class="sd">        The absolute path where the input file is stored</span>
<span class="sd">    units :         str</span>
<span class="sd">        Flag indicating in which units the polygon coordinates is expressed in the input file / object / array (will be converted to meters)</span>
<span class="sd">    comments :      str</span>
<span class="sd">        Parameter to be fed to :meth:`numpy.loadtxt()` if PolyFileObj is a file name</span>
<span class="sd">    skiprows :      int</span>
<span class="sd">        Parameter to be fed to :meth:`numpy.loadtxt()` if PolyFileObj is a file name</span>
<span class="sd">    shape0 :          int</span>
<span class="sd">        Specifies whether the loaded array is a (2,N) or (3,N) array (transposed it if necessary)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Poly :          np.ndarray</span>
<span class="sd">        (2,N) np.ndarray containing the 2D cartesian coordinates of the polygon, where N is the number of points</span>
<span class="sd">    addInfo :       dict</span>
<span class="sd">        Dictionaryb containing information on the origin of the polygon, for the record (e.g.: the name and absolute path of the file from which it was extracted)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">,</span><span class="s2">&quot;Poly&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Arg PolyFileObj must be str (PathFileExt), a ToFu object with attribute Poly or an iterable convertible to 2d np.ndarray !&quot;</span>

    <span class="c1"># Load PolyFileObj if file and check shape</span>
    <span class="n">addInfo</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">get_FileFromInfos</span><span class="p">(</span><span class="n">Path</span><span class="o">=</span><span class="n">SavePathInp</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="n">PolyFileObj</span><span class="p">)</span>
        <span class="c1"># Include PathFileExt in ID for tracability</span>
        <span class="n">addInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Input&#39;</span><span class="p">:</span><span class="n">PathFileExt</span><span class="p">}</span>
        <span class="n">PolyFileObj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">,</span><span class="s2">&quot;Poly&quot;</span><span class="p">):</span>
        <span class="n">addInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Input&#39;</span><span class="p">:</span><span class="n">PolyFileObj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">}</span>
        <span class="n">PolyFileObj</span> <span class="o">=</span> <span class="n">PolyFileObj</span><span class="o">.</span><span class="n">Poly</span>

    <span class="n">Poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Poly</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">shape0</span> <span class="ow">in</span> <span class="n">Poly</span><span class="o">.</span><span class="n">shape</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">Poly</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Poly</span><span class="p">)),</span> <span class="s2">&quot;Arg np.asarray(PolyFileObj) must be a (2,N) or (N,2) np.ndarray with non NaNs !&quot;</span>
    <span class="n">Poly</span> <span class="o">=</span> <span class="n">Poly</span> <span class="k">if</span> <span class="n">Poly</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">shape0</span> <span class="k">else</span> <span class="n">Poly</span><span class="o">.</span><span class="n">T</span>
    <span class="n">Poly</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="n">Poly</span><span class="p">,</span> <span class="n">In</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">addInfo</span></div>






<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                Generic input checking and retrieving</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Deprecated ???</span>
<span class="k">def</span> <span class="nf">_check_NotNone</span><span class="p">(</span><span class="n">Dict</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">Dict</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Arg &quot;</span><span class="o">+</span><span class="n">aa</span><span class="o">+</span><span class="s2">&quot; must not be None !&quot;</span>


<span class="c1"># Deprecated ???</span>
<span class="k">def</span> <span class="nf">_get_FromItself</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">Dict</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Dict</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">Dict</span>



<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                ID Class and naming</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Deprecated ????</span>
<div class="viewcode-block" id="ID"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID">[docs]</a><span class="k">class</span> <span class="nc">ID</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A class used by all ToFu objects as an attribute</span>

<span class="sd">    It stores all relevant data for the identification of instances</span>
<span class="sd">    Stored info can be the name of the instance, the experiment and diagnostics</span>
<span class="sd">    it belongs to, or other user-defined info</span>
<span class="sd">    Also provides default names for saving the instances</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Cls :       str</span>
<span class="sd">        Class of the object on which info should be stored:</span>
<span class="sd">    Name :      str</span>
<span class="sd">        Name of the instance (user-defined)</span>
<span class="sd">        Should be a str without space &#39; &#39; or underscore &#39;_&#39;</span>
<span class="sd">        (automatically removed if present)</span>
<span class="sd">    Type :      None / str</span>
<span class="sd">        Type of object (i.e.: &#39;Tor&#39; or &#39;Lin&#39; for a :class:`~tofu.geom.Ves`)</span>
<span class="sd">    Deg :       None / int</span>
<span class="sd">        Degree of the b-splines constituting the :mod:`tofu.mesh` object</span>
<span class="sd">    Exp :       None / str</span>
<span class="sd">        Flag specifying the experiment (e.g.: &#39;WEST&#39;, &#39;AUG&#39;, &#39;ITER&#39;, &#39;JET&#39;...)</span>
<span class="sd">    Diag :      None / str</span>
<span class="sd">        Flag indicating the diagnostic (e.g.: &#39;SXR&#39;, &#39;HXR&#39;, &#39;Bolo&#39;...)</span>
<span class="sd">    shot :      None / int</span>
<span class="sd">        A shot number from which the instance is valid (for tracking changes)</span>
<span class="sd">    SaveName :  None / str</span>
<span class="sd">        Overrides the default file name for saving (not recommended)</span>
<span class="sd">    SavePath :  None / str</span>
<span class="sd">        Absolute path where the instance should be saved</span>
<span class="sd">    USRdict :   None / dict</span>
<span class="sd">        A user-defined dictionary containing information about the instance</span>
<span class="sd">        All info considered relevant can be passed here</span>
<span class="sd">        (e.g.: thickness of the diode, date of installation...)</span>
<span class="sd">    LObj :      None / dict / list</span>
<span class="sd">        Either:</span>
<span class="sd">            - list: list of other ID instances of objects on which the created object depends (this list will then be sorted by class and formatted into a dictionary storign key attributes)</span>
<span class="sd">            - dict: a ready-made such dictionary</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Exp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">SavePath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">),</span>
                 <span class="n">USRdict</span><span class="o">=</span><span class="p">{},</span> <span class="n">LObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fromdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Include</span><span class="o">=</span><span class="n">defInclude</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">fromdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">Cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">Name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs</span><span class="p">(</span><span class="n">Cls</span><span class="o">=</span><span class="n">Cls</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">Type</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="n">Deg</span><span class="p">,</span>
                               <span class="n">Exp</span><span class="o">=</span><span class="n">Exp</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">shot</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">,</span>
                               <span class="n">SavePath</span><span class="o">=</span><span class="n">SavePath</span><span class="p">,</span> <span class="n">USRdict</span><span class="o">=</span><span class="n">USRdict</span><span class="p">,</span>
                               <span class="n">Include</span><span class="o">=</span><span class="n">Include</span><span class="p">)</span>

            <span class="c1"># Try to get the user name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="n">__version__</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_usr</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_usr</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Set fixed attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Cls</span> <span class="o">=</span> <span class="n">_extract_ModClsFrom_class</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SavePath</span> <span class="o">=</span> <span class="n">Type</span><span class="p">,</span> <span class="n">SavePath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Diag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shot</span> <span class="o">=</span> <span class="n">Exp</span><span class="p">,</span> <span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Deg</span> <span class="o">=</span> <span class="n">Deg</span>

            <span class="c1"># Set variable attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_Name</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">,</span> <span class="n">Include</span><span class="o">=</span><span class="n">Include</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_LObj</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_USRdict</span><span class="p">(</span><span class="n">USRdict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fromdict</span><span class="p">(</span><span class="n">fromdict</span><span class="p">)</span>

<div class="viewcode-block" id="ID._fromdict"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID._fromdict">[docs]</a>    <span class="k">def</span> <span class="nf">_fromdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">fd</span><span class="p">)</span>
        <span class="c1"># Set fixed attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Type</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">],</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;Cls&#39;</span><span class="p">],</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Diag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shot</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;Exp&#39;</span><span class="p">],</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;Diag&#39;</span><span class="p">],</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;shot&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SavePath</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;Deg&#39;</span><span class="p">],</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;SavePath&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_usr</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">],</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;usr&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_USRdict</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;USRdict&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;LObj&#39;</span><span class="p">]</span>
        <span class="c1"># Set variable attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;SaveName&#39;</span><span class="p">]</span>
        <span class="c1"># Check the original tofu version against the current version</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="o">==</span><span class="n">__version__</span><span class="p">:</span>
            <span class="n">Str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="o">+</span><span class="s2">&quot; was created from a different ToFu version !</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">Str</span> <span class="o">+=</span> <span class="s2">&quot;original : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_version</span>
            <span class="n">Str</span> <span class="o">+=</span> <span class="s2">&quot;current  : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">__version__</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Str</span><span class="p">)</span></div>

<div class="viewcode-block" id="ID._todict"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID._todict">[docs]</a>    <span class="k">def</span> <span class="nf">_todict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mod&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_Mod</span><span class="p">,</span> <span class="s1">&#39;Cls&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Cls</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span>
             <span class="s1">&#39;Name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="s1">&#39;SaveName&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">SaveName</span><span class="p">,</span>
             <span class="s1">&#39;SavePath&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span> <span class="s1">&#39;Exp&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="s1">&#39;Diag&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span>
             <span class="s1">&#39;shot&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span> <span class="s1">&#39;Deg&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_Deg</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">,</span>
             <span class="s1">&#39;usr&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_usr</span><span class="p">,</span> <span class="s1">&#39;USRdict&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">USRdict</span><span class="p">,</span> <span class="s1">&#39;LObj&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">LObj</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="ID._check_inputs"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID._check_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">_check_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">Exp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">SavePath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">USRdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">LObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">usr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fromdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Include</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_ID_check_inputs</span><span class="p">(</span><span class="n">Cls</span><span class="o">=</span><span class="n">Cls</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">Type</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="n">Deg</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="n">Exp</span><span class="p">,</span>
                         <span class="n">Diag</span><span class="o">=</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">shot</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">,</span>
                         <span class="n">SavePath</span><span class="o">=</span><span class="n">SavePath</span><span class="p">,</span> <span class="n">USRdict</span><span class="o">=</span><span class="n">USRdict</span><span class="p">,</span> <span class="n">LObj</span><span class="o">=</span><span class="n">LObj</span><span class="p">,</span>
                         <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="n">usr</span><span class="p">,</span> <span class="n">fromdict</span><span class="o">=</span><span class="n">fromdict</span><span class="p">,</span>
                         <span class="n">Include</span><span class="o">=</span><span class="n">Include</span><span class="p">)</span></div>

<div class="viewcode-block" id="ID.set_Name"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID.set_Name">[docs]</a>    <span class="k">def</span> <span class="nf">set_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Include</span><span class="o">=</span><span class="n">defInclude</span><span class="p">,</span>
                 <span class="n">ForceUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the Name of the instance, automatically updating the SaveName</span>

<span class="sd">        The name should be a str without spaces or underscores (removed)</span>
<span class="sd">        When the name is changed, if SaveName (i.e. the name used for saving)</span>
<span class="sd">        was not user-defined, it is automatically updated</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Name :      str</span>
<span class="sd">            Name of the instance, without &#39; &#39; or &#39;_&#39; (automatically removed)</span>
<span class="sd">        SaveName :  None / str</span>
<span class="sd">            If provided, overrides the default name for saving (not recommended)</span>
<span class="sd">        Include:    list</span>
<span class="sd">            Controls how te default SaveName is generated</span>
<span class="sd">            Each element of the list is a key str indicating whether an element</span>
<span class="sd">            should be present in the SaveName</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">,</span> <span class="n">Include</span><span class="o">=</span><span class="n">Include</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="n">Name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_SaveName</span><span class="p">(</span><span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">,</span> <span class="n">Include</span><span class="o">=</span><span class="n">Include</span><span class="p">,</span>
                          <span class="n">ForceUpdate</span><span class="o">=</span><span class="n">ForceUpdate</span><span class="p">)</span></div>

<div class="viewcode-block" id="ID.set_SaveName"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID.set_SaveName">[docs]</a>    <span class="k">def</span> <span class="nf">set_SaveName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">SaveName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">Include</span><span class="o">=</span><span class="n">defInclude</span><span class="p">,</span>
                     <span class="n">ForceUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the name for saving the instance (SaveName)</span>

<span class="sd">        SaveName can be either:</span>
<span class="sd">            - provided by the user (no constraint) - not recommended</span>
<span class="sd">            - automatically generated from Name and key attributes (cf. Include)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        SaveName :      None / str</span>
<span class="sd">            If provided, overrides the default name for saving (not recommended)</span>
<span class="sd">        Include :       list</span>
<span class="sd">            Controls how te default SaveName is generated</span>
<span class="sd">            Each element of the list is a key str indicating whether an element</span>
<span class="sd">            should be present in the SaveName</span>
<span class="sd">        ForceUpdate :   bool</span>
<span class="sd">            Flag indicating the behaviour when SaveName=None:</span>
<span class="sd">                - True : A new SaveName is generated, overriding the old one</span>
<span class="sd">                - False : The former SaveName is preserved (default)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs</span><span class="p">(</span><span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">,</span> <span class="n">Include</span><span class="o">=</span><span class="n">Include</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_SaveName_usr&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName_usr</span> <span class="o">=</span> <span class="p">(</span><span class="n">SaveName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># If SaveName provided by user, override</span>
        <span class="k">if</span> <span class="n">SaveName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName</span> <span class="o">=</span> <span class="n">SaveName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName_usr</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Don&#39;t update if former is user-defined and ForceUpdate is False</span>
            <span class="c1"># Override if previous was:</span>
            <span class="c1"># automatic or (user-defined but ForceUpdate is True)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName_usr</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SaveName_usr</span> <span class="ow">and</span> <span class="n">ForceUpdate</span><span class="p">):</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="n">SaveName_Conv</span><span class="p">(</span><span class="n">Mod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Mod</span><span class="p">,</span> <span class="n">Cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cls</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span>
                                   <span class="n">Name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Deg</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span>
                                   <span class="n">Diag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span>
                                   <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_usr</span><span class="p">,</span>
                                   <span class="n">Include</span><span class="o">=</span><span class="n">Include</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName</span> <span class="o">=</span> <span class="n">SN</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName_usr</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ID.set_LObj"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID.set_LObj">[docs]</a>    <span class="k">def</span> <span class="nf">set_LObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">LObj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the LObj attribute, storing objects the instance depends on</span>

<span class="sd">        For example:</span>
<span class="sd">        A Detect object depends on a vessel and some apertures</span>
<span class="sd">        That link between should be stored somewhere (for saving/loading).</span>
<span class="sd">        LObj does this: it stores the ID (as dict) of all objects depended on.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        LObj :  None / dict / :class:`~tofu.pathfile.ID` / list of such</span>
<span class="sd">            Provide either:</span>
<span class="sd">                - A dict (derived from :meth:`~tofu.pathfile.ID._todict`)</span>
<span class="sd">                - A :class:`~tofu.pathfile.ID` instance</span>
<span class="sd">                - A list of dict or :class:`~tofu.pathfile.ID` instances</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">LObj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">LObj</span> <span class="o">=</span> <span class="p">[</span><span class="n">LObj</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LObj</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="ow">is</span> <span class="n">ID</span><span class="p">:</span>
                    <span class="n">LObj</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">LObj</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span>
            <span class="n">ClsU</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">oo</span><span class="p">[</span><span class="s1">&#39;Cls&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ClsU</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">oo</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="p">[</span><span class="s1">&#39;Cls&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">c</span><span class="p">]</span></div>

<div class="viewcode-block" id="ID.set_USRdict"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.ID.set_USRdict">[docs]</a>    <span class="k">def</span> <span class="nf">set_USRdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">USRdict</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot; Set the USRdict, containing user-defined info about the instance</span>

<span class="sd">        Useful for arbitrary info (e.g.: manufacturing date, material...)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        USRdict :   dict</span>
<span class="sd">            A user-defined dictionary containing info about the instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs</span><span class="p">(</span><span class="n">USRdict</span><span class="o">=</span><span class="n">USRdict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_USRdict</span> <span class="o">=</span> <span class="n">USRdict</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Cls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Cls</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">NameLTX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;\_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Exp</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Diag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Diag</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shot</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Type</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SaveName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SavePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SavePath</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">LObj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">USRdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_USRdict</span></div>




<span class="c1"># Deprecated ????</span>
<span class="k">def</span> <span class="nf">_ID_check_inputs</span><span class="p">(</span><span class="n">Mod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Exp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SavePath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">USRdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">LObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fromdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Include</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Mod</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
        <span class="k">assert</span> <span class="n">Mod</span> <span class="ow">in</span> <span class="n">dModes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">Cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">type</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s1">&#39;tofu.&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">ss</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">dModes</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">ss</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">lCls</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="n">lCls</span>
    <span class="n">Lstr</span> <span class="o">=</span> <span class="p">[</span><span class="n">Name</span><span class="p">,</span><span class="n">Type</span><span class="p">,</span><span class="n">Exp</span><span class="p">,</span><span class="n">Diag</span><span class="p">,</span><span class="n">SaveName</span><span class="p">,</span><span class="n">SavePath</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">usr</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">Lstr</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">ss</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
    <span class="n">Lint</span> <span class="o">=</span> <span class="p">[</span><span class="n">Deg</span><span class="p">,</span><span class="n">shot</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">Lint</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">ii</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">USRdict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">USRdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span>
    <span class="k">if</span> <span class="n">Include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">IR</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">,</span><span class="s1">&#39;Cls&#39;</span><span class="p">,</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">dPref</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Include</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Include</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">Include</span> <span class="ow">in</span> <span class="n">IR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">Include</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">IR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not in &quot;</span><span class="o">%</span><span class="n">ss</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">LObj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">ID</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">oo</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span><span class="n">ID</span><span class="p">]</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">fromdict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">fromdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cls&#39;</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;SaveName&#39;</span><span class="p">,</span><span class="s1">&#39;SavePath&#39;</span><span class="p">,</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span><span class="s1">&#39;Deg&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span>
             <span class="s1">&#39;shot&#39;</span><span class="p">,</span><span class="s1">&#39;dUSR&#39;</span><span class="p">,</span><span class="s1">&#39;version&#39;</span><span class="p">,</span><span class="s1">&#39;usr&#39;</span><span class="p">,</span><span class="s1">&#39;lObj&#39;</span><span class="p">]</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">fromdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">K</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> missing from provided dict !&quot;</span><span class="o">%</span><span class="n">kk</span>


<span class="c1"># Deprecated ????</span>
<span class="k">def</span> <span class="nf">_extract_ModClsFrom_class</span><span class="p">(</span><span class="n">Cls</span><span class="p">):</span>
    <span class="n">strc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span>
    <span class="n">ind0</span> <span class="o">=</span> <span class="n">strc</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;tofu.&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span>
    <span class="n">indeol</span> <span class="o">=</span> <span class="n">strc</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;&#39;&gt;&quot;</span><span class="p">)</span>
    <span class="n">strc</span> <span class="o">=</span> <span class="n">strc</span><span class="p">[</span><span class="n">ind0</span><span class="p">:</span><span class="n">indeol</span><span class="p">]</span>
    <span class="n">indp</span> <span class="o">=</span> <span class="n">strc</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">Mod</span> <span class="o">=</span> <span class="n">strc</span><span class="p">[:</span><span class="n">indp</span><span class="p">]</span>
    <span class="n">strc</span> <span class="o">=</span> <span class="n">strc</span><span class="p">[</span><span class="n">indp</span><span class="o">+</span><span class="mi">1</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">strc</span><span class="p">[:</span><span class="n">strc</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Mod</span><span class="p">,</span> <span class="bp">cls</span>



<div class="viewcode-block" id="SaveName_Conv"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.SaveName_Conv">[docs]</a><span class="k">def</span> <span class="nf">SaveName_Conv</span><span class="p">(</span><span class="n">Mod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">Exp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">Include</span><span class="o">=</span><span class="n">defInclude</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a default name for saving the object</span>

<span class="sd">    Includes key info for fast identification of the object from file name</span>
<span class="sd">    Used on object creation by :class:`~tofu.pathfile.ID`</span>
<span class="sd">    It is recommended to use this default name.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Modstr</span> <span class="o">=</span> <span class="n">dModes</span><span class="p">[</span><span class="n">Mod</span><span class="p">]</span> <span class="k">if</span> <span class="n">Mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">Include</span> <span class="o">=</span> <span class="n">defInclude</span> <span class="k">if</span> <span class="n">Include</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Include</span>
    <span class="k">if</span> <span class="n">Cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;Type&#39;</span> <span class="ow">in</span> <span class="n">Include</span><span class="p">:</span>
        <span class="n">Clsstr</span> <span class="o">=</span> <span class="n">Cls</span><span class="o">+</span><span class="n">Type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Clsstr</span> <span class="o">=</span> <span class="n">Cls</span>
    <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mod&#39;</span><span class="p">:</span><span class="n">Modstr</span><span class="p">,</span> <span class="s1">&#39;Cls&#39;</span><span class="p">:</span><span class="n">Clsstr</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span><span class="n">Name</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">Include</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">,</span><span class="s1">&#39;Cls&#39;</span><span class="p">,</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">]:</span>
            <span class="n">Dict</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="s1">&#39;Deg&#39;</span> <span class="ow">and</span> <span class="n">Deg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Dict</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPref</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{0:02.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Deg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ii</span><span class="o">==</span><span class="s1">&#39;shot&#39;</span> <span class="ow">and</span> <span class="n">shot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Dict</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPref</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{0:05.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">,</span><span class="s1">&#39;Cls&#39;</span><span class="p">,</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="s1">&#39; is not None&#39;</span><span class="p">):</span>
            <span class="n">Dict</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPref</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="nb">eval</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Data&#39;</span> <span class="ow">in</span> <span class="n">Cls</span><span class="p">:</span>
        <span class="n">Order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">,</span><span class="s1">&#39;Cls&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Deg&#39;</span><span class="p">,</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span><span class="s1">&#39;shot&#39;</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;version&#39;</span><span class="p">,</span><span class="s1">&#39;usr&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">,</span><span class="s1">&#39;Cls&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Deg&#39;</span><span class="p">,</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;shot&#39;</span><span class="p">,</span><span class="s1">&#39;version&#39;</span><span class="p">,</span><span class="s1">&#39;usr&#39;</span><span class="p">]</span>

    <span class="n">SVN</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Order</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">Order</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Include</span> <span class="ow">and</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Order</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">SVN</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Order</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span>
    <span class="n">SVN</span> <span class="o">=</span> <span class="n">SVN</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">SVN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;_&#39;</span><span class="p">:</span>
        <span class="n">SVN</span> <span class="o">=</span> <span class="n">SVN</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">SVN</span></div>


<div class="viewcode-block" id="CheckSameObj"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.CheckSameObj">[docs]</a><span class="k">def</span> <span class="nf">CheckSameObj</span><span class="p">(</span><span class="n">obj0</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">LFields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if two variables are the same instance of a ToFu class</span>

<span class="sd">    Checks a list of attributes, provided by LFields</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj0 :      tofu object</span>
<span class="sd">        A variable refering to a ToFu object of any class</span>
<span class="sd">    obj1 :      tofu object</span>
<span class="sd">        A variable refering to a ToFu object of the same class as obj0</span>
<span class="sd">    LFields :   None / str / list</span>
<span class="sd">        The criteria against which the two objects are evaluated:</span>
<span class="sd">            - None: True is returned</span>
<span class="sd">            - str or list: tests whether all listed attributes have the same value</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A :     bool</span>
<span class="sd">        True only is LFields is None or a list of attributes that all match</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">LFields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obj0</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">obj1</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">LFields</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">LFields</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">LFields</span> <span class="o">=</span> <span class="p">[</span><span class="n">LFields</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">LFields</span><span class="p">])</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LFields</span><span class="p">))]</span>
        <span class="n">Dir0</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj0</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span><span class="o">+</span><span class="nb">dir</span><span class="p">(</span><span class="n">obj0</span><span class="p">)</span>
        <span class="n">Dir1</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span><span class="o">+</span><span class="nb">dir</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LFields</span><span class="p">)):</span>
            <span class="k">assert</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Dir0</span><span class="p">,</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; not in &quot;</span><span class="o">+</span><span class="n">obj0</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span>
            <span class="k">assert</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Dir1</span><span class="p">,</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; not in &quot;</span><span class="o">+</span><span class="n">obj1</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj0</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj0</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">==</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj0</span><span class="o">.</span><span class="n">Id</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">==</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">Id</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">A</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span></div>




<span class="sd">&quot;&quot;&quot; Not used ?</span>
<span class="sd">def SelectFromIdLObj(IdLObjCls, Val=None, Crit=&#39;Name&#39;, PreExp=None, PostExp=None, Log=&#39;any&#39;, InOut=&#39;In&#39;, Out=bool):</span>
<span class="sd">    # To do (deprecated ?)</span>
<span class="sd">    assert type(Crit) is str or (type(Crit) is list and all([type(cc) is str for cc in Crit])), &quot;Arg Crit must be a str or list of str !&quot;</span>
<span class="sd">    assert all([rr is None or type(rr) is str or (type(rr) is list and all([type(ee) is str for ee in rr])) for rr in [PreExp,PostExp]]), &quot;Args PreExp and PostExp must be a str or list of str !&quot;</span>
<span class="sd">    assert Log in [&#39;any&#39;,&#39;all&#39;], &quot;Arg Log must be in [&#39;and&#39;,&#39;or&#39;] !&quot;</span>
<span class="sd">    assert InOut in [&#39;In&#39;,&#39;Out&#39;], &quot;Arg InOut must be in [&#39;In&#39;,&#39;Out&#39;] !&quot;</span>
<span class="sd">    NObj = len(IdLObjCls[&#39;Name&#39;])</span>
<span class="sd">    if Val is None and PreExp is None and PostExp is None:</span>
<span class="sd">        ind = np.ones((1,NObj),dtype=bool)</span>
<span class="sd">    elif not Val is None:</span>
<span class="sd">        if type(Val) is str:</span>
<span class="sd">            Val=[Val]</span>
<span class="sd">        N = len(Val)</span>
<span class="sd">        ind = np.zeros((N,NObj),dtype=bool)</span>
<span class="sd">        if Crit in dir(ID):</span>
<span class="sd">            for ii in range(0,N):</span>
<span class="sd">                ind[ii,:] = np.asarray([idd==Val[ii] for idd in IdLObjCls[Crit]],dtype=bool)</span>
<span class="sd">        else:</span>
<span class="sd">            for ii in range(0,N):</span>
<span class="sd">                ind[ii,:] = np.asarray([idd[Crit]==Val[ii] for idd in IdLObjCls[&#39;USRdict&#39;]],dtype=bool)</span>
<span class="sd">    else:</span>
<span class="sd">        if type(PreExp) is str:</span>
<span class="sd">            PreExp = [PreExp]</span>
<span class="sd">        if type(PostExp) is str:</span>
<span class="sd">            PostExp = [PostExp]</span>
<span class="sd">        if PreExp is None:</span>
<span class="sd">            PreExp = [&quot;&quot; for ss in PostExp]</span>
<span class="sd">        if PostExp is None:</span>
<span class="sd">            PostExp = [&quot;&quot; for ss in PreExp]</span>
<span class="sd">        assert len(PreExp)==len(PostExp), &quot;Arg Exp must be a list of same length as Crit !&quot;</span>
<span class="sd">        N = len(PreExp)</span>
<span class="sd">        ind = np.zeros((N,NObj),dtype=bool)</span>
<span class="sd">        if Crit in dir(ID):</span>
<span class="sd">            for ii in range(0,N):</span>
<span class="sd">                ind[ii,:] = np.asarray([eval(PreExp[ii]+&quot; idd &quot;+PostExp[ii]) for idd in IdLObjCls[Crit]],dtype=bool)</span>
<span class="sd">        else:</span>
<span class="sd">            for ii in range(0,N):</span>
<span class="sd">                ind[ii,:] = np.asarray([eval(PreExp[ii]+&quot; idd[Crit] &quot;+PostExp[ii]) for idd in IdLObjCls[&#39;USRdict&#39;]],dtype=bool)</span>
<span class="sd">    ind = np.any(ind,axis=0) if Log==&#39;any&#39; else np.all(ind,axis=0)</span>
<span class="sd">    if InOut==&#39;Out&#39;:</span>
<span class="sd">        ind = ~ind</span>
<span class="sd">    if Out==bool:</span>
<span class="sd">        return ind</span>
<span class="sd">    elif Out==int:</span>
<span class="sd">        return ind.nonzero()[0]</span>
<span class="sd">    else:</span>
<span class="sd">        if Out in dir(ID):</span>
<span class="sd">            return [IdLObjCls[Out][ii] for ii in ind.nonzero()[0]]</span>
<span class="sd">        else:</span>
<span class="sd">            return [IdLObjCls[&#39;USRdict&#39;][ii][Out] for ii in ind.nonzero()[0]]</span>
<span class="sd">&quot;&quot;&quot;</span>






<div class="viewcode-block" id="SelectFromListId"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.SelectFromListId">[docs]</a><span class="k">def</span> <span class="nf">SelectFromListId</span><span class="p">(</span><span class="n">LId</span><span class="p">,</span> <span class="n">Val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Crit</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span>
                     <span class="n">PreExp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">PostExp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Log</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span>
                     <span class="n">InOut</span><span class="o">=</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="nb">bool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return the indices or instances of all LOS matching criteria</span>

<span class="sd">    The selection can be done according to 2 different mechanisms</span>

<span class="sd">    Mechanism (1): provide the value (Val) a criterion (Crit) should match</span>
<span class="sd">    The criteria are typically attributes of :class:`~tofu.pathfile.ID`</span>
<span class="sd">    (i.e.: name, or user-defined attributes like the camera head...)</span>

<span class="sd">    Mechanism (2): (used if Val=None)</span>
<span class="sd">    Provide a str expression (or a list of such) to be fed to eval()</span>
<span class="sd">    Used to check on quantitative criteria.</span>
<span class="sd">        - PreExp: placed before the criterion value (e.g.: &#39;not &#39; or &#39;&lt;=&#39;)</span>
<span class="sd">        - PostExp: placed after the criterion value</span>
<span class="sd">        - you can use both</span>

<span class="sd">    Other parameters are used to specify logical operators for the selection</span>
<span class="sd">    (match any or all the criterion...) and the type of output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Crit :      str</span>
<span class="sd">        Flag indicating which criterion to use for discrimination</span>
<span class="sd">        Can be set to:</span>
<span class="sd">            - any attribute of :class:`~tofu.pathfile.ID`</span>
<span class="sd">              (e.g.: &#39;Name&#39;,&#39;SaveName&#39;,&#39;SavePath&#39;...)</span>
<span class="sd">            - any key of ID.USRdict (e.g.: &#39;Exp&#39;...)</span>
<span class="sd">    Val :       None / list / str</span>
<span class="sd">        The value to match for the chosen criterion, can be a list</span>
<span class="sd">        Used for selection mechanism (1)</span>
<span class="sd">    PreExp :    None / list / str</span>
<span class="sd">        A str (or list of such) expression to be fed to eval(),</span>
<span class="sd">        Placed before the criterion value</span>
<span class="sd">        Used for selection mechanism (2)</span>
<span class="sd">    PostExp :   None / list / str</span>
<span class="sd">        A str (or list of such) expression to be fed to eval()</span>
<span class="sd">        Placed after the criterion value</span>
<span class="sd">        Used for selection mechanism (2)</span>
<span class="sd">    Log :       str</span>
<span class="sd">        Flag indicating whether the criterion shall match:</span>
<span class="sd">            - &#39;all&#39;: all provided values</span>
<span class="sd">            - &#39;any&#39;: at least one of them</span>
<span class="sd">    InOut :     str</span>
<span class="sd">        Flag indicating whether the returned indices are:</span>
<span class="sd">            - &#39;In&#39;: the ones matching the criterion</span>
<span class="sd">            - &#39;Out&#39;: the ones not matching it</span>
<span class="sd">    Out :       type / str</span>
<span class="sd">        Flag indicating in which form to return the result:</span>
<span class="sd">            - int: as an array of integer indices</span>
<span class="sd">            - bool: as an array of boolean indices</span>
<span class="sd">            - &#39;Name&#39;: as a list of names</span>
<span class="sd">            - &#39;LOS&#39;: as a list of :class:`~tofu.geom.LOS` instances</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ind :       list / np.ndarray</span>
<span class="sd">        The computed output, of nature defined by parameter Out</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">Crit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">Crit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">Crit</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">C0</span> <span class="ow">or</span> <span class="n">C1</span><span class="p">,</span> <span class="s2">&quot;Arg Crit must be a str or list of str !&quot;</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PreExp</span><span class="p">,</span><span class="n">PostExp</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">rr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">C0</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
            <span class="n">C1</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">])</span>
            <span class="k">assert</span> <span class="n">C0</span> <span class="ow">or</span> <span class="n">C1</span><span class="p">,</span>  <span class="s2">&quot;Args %S must be a str or list of str !&quot;</span><span class="o">%</span><span class="n">rr</span>
    <span class="k">assert</span> <span class="n">Log</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;any&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg Log must be in [&#39;any&#39;,&#39;all&#39;] !&quot;</span>
    <span class="k">assert</span> <span class="n">InOut</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;In&#39;</span><span class="p">,</span><span class="s1">&#39;Out&#39;</span><span class="p">],</span> <span class="s2">&quot;Arg InOut must be in [&#39;In&#39;,&#39;Out&#39;] !&quot;</span>
    <span class="k">if</span> <span class="n">Val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LId</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">Val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">Val</span><span class="o">=</span><span class="p">[</span><span class="n">Val</span><span class="p">]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LId</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Crit</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">iid</span><span class="p">,</span><span class="n">Crit</span><span class="p">)</span><span class="o">==</span><span class="n">Val</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                                        <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">iid</span><span class="o">.</span><span class="n">USRdict</span><span class="p">[</span><span class="n">Crit</span><span class="p">]</span><span class="o">==</span><span class="n">Val</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                                        <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">PreExp</span> <span class="o">=</span> <span class="p">[</span><span class="n">PreExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PostExp</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">PostExp</span> <span class="o">=</span> <span class="p">[</span><span class="n">PostExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">PreExp</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">PostExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">PostExp</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">PreExp</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">PostExp</span><span class="p">),</span> <span class="s2">&quot;len(PreExp) should be =len(PostExp)&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LId</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Crit</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">PreExp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; getattr(iid,&#39;</span><span class="si">%s</span><span class="s2">&#39;) &quot;</span><span class="o">%</span><span class="n">Crit</span><span class="o">+</span><span class="n">PostExp</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">]</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">List</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">PreExp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; iid.USRdict[&#39;</span><span class="si">%s</span><span class="s2">&#39;] &quot;</span><span class="o">%</span><span class="n">Crit</span><span class="o">+</span><span class="n">PostExp</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">]</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">List</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">Log</span><span class="o">==</span><span class="s1">&#39;any&#39;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">InOut</span><span class="o">==</span><span class="s1">&#39;Out&#39;</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="o">~</span><span class="n">ind</span>
    <span class="k">if</span> <span class="n">Out</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">Out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">Out</span><span class="p">):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">LId</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">Out</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">Out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="n">Out</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">USRdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">LId</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">USRdict</span><span class="p">[</span><span class="n">Out</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">ind</span></div>


<span class="c1">#def _Id_todict(Id):</span>
<span class="c1">#    IdTxt = {&#39;version&#39;:Id._version, &#39;Cls&#39;:Id.Cls, &#39;Name&#39;:Id.Name, &#39;SaveName&#39;:Id.SaveName, &#39;SavePath&#39;:Id.SavePath, &#39;Diag&#39;:Id.Diag, &#39;Type&#39;:Id.Type, &#39;shot&#39;:Id.shot, &#39;Exp&#39;:Id.Exp}</span>
<span class="c1">#    Iddtime = {&#39;dtime&#39;:Id.dtime, &#39;dtFormat&#39;:Id._dtFormat}</span>
<span class="c1">#    IdLobjUsr = {&#39;LObj&#39;:Id.LObj, &#39;USRdict&#39;:Id.USRdict}</span>
<span class="c1">#    return [IdTxt,Iddtime,IdLobjUsr]</span>


<span class="k">def</span> <span class="nf">_Id_recreateFromdict</span><span class="p">(</span><span class="n">IdS</span><span class="p">):</span>
    <span class="n">Id</span> <span class="o">=</span> <span class="n">ID</span><span class="p">(</span><span class="n">Cls</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Cls&#39;</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Type&#39;</span><span class="p">],</span> <span class="n">Exp</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Exp&#39;</span><span class="p">],</span>
            <span class="n">Diag</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Diag&#39;</span><span class="p">],</span> <span class="n">shot</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;shot&#39;</span><span class="p">],</span> <span class="n">Name</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span>
            <span class="n">SaveName</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">],</span> <span class="n">SavePath</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">],</span>
            <span class="n">dtime</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;dtime&#39;</span><span class="p">],</span> <span class="n">dtFormat</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;dtFormat&#39;</span><span class="p">],</span>
            <span class="n">LObj</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;LObj&#39;</span><span class="p">],</span> <span class="n">USRdict</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;USRdict&#39;</span><span class="p">],</span>
            <span class="n">version</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">Id</span>





<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">        Saving and loading ToFu objects with numpy and cPickle</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1">###########################</span>
<span class="c1">#   Identify a Sol2D file</span>
<span class="c1">###########################</span>


<span class="k">def</span> <span class="nf">FindSolFile</span><span class="p">(</span><span class="n">shot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Mesh</span><span class="o">=</span><span class="s1">&#39;Rough1&#39;</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Deriv</span><span class="o">=</span><span class="s1">&#39;D2N2&#39;</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">OutPath</span><span class="o">=</span><span class="s1">&#39;/afs/ipp-garching.mpg.de/home/d/didiv/Python/tofu/src/Outputs_AUG/&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Identify the good Sol2D saved file in a given folder (OutPath), based on key ToFu criteria</span>

<span class="sd">    When trying to load a Sol2D object (i.e.: solution of a tomographic inversion), it may be handy to provide the key parameters (shot, time, mesh name, degree of basis functions, regularisation functional) instead of copy-pasting the full file name.</span>
<span class="sd">    This function identifies, within the relevant repository (OutPath), the files matching the provided criteria.</span>
<span class="sd">    This function only works of the automatically generated default SaveName was preserved for the Sol2D objects.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shot :      int</span>
<span class="sd">        A shot number</span>
<span class="sd">    t :         None / int / float</span>
<span class="sd">        A time value that must be contained in the time interval of the Sol2D file, must be provided if Dt is None</span>
<span class="sd">    Dt :        None / iterable</span>
<span class="sd">        A time interval that the Sol2D file has to match, must be provided if t is None</span>
<span class="sd">    Mesh :      str</span>
<span class="sd">        The name of the mesh that was used to compute the inversion</span>
<span class="sd">    Deg :       int</span>
<span class="sd">        The of the b-splines (LBF2D object) that were used to discretize the solution</span>
<span class="sd">    Deriv :     str</span>
<span class="sd">        The flag indicating the regularization functional that was used for the inversion</span>
<span class="sd">    Sep :       bool</span>
<span class="sd">        The flag value that was used for indicating whether the boundary constraint at the separatrix should be considered</span>
<span class="sd">    Pos :       bool</span>
<span class="sd">        The flag value that was used for indicating whether the positivity constraint was considered</span>
<span class="sd">    Outpath :   str</span>
<span class="sd">        The absolute path of the repository where to look</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out :       None / str</span>
<span class="sd">        The matching file name, if any</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">Dt</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Arg t or Dt must be None, but not both !&quot;</span>
    <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">OutPath</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;TFI_Sol2D_AUG_SXR&#39;</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">]</span>
    <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">LF</span> <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">ss</span> <span class="ow">in</span> <span class="n">ff</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">Mesh</span><span class="o">+</span><span class="s1">&#39;_D&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Deg</span><span class="p">),</span> <span class="s1">&#39;_Deriv&#39;</span><span class="o">+</span><span class="n">Deriv</span><span class="o">+</span><span class="s1">&#39;_Sep&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Sep</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_Pos&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Pos</span><span class="p">)]])]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No matching Sol2D file in &quot;</span><span class="p">,</span> <span class="n">OutPath</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">LDTstr</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span><span class="p">[</span><span class="n">ff</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_Dt&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">:</span><span class="n">ff</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;s_&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">LF</span><span class="p">]</span>
    <span class="n">LDTstr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ss</span><span class="p">[:</span><span class="mi">7</span><span class="p">],</span><span class="n">ss</span><span class="p">[</span><span class="mi">8</span><span class="p">:])</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">LDTstr</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">LF</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">))</span> <span class="k">if</span> <span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;</span><span class="si">{0:07.4f}</span><span class="s1">-</span><span class="si">{1:07.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Dt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">elif</span> <span class="n">Dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">LF</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">))</span> <span class="k">if</span> <span class="n">t</span><span class="o">&gt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">t</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No matching Sol2D file in &quot;</span><span class="p">,</span> <span class="n">OutPath</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Several matching Sol2D files in &quot;</span><span class="p">,</span> <span class="n">OutPath</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">LF</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span>


<div class="viewcode-block" id="get_InfoFromFileName"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.get_InfoFromFileName">[docs]</a><span class="k">def</span> <span class="nf">get_InfoFromFileName</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Arg PathFileExt must be a str !&quot;</span>

    <span class="c1"># Prepare input (extract file name)</span>
    <span class="n">pfe</span> <span class="o">=</span> <span class="n">PathFileExt</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ind0</span> <span class="o">=</span> <span class="n">pfe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">ind1</span> <span class="o">=</span> <span class="n">pfe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">pfe</span><span class="p">[</span><span class="n">ind0</span><span class="p">:</span><span class="n">ind1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">dout</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Extracting Module and Class</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="p">[</span><span class="n">cc</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">lCls</span> <span class="k">if</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Several modules found !&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Several classes found !&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">dout</span><span class="p">[</span><span class="s1">&#39;Mod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">dout</span><span class="p">[</span><span class="s1">&#39;Cls&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Extracting other parameters</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">dPref</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dPref</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">dPref</span><span class="p">[</span><span class="n">ii</span><span class="p">]):]</span>
            <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">dout</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Deg&#39;</span><span class="p">,</span><span class="s1">&#39;shot&#39;</span><span class="p">]:</span>
            <span class="n">dout</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dout</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">dout</span></div>


<span class="c1"># Replaces _get_PathFileExt_FromName()</span>
<div class="viewcode-block" id="get_FileFromInfos"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.get_FileFromInfos">[docs]</a><span class="k">def</span> <span class="nf">get_FileFromInfos</span><span class="p">(</span><span class="n">Path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">Mod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">Exp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Path</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">Path</span><span class="p">)</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ld</span> <span class="k">if</span> <span class="s1">&#39;.npz&#39;</span> <span class="k">if</span> <span class="n">l</span><span class="p">]</span>
    <span class="n">lstr</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mod</span><span class="p">,</span><span class="n">Cls</span><span class="p">,</span><span class="n">Type</span><span class="p">,</span><span class="n">Name</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lstr</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">lstr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ld</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ld</span> <span class="k">if</span> <span class="n">lstr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dPref</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;k is not None&#39;</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;shot&#39;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:05.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;Deg&#39;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:02.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">ld</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ld</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ld</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;None or several matching files found in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">Path</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span><span class="n">ld</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>



<span class="c1">###########################</span>
<span class="c1">#   Saving</span>
<span class="c1">###########################</span>

<span class="c1"># Deprecated ???</span>
<div class="viewcode-block" id="Save_Generic"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.Save_Generic">[docs]</a><span class="k">def</span> <span class="nf">Save_Generic</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                 <span class="n">Mode</span><span class="o">=</span><span class="s1">&#39;npz&#39;</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Save a ToFu object under file name SaveName, in folder Path</span>

<span class="sd">    ToFu provides built-in saving and loading functions for ToFu objects.</span>
<span class="sd">    There is now only one saving mode:</span>
<span class="sd">        - &#39;npz&#39;: saves a dict of key attributes using :meth:`numpy.savez`</span>

<span class="sd">    Good practices are:</span>
<span class="sd">        - save :class:`~tofu.geom.Ves` and :class:`~tofu.geom.Struct`</span>
<span class="sd">        - intermediate optics (:class:`~tofu.geom.Apert` and</span>
<span class="sd">          :class:`~tofu.geom.Lens`) generally do not need to be saved</span>
<span class="sd">          Indeed, they will be autoamtically included in larger objects</span>
<span class="sd">          like Detect or Cam objects</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SaveName :      str</span>
<span class="sd">        The file name, if None (recommended) uses obj.Id.SaveName</span>
<span class="sd">    Path :          str</span>
<span class="sd">        Path where to save the file</span>
<span class="sd">    Mode :          str</span>
<span class="sd">        Flag specifying the saving mode</span>
<span class="sd">            - &#39;npz&#39;: Only mode currently available (&#39;pck&#39; deprecated)</span>
<span class="sd">    compressed :    bool</span>
<span class="sd">        Indicate whether to use np.savez_compressed (slower but smaller files)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span>
    <span class="k">if</span> <span class="n">SaveName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">SaveName</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">SaveName</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">C</span><span class="p">,</span> <span class="s2">&quot;SaveName should not include the extension !&quot;</span>
    <span class="k">assert</span> <span class="n">Path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Path</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
    <span class="k">assert</span> <span class="n">Mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;npz&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Print</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span>
    <span class="k">if</span> <span class="n">Path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Path</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_Id</span><span class="o">.</span><span class="n">_SavePath</span> <span class="o">=</span> <span class="n">Path</span>
    <span class="k">if</span> <span class="n">Mode</span><span class="o">==</span><span class="s1">&#39;npz&#39;</span><span class="p">:</span>
        <span class="n">Ext</span> <span class="o">=</span> <span class="s1">&#39;.npz&#39;</span>
    <span class="k">if</span> <span class="n">SaveName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">SaveName</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_Id</span><span class="o">.</span><span class="n">set_SaveName</span><span class="p">(</span><span class="n">SaveName</span><span class="p">)</span>
    <span class="n">pathfileext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span><span class="n">SaveName</span><span class="o">+</span><span class="n">Ext</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ext</span><span class="o">==</span><span class="s1">&#39;.npz&#39;</span><span class="p">:</span>
        <span class="n">_save_np</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathfileext</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="n">compressed</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved in :  &quot;</span><span class="o">+</span><span class="n">pathfileext</span><span class="p">)</span></div>



<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">def _convert_Detect2Ldict(obj):</span>
<span class="sd">    # Store LOS data</span>
<span class="sd">    llos = obj.LOS.keys()</span>
<span class="sd">    LOSprops = {&#39;Keys&#39;:llos, &#39;Id&#39;:[obj.LOS[kk][&#39;LOS&#39;].Id.todict() for kk in llos], &#39;Du&#39;:[(obj.LOS[kk][&#39;LOS&#39;].D,obj.LOS[kk][&#39;LOS&#39;].u) for kk in llos]}</span>
<span class="sd">    lprops = obj.LOS[kk].keys()</span>
<span class="sd">    for pp in lprops:</span>
<span class="sd">        if not pp==&#39;LOS&#39;:</span>
<span class="sd">            LOSprops[pp] = [obj.LOS[kk][pp] for kk in llos]</span>

<span class="sd">    # Get all attributes</span>
<span class="sd">    lAttr = dir(obj)</span>
<span class="sd">    Sino, Span, Cone, SAng, SynthDiag, Res = {}, {}, {}, {}, {}, {}</span>

<span class="sd">    # Store Sino data</span>
<span class="sd">    for pp in lAttr:</span>
<span class="sd">        #print( inspect.ismethod(getattr(obj,pp)), type(getattr(obj,pp)), pp</span>
<span class="sd">        if not inspect.ismethod(getattr(obj,pp)):</span>
<span class="sd">            if &#39;_Sino&#39; in pp:</span>
<span class="sd">                Sino[pp] = getattr(obj,pp)</span>
<span class="sd">            elif &#39;_Span&#39; in pp:</span>
<span class="sd">                Span[pp] = getattr(obj,pp)</span>
<span class="sd">            elif &#39;_Cone&#39; in pp:</span>
<span class="sd">                Cone[pp] = getattr(obj,pp)</span>
<span class="sd">            elif &#39;_SAng&#39; in pp:</span>
<span class="sd">                SAng[pp] = getattr(obj,pp)</span>
<span class="sd">            elif &#39;_SynthDiag&#39; in pp:</span>
<span class="sd">                SynthDiag[pp] = getattr(obj,pp)</span>
<span class="sd">            elif &#39;_Res&#39; in pp:</span>
<span class="sd">                Res[pp] = getattr(obj,pp)</span>


<span class="sd">    # Store Optics key parameters (for re-creating if not saved independantly)</span>
<span class="sd">    Optics = []</span>
<span class="sd">    if len(obj.Optics)&gt;0:</span>
<span class="sd">        if obj.OpticsType==&#39;Apert&#39;:</span>
<span class="sd">            for aa in obj.Optics:</span>
<span class="sd">                Optics.append({&#39;Id&#39;:aa.Id.todict(), &#39;Poly&#39;:aa.Poly, &#39;arrayorder&#39;:aa._arrayorder, &#39;Clock&#39;:aa._Clock})</span>
<span class="sd">        elif obj.OpticsType==&#39;Lens&#39;:</span>
<span class="sd">            ln = obj.Optics[0]</span>
<span class="sd">            Optics.append({&#39;Id&#39;:ln.Id.todict(), &#39;O&#39;:ln.O, &#39;nIn&#39;:ln.nIn, &#39;Rad&#39;:ln.Rad, &#39;F1&#39;:ln.F1, &#39;F2&#39;:ln.F2, &#39;R1&#39;:ln.R1, &#39;R2&#39;:ln.R2, &#39;dd&#39;:ln.dd, &#39;Type&#39;:ln.Type, &#39;arrayorder&#39;:ln._arrayorder, &#39;Clock&#39;:ln._Clock})</span>

<span class="sd">    return LOSprops, Sino, Span, Cone, SAng, SynthDiag, Res, Optics</span>



<span class="sd">def _convert_PreData2Ldict(obj):</span>
<span class="sd">    Init = {&#39;data&#39;:obj._dataRef, &#39;t&#39;:obj._tRef, &#39;Chans&#39;:obj._ChansRef, &#39;DtRef&#39;:obj._DtRef}</span>
<span class="sd">    PhysNoiseParam = None if obj._PhysNoise is None else obj._PhysNoise[&#39;Param&#39;].update(obj._NoiseModel[&#39;Par&#39;])</span>
<span class="sd">    Update = {&#39;Dt&#39;:obj.Dt, &#39;Resamp_t&#39;:obj._Resamp_t, &#39;Resamp_f&#39;:obj._Resamp_f, &#39;Resamp_Method&#39;:obj._Resamp_Method, &#39;Resamp_interpkind&#39;:obj._Resamp_interpkind,</span>
<span class="sd">            &#39;indOut&#39;:obj._indOut, &#39;indCorr&#39;:obj._indCorr, &#39;interp_lt&#39;:obj._interp_lt, &#39;interp_lNames&#39;:obj._interp_lNames, &#39;Subtract_tsub&#39;:obj._Subtract_tsub,</span>
<span class="sd">            &#39;FFTPar&#39;:obj._FFTPar, &#39;PhysNoiseParam&#39;:PhysNoiseParam}</span>
<span class="sd">    return Init, Update</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_save_np</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathfileext</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span> <span class="k">if</span> <span class="n">compressed</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">savez</span>
    <span class="n">dId</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span>

    <span class="c1"># tofu.geom</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Ves&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Id</span><span class="o">=</span><span class="n">dId</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span>
             <span class="n">Poly</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Poly</span><span class="p">,</span> <span class="n">Lim</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Lim</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">sino</span><span class="p">[</span><span class="s1">&#39;RefPt&#39;</span><span class="p">],</span>
             <span class="n">Sino_NP</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">sino</span><span class="p">[</span><span class="s1">&#39;NP&#39;</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Struct&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Id</span><span class="o">=</span><span class="n">dId</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span>
             <span class="n">Poly</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Poly</span><span class="p">,</span> <span class="n">Lim</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Lim</span><span class="p">,</span> <span class="n">mobile</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_mobile</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rays&#39;</span><span class="p">,</span><span class="s1">&#39;LOS&#39;</span><span class="p">,</span><span class="s1">&#39;LOSCam1D&#39;</span><span class="p">,</span><span class="s1">&#39;LOSCam2D&#39;</span><span class="p">]:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Id</span><span class="o">=</span><span class="n">dId</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_extra</span><span class="p">,</span>
             <span class="n">geom</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">sino</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">sino</span><span class="p">,</span> <span class="n">dchans</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">dchans</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="s1">&#39;Data1D&#39;</span><span class="p">,</span><span class="s1">&#39;Data2D&#39;</span><span class="p">]:</span>
        <span class="n">dsave</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;LCam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LCam</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;LCam&#39;</span><span class="p">]:</span>
                <span class="n">pathS</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">]</span>
                <span class="n">pathN</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">]</span>
                <span class="n">LCam</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathS</span><span class="p">,</span><span class="n">pathN</span><span class="o">+</span><span class="s1">&#39;.npz&#39;</span><span class="p">))</span>
            <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LCam</span>
        <span class="k">elif</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;Ves&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pathS</span> <span class="o">=</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;Ves&#39;</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">]</span>
                <span class="n">pathN</span> <span class="o">=</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;Ves&#39;</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">]</span>
                <span class="n">Ves</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathS</span><span class="p">,</span><span class="n">pathN</span><span class="o">+</span><span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
                <span class="n">geom</span> <span class="o">+=</span> <span class="p">[</span><span class="n">Ves</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;LStruct&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;LStruct&#39;</span><span class="p">]:</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">],</span>
                                      <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
                    <span class="n">geom</span> <span class="o">+=</span> <span class="p">[</span><span class="n">sf</span><span class="p">]</span>
            <span class="n">dsave</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geom</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="o">**</span><span class="n">dsave</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    elif obj.Id.Cls==&#39;GLOS&#39;:</span>
<span class="sd">        LIdLOS = [ll.Id.todict() for ll in obj.LLOS]</span>
<span class="sd">        LDs, Lus = np.array([ll.D for ll in obj.LLOS]).T, np.array([ll.u for ll in obj.LLOS]).T</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, LIdLOS=LIdLOS, LDs=LDs, Lus=Lus, Sino_RefPt=obj.Sino_RefPt, arrayorder=obj._arrayorder, Clock=obj._Clock)</span>

<span class="sd">    elif obj.Id.Cls==&#39;Lens&#39;:</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, arrayorder=obj._arrayorder, Clock=obj._Clock, O=obj.O, nIn=obj.nIn, Rad=[obj.Rad], F1=[obj.F1], F2=[obj.F2], R1=[obj.R1], R2=[obj.R2], dd=[obj.dd])</span>

<span class="sd">    elif obj.Id.Cls==&#39;Apert&#39;:</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, arrayorder=obj._arrayorder, Clock=obj._Clock, Poly=obj.Poly)</span>

<span class="sd">    elif obj.Id.Cls==&#39;Detect&#39;:</span>
<span class="sd">        LOSprops, Sino, Span, Cone, SAng, SynthDiag, Res, Optics = _convert_Detect2Ldict(obj)</span>
<span class="sd">        VesCalc = {&#39;SavePath&#39;:None} if (not hasattr(obj,&#39;_VesCalc&#39;) or obj._VesCalc is None) else {&#39;SavePath&#39;:obj._VesCalc.Id.SavePath, &#39;SaveName&#39;:obj._VesCalc.Id.SaveName}</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, Poly=obj.Poly, Rad=obj.Rad, BaryS=obj.BaryS, nIn=obj.nIn, arrayorder=obj._arrayorder, Clock=obj._Clock, Sino_RefPt=obj.Sino_RefPt, LOSNP=[obj._LOS_NP],</span>
<span class="sd">                LOSprops=[LOSprops], Sino=[Sino], Span=[Span], Cone=[Cone], SAng=[SAng], SynthDiag=[SynthDiag], Res=[Res], Optics=[Optics], VesCalc=[VesCalc])</span>

<span class="sd">    elif obj.Id.Cls==&#39;GDetect&#39;:</span>
<span class="sd">        LDetsave, LDetSynthRes = [], []</span>
<span class="sd">        for ii in range(0,obj.nDetect):</span>
<span class="sd">            ddIdsave = obj.LDetect[ii].Id.todict()</span>
<span class="sd">            LOSprops, Sino, Span, Cone, SAng, SynthDiag, Res, Optics = _convert_Detect2Ldict(obj.LDetect[ii])</span>
<span class="sd">            VesCalc = {&#39;SavePath&#39;:None} if (not hasattr(obj.LDetect[ii],&#39;_VesCalc&#39;) or obj.LDetect[ii]._VesCalc is None) else {&#39;SavePath&#39;:obj.LDetect[ii]._VesCalc.Id.SavePath, &#39;SaveName&#39;:obj.LDetect[ii]._VesCalc.Id.SaveName}</span>
<span class="sd">            dd = dict(Idsave=ddIdsave, Poly=obj.LDetect[ii].Poly, Rad=obj.LDetect[ii].Rad, BaryS=obj.LDetect[ii].BaryS, nIn=obj.LDetect[ii].nIn, arrayorder=obj._arrayorder, Clock=obj._Clock, Sino_RefPt=obj.Sino_RefPt,</span>
<span class="sd">                      LOSNP=[obj.LDetect[ii]._LOS_NP], LOSprops=[LOSprops], Sino=[Sino], Span=[Span], Cone=[Cone], SAng=[SAng], Optics=[Optics], VesCalc=[VesCalc])</span>
<span class="sd">            LDetsave.append(dd)</span>
<span class="sd">            LDetSynthRes.append({&#39;SynthDiag&#39;:[SynthDiag],&#39;Res&#39;:[Res]})</span>
<span class="sd">        Res, lAttr = {}, dir(obj)</span>
<span class="sd">        for pp in lAttr:</span>
<span class="sd">            if not inspect.ismethod(getattr(obj,pp)) and &#39;_Res&#39; in pp:</span>
<span class="sd">                Res[pp] = getattr(obj,pp)</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, arrayorder=obj._arrayorder, Clock=obj._Clock, Sino_RefPt=obj.Sino_RefPt, LOSRef=obj._LOSRef, Res=[Res], LDetsave=LDetsave, LDetSynthRes=LDetSynthRes)</span>

<span class="sd">    # tofu.Eq</span>
<span class="sd">    elif obj.Id.Cls==&#39;Eq2D&#39;:</span>
<span class="sd">        np.savez(pathfileext, Idsave=Idsave, **obj._Tab)</span>

<span class="sd">    # tofu.mesh</span>
<span class="sd">    elif obj.Id.Cls==&#39;Mesh1D&#39;:</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, Knots=obj.Knots)</span>

<span class="sd">    elif obj.Id.Cls==&#39;Mesh2D&#39;:</span>
<span class="sd">        SubMinds = [{&#39;Name&#39;:kk, &#39;ind&#39;:obj._SubMesh[kk][&#39;ind&#39;]} for kk in obj._SubMesh.keys()]</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, Knots=[obj.MeshX1.Knots,obj.MeshX2.Knots], SubMinds=SubMinds, IndBg=obj._get_CentBckg()[1])</span>

<span class="sd">    elif obj.Id.Cls==&#39;BF2D&#39;:</span>
<span class="sd">        Id = np.array([&#39;BF2D&#39;,obj.Id.Name,obj.Id.SaveName,obj.Id.SavePath,obj.Id._dtFormat,obj.Id._Diag,str(obj.Id._shot), [obj.Id.Type], obj.Id.Exp],dtype=str)</span>
<span class="sd">        IdMesh = np.array([&#39;Mesh2D&#39;,obj.Mesh.Id.Name,obj.Mesh.Id.SaveName,obj.Mesh.Id.SavePath,obj.Mesh.Id._dtFormat],dtype=str)</span>
<span class="sd">        dtime, dtimeMesh = np.array([obj.Id._dtime],dtype=object), np.array([obj.Mesh.Id._dtime],dtype=object)</span>
<span class="sd">        USR = np.asarray(obj.Id.USRdict)</span>
<span class="sd">        func(pathfileext, Id=Id, IdMesh=IdMesh, dtime=dtime, IdUSR=USR, dtimeMesh=dtimeMesh, KnotsR=obj.Mesh.MeshR.Knots, KnotsZ=obj.Mesh.MeshZ.Knots, Deg=np.array([obj.Deg],dtype=int), Ind=obj.Mesh._get_CentBckg()[1])</span>

<span class="sd">    # tofu.matcomp</span>
<span class="sd">    elif obj.Id.Cls==&#39;GMat2D&#39;:</span>
<span class="sd">        Id = np.array([&#39;GMat2D&#39;,obj.Id.Name,obj.Id.SaveName,obj.Id.SavePath,obj.Id._dtFormat,obj.Id._Diag,str(obj.Id._shot), [obj.Id.Type], obj.Id.Exp],dtype=str)</span>
<span class="sd">        dtime = np.array([obj.Id._dtime],dtype=object)</span>
<span class="sd">        USR = np.asarray(obj.Id.USRdict)</span>
<span class="sd">        IdObj, IdObjUSR = save_np_IdObj(obj.Id)</span>
<span class="sd">        CompParamVal = np.array([obj._Mat_epsrel, obj._Mat_SubP, obj._Mat_SubTheta, obj._indMat_SubP, obj._MatLOS_epsrel, obj._MatLOS_SubP, int(obj._Mat_Fast)])</span>
<span class="sd">        CompParamStr = np.array([obj._Mat_Mode, obj._Mat_SubMode, obj._Mat_SubThetaMode, obj._MatLOS_Mode, obj._MatLOS_SubMode])</span>
<span class="sd">        func(pathfileext, Id=Id, dtime=dtime, IdUSR=USR, Ves=IdObj[2], VesUSR=IdObjUSR[2], LDetect=IdObj[1], BF2=IdObj[0], BF2USR=IdObjUSR[0], LDetectUSR=IdObjUSR[1], CompParamVal=CompParamVal,</span>
<span class="sd">                CompParamStr=CompParamStr, indMat=obj._indMat, Matdata=obj._Mat_csr.data, Matind=obj._Mat_csr.indices, Matindpr=obj._Mat_csr.indptr, Matshape=obj._Mat_csr.shape,</span>
<span class="sd">                MatLOSdata=obj._MatLOS_csr.data, MatLOSind=obj._MatLOS_csr.indices, MatLOSindpr=obj._MatLOS_csr.indptr, MatLOSshape=obj._MatLOS_csr.shape,</span>
<span class="sd">                BF2Par=np.array([obj._BF2_Deg,obj._BF2_NFunc,obj._BF2_NCents]), LD_nD=obj._LD_nDetect)</span>

<span class="sd">    # tofu.treat</span>
<span class="sd">    elif obj.Id.Cls==&#39;PreData&#39;:</span>
<span class="sd">        Init, Update = _convert_PreData2Ldict(obj)</span>
<span class="sd">        func(pathfileext, Idsave=Idsave, Init=[Init], Update=[Update])</span>

<span class="sd">        #Id = np.array([&#39;PreData&#39;,obj.Id.Name,obj.Id.SaveName,obj.Id.SavePath,obj.Id._dtFormat,obj.Id._Diag,str(obj.Id._shot), [obj.Id.Type], obj.Id.Exp],dtype=str)</span>
<span class="sd">        #dtime = np.array([obj.Id._dtime],dtype=object)</span>
<span class="sd">        #USR = np.asarray(obj.Id.USRdict)</span>
<span class="sd">        #IdObj, IdObjUSR = save_np_IdObj(obj.Id)</span>
<span class="sd">        #StrPar = np.asarray([obj._Exp, obj._interpkind])</span>
<span class="sd">        #func(pathfileext, Id=Id, dtime=dtime, IdUSR=USR, LDetect=IdObj[0], LDetectUSR=IdObjUSR[0],</span>
<span class="sd">        #        DLPar=obj._DLPar, shot=obj._shot, StrPar=StrPar, Dt=obj._Dt, DtMarg=obj._DtMargin, MovMeanfreq=obj._MovMeanfreq, Resamp=obj._Resamp,</span>
<span class="sd">        #        indOut=obj._indOut, indCorr=obj._indCorr, PhysNoise=obj._PhysNoise, NoiseMod=obj._NoiseModel, interp_lt=obj._interp_lt, interp_lN=obj._interp_lNames)</span>

<span class="sd">    # tofu.inv</span>
<span class="sd">    elif obj.Id.Cls==&#39;Sol2D&#39;:</span>
<span class="sd">        Id = np.array([&#39;Sol2D&#39;,obj.Id.Name,obj.Id.SaveName,obj.Id.SavePath,obj.Id._dtFormat,obj.Id._Diag,str(obj.Id._shot), [obj.Id.Type], obj.Id.Exp],dtype=str)</span>
<span class="sd">        dtime = np.array([obj.Id._dtime],dtype=object)</span>
<span class="sd">        USR = np.asarray(obj.Id.USRdict)</span>
<span class="sd">        IdObj, IdObjUSR = save_np_IdObj(obj.Id)</span>
<span class="sd">        try:</span>
<span class="sd">            timing = obj._timing</span>
<span class="sd">        except Exception:</span>
<span class="sd">            timing = obj._t2</span>
<span class="sd">        func(pathfileext, Id=Id, dtime=dtime, IdUSR=USR, PreData=IdObj[2], PreDataUSR=IdObjUSR[2], GMat2D=IdObj[1], GMatUSR=IdObjUSR[1], BF2D=IdObj[0], BF2DUSR=IdObjUSR[0],</span>
<span class="sd">                InvParam=obj.InvParam, shot=obj.shot, LNames=obj._LNames, Run=obj._run,</span>
<span class="sd">                LOS=obj._LOS, data=obj._data, t=obj._t, Coefs=obj._Coefs, sigma=obj._sigma, Mu=obj._Mu, Chi2N=obj._Chi2N, R = obj._R, Nit=obj._Nit, Spec=obj._Spec, t2=timing, PostTreat=obj._PostTreat)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">save_np_IdObj</span><span class="p">(</span><span class="n">Id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; (to do) &quot;&quot;&quot;</span>
    <span class="n">LObj</span><span class="p">,</span> <span class="n">LObjUSR</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Keys</span><span class="p">)):</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="n">Keys</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">Larr</span><span class="p">,</span> <span class="n">LarrUSR</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">kk</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">kk</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;USRdict&#39;</span><span class="p">:</span>
                <span class="n">LarrUSR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="n">Keys</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="n">kk</span><span class="p">[</span><span class="n">jj</span><span class="p">]]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Larr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="n">Keys</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="n">kk</span><span class="p">[</span><span class="n">jj</span><span class="p">]]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
        <span class="n">LObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">Larr</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">LObjUSR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">LarrUSR</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">LObj</span><span class="p">,</span> <span class="n">LObjUSR</span>




<span class="c1">###########################</span>
<span class="c1">#   Opening</span>
<span class="c1">###########################</span>


<div class="viewcode-block" id="Open"><a class="viewcode-back" href="../../tofu.html#tofu.pathfile.Open">[docs]</a><span class="k">def</span> <span class="nf">Open</span><span class="p">(</span><span class="n">pathfileext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">shot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Deriv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">Sep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">OutPath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ReplacePath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">out</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Open a ToFu object saved file</span>

<span class="sd">    This generic open function identifies the required loading routine by detecting how the object was saved from the file name extension.</span>
<span class="sd">    Also, it uses :meth:`~tofu.pathfile.FindSolFile()` to identify the relevant file in case key criteria such as shot, Deg... are provided instead of the file name itself.</span>
<span class="sd">    Finally, once all the relevant data is loaded from the file, a ToFu object is re-created, if necessary by implicitly loading all other objects it may depend on (i.e.: vessel, apertures...)</span>

<span class="sd">    If pathfileext is not provided (None), then the following keyword arguments are fed to :meth:`~tofu.pathfile.FindSolFile()`: shot, t, Dt, Mesh, Deg, Deriv, Sep, Pos</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pathfileext :   None / str</span>
<span class="sd">        If provided, the name of the file to load</span>
<span class="sd">    OutPath :       None / str</span>
<span class="sd">        If provided, the absolute path where the file is to be found</span>
<span class="sd">    ReplacePath :   str</span>
<span class="sd">        If provided, ? (to finish)</span>
<span class="sd">    Ves :           None /</span>
<span class="sd">        If provided, the :class:`tofu.geom.Ves` object that shall be used to reconstruct the object (if not provided, the appropriate vessel will be loaded).</span>
<span class="sd">    out :           str</span>
<span class="sd">        Flag indicating whether the object should be loaded completely (&#39;full&#39;), in a light dismissing the heaviest attributes (&#39;light&#39;) or whether only the Id or a list of Id should be returned (&#39;Id&#39;), valid only for &#39;.npz&#39;</span>
<span class="sd">    Verb :          bool</span>
<span class="sd">        Flag indicating whether to pring intermediate comments on the loading procedure</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    obj             ToFu object</span>
<span class="sd">        The loaded and re-created ToFu object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pathfileext</span><span class="p">,</span><span class="n">shot</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathfileext</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Arg pathfileext or shot must be None, but not both !&quot;</span>
    <span class="k">if</span> <span class="n">pathfileext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">File</span> <span class="o">=</span> <span class="n">FindSolFile</span><span class="p">(</span><span class="n">shot</span><span class="o">=</span><span class="n">shot</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">Dt</span><span class="o">=</span><span class="n">Dt</span><span class="p">,</span> <span class="n">Mesh</span><span class="o">=</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="n">Deg</span><span class="p">,</span>
                           <span class="n">Deriv</span><span class="o">=</span><span class="n">Deriv</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="n">Sep</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="n">Pos</span><span class="p">,</span> <span class="n">OutPath</span><span class="o">=</span><span class="n">OutPath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">File</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">File</span>
        <span class="n">pathfileext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OutPath</span><span class="p">,</span><span class="n">File</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">ss</span> <span class="ow">in</span> <span class="n">pathfileext</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.npz&#39;</span><span class="p">]])</span>
    <span class="k">assert</span> <span class="n">C</span><span class="p">,</span> <span class="s2">&quot;Arg pathfileext must contain &#39;.npz&#39; !&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;.npz&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_open_np</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">ReplacePath</span><span class="o">=</span><span class="n">ReplacePath</span><span class="p">,</span>
                       <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="n">Verb</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="n">Print</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded :  &quot;</span><span class="o">+</span><span class="n">pathfileext</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>


<span class="k">def</span> <span class="nf">open_np_IdObj</span><span class="p">(</span><span class="n">LCls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">LIdArr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">LIdUSR</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">LIdObj</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">LIdArr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">LCls</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;Args LCls and LIdArr must be lists !&quot;</span>
        <span class="n">NObj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NObj</span><span class="p">):</span>
            <span class="n">no</span> <span class="o">=</span> <span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">no</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">LIdUSR</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">LIdUSR</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">LIdObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">LCls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="n">SaveName</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">SavePath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">Exp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">dtime</span><span class="o">=</span><span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">5</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">])),</span> <span class="n">dtFormat</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">USRdict</span><span class="o">=</span><span class="n">LIdUSR</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">LIdObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">LCls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="n">SaveName</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">SavePath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">Exp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">dtime</span><span class="o">=</span><span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">5</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">])),</span> <span class="n">dtFormat</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">LIdObj</span>


<span class="k">def</span> <span class="nf">_tryloadVesStruct</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">VesStruct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">VesStruct</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">VesStruct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Ves&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">VesStruct</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">VesStruct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Ves</span><span class="p">,</span> <span class="n">LStruct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;Ves&#39;</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Ves&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">],</span>
                                       <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Ves&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Ves</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="n">Print</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">Str</span> <span class="o">=</span> <span class="s2">&quot; : associated Ves/Struct could not be loaded from &quot;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span> <span class="n">Str</span> <span class="o">+</span> <span class="n">PathFileExt</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Struct&#39;</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">LStruct</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Struct&#39;</span><span class="p">]:</span>
                <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;SavePath&#39;</span><span class="p">],</span>
                                           <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;SaveName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">LStruct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Open</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="n">Print</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">Str</span> <span class="o">=</span> <span class="s2">&quot; : associated Ves/Struct could not be loaded from &quot;</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span> <span class="n">Str</span> <span class="o">+</span><span class="n">PathFileExt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Ves</span><span class="p">,</span> <span class="n">LStruct</span>

<span class="k">def</span> <span class="nf">_tryLoadOpticsElseCreate</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Opt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">tofu.geom</span> <span class="k">as</span> <span class="nn">TFG</span>
    <span class="k">if</span> <span class="s1">&#39;Apert&#39;</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">Optics</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Apert&#39;</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">])):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Apert&#39;</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Apert&#39;</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.npz&#39;</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
                <span class="n">Optics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Opt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ves</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Ves</span><span class="p">,</span> <span class="s2">&quot;Arg Ves must be a TFG.Ves instance !&quot;</span>
                    <span class="k">if</span> <span class="n">Verb</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s2">&quot; : no saved Apert =&gt; creating the associated Apert object !&quot;</span><span class="p">)</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">jj</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Opt</span><span class="p">))</span> <span class="k">if</span> <span class="n">Opt</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Apert&#39;</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Opt</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Apert&#39;</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]]</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Several possible solutions !&quot;</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">iid</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
                    <span class="n">aa</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Apert</span><span class="p">(</span><span class="n">iid</span><span class="p">,</span> <span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;Poly&#39;</span><span class="p">],</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;arrayorder&#39;</span><span class="p">],</span> <span class="n">Clock</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;Clock&#39;</span><span class="p">])</span>
                    <span class="n">Optics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s2">&quot; : associated Apert object could not be loaded from &quot;</span><span class="o">+</span><span class="n">PathFileExt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;Lens&#39;</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Lens&#39;</span><span class="p">][</span><span class="s1">&#39;SavePath&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s1">&#39;Lens&#39;</span><span class="p">][</span><span class="s1">&#39;SaveName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.npz&#39;</span>
            <span class="n">Optics</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Opt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ves</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Ves</span><span class="p">,</span> <span class="s2">&quot;Arg Ves must be a TFG.Ves instance !&quot;</span>
                <span class="k">if</span> <span class="n">Verb</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s2">&quot; : no saved Lens =&gt; creating the associated Lens object !&quot;</span><span class="p">)</span>
                <span class="n">iid</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Lens</span><span class="p">(</span><span class="n">iid</span><span class="p">,</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;nIn&#39;</span><span class="p">],</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Rad&#39;</span><span class="p">],</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;F1&#39;</span><span class="p">],</span> <span class="n">F2</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;F2&#39;</span><span class="p">],</span> <span class="n">R1</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;R1&#39;</span><span class="p">],</span> <span class="n">R2</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;R2&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dd&#39;</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Type&#39;</span><span class="p">],</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span>
                              <span class="n">arrayorder</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;arrayorder&#39;</span><span class="p">],</span> <span class="n">Clock</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Clock&#39;</span><span class="p">])</span>
                <span class="n">Optics</span> <span class="o">=</span> <span class="n">aa</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s2">&quot; : associated Lens object could not be loaded from &quot;</span><span class="o">+</span><span class="n">PathFileExt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Optics</span>



<span class="k">def</span> <span class="nf">_resetDetectAttr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Out</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">tofu.geom</span> <span class="k">as</span> <span class="nn">TFG</span>
    <span class="c1"># Re-creating LOS</span>
    <span class="n">LOS</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">kkeys</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;LOSprops&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s1">&#39;Keys&#39;</span><span class="p">])):</span>
        <span class="n">idlos</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">los</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">LOS</span><span class="p">(</span><span class="n">idlos</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s1">&#39;Du&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="n">Ves</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">)</span>
        <span class="n">LOS</span><span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s1">&#39;Keys&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LOS&#39;</span><span class="p">:</span><span class="n">los</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">kkeys</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kkeys</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Keys&#39;</span><span class="p">,</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span><span class="s1">&#39;Du&#39;</span><span class="p">]:</span>
                <span class="n">LOS</span><span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s1">&#39;Keys&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]][</span><span class="n">kkeys</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;LOSprops&#39;</span><span class="p">][</span><span class="n">kkeys</span><span class="p">[</span><span class="n">jj</span><span class="p">]][</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">_LOS</span> <span class="o">=</span> <span class="n">LOS</span>

    <span class="c1"># Re-assigning tabulated data</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sino&#39;</span><span class="p">,</span> <span class="s1">&#39;Span&#39;</span><span class="p">,</span> <span class="s1">&#39;Cone&#39;</span><span class="p">,</span> <span class="s1">&#39;SAng&#39;</span><span class="p">,</span> <span class="s1">&#39;SynthDiag&#39;</span><span class="p">,</span> <span class="s1">&#39;Res&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">Out</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">Out</span><span class="p">[</span><span class="n">ff</span><span class="p">][</span><span class="n">kk</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>




<span class="k">def</span> <span class="nf">_get_light_SynthDiag_Res</span><span class="p">():</span>
    <span class="n">SynthDiag</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_SynthDiag_Done&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_ds&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_dsMode&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_MarginS&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_dX12&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_dX12Mode&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_Colis&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                 <span class="s1">&#39;_SynthDiag_Points&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_SAng&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_Vect&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_SynthDiag_dV&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
    <span class="n">Res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_Res_Mode&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_Amp&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_Deg&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
           <span class="s1">&#39;_Res_Pts&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_Res&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_CrossMesh&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_CrossMeshMode&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
           <span class="s1">&#39;_Res_steps&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_Thres&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_ThresMode&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_ThresMin&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
           <span class="s1">&#39;_Res_IntResCross&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_IntResCrossMode&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_IntResLong&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_IntResLongMode&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_Res_IntNtt&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
           <span class="s1">&#39;_Res_EqName&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
           <span class="s1">&#39;_Res_Done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span>




<span class="k">def</span> <span class="nf">_open_np</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">ReplacePath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="k">if</span> <span class="s1">&#39;TFG&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.geom</span> <span class="k">as</span> <span class="nn">tfg</span>
    <span class="k">elif</span> <span class="s1">&#39;TFD&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.data</span> <span class="k">as</span> <span class="nn">tfd</span>
    <span class="c1">#elif &#39;TFEq&#39; in pathfileext:</span>
    <span class="c1">#    import tofu.Eq as tfEq</span>
    <span class="c1">#elif &#39;TFM&#39; in pathfileext:</span>
    <span class="c1">#    import tofu.mesh as TFM</span>
    <span class="c1">#elif &#39;TFMC&#39; in pathfileext:</span>
    <span class="c1">#    import tofu.matcomp as TFMC</span>
    <span class="c1">#elif &#39;TFT&#39; in pathfileext:</span>
    <span class="c1">#    import tofu.treat as tft</span>
    <span class="c1">#elif &#39;TFI&#39; in pathfileext:</span>
    <span class="c1">#    import tofu.inv as TFI</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">Out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span><span class="n">mmap_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
        <span class="n">Out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span><span class="n">mmap_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
    <span class="n">Id</span> <span class="o">=</span> <span class="n">ID</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;Id&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Id</span>

    <span class="k">if</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s1">&#39;Ves&#39;</span><span class="p">:</span>
        <span class="n">Lim</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Lim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Lim&#39;</span><span class="p">]</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">tfg</span><span class="o">.</span><span class="n">Ves</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Poly&#39;</span><span class="p">],</span> <span class="n">Lim</span><span class="o">=</span><span class="n">Lim</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span>
                      <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Clock&#39;</span><span class="p">]),</span>
                      <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;arrayorder&#39;</span><span class="p">]),</span>
                      <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">Sino_NP</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Sino_NP&#39;</span><span class="p">]))</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s1">&#39;Struct&#39;</span><span class="p">:</span>
        <span class="n">Lim</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Lim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Lim&#39;</span><span class="p">]</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">tfg</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Poly&#39;</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">Lim</span><span class="o">=</span><span class="n">Lim</span><span class="p">,</span>
                         <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Clock&#39;</span><span class="p">]),</span>
                         <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;arrayorder&#39;</span><span class="p">]),</span>
                         <span class="n">mobile</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;mobile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Rays&#39;</span><span class="p">,</span><span class="s1">&#39;LOS&#39;</span><span class="p">,</span><span class="s1">&#39;LOSCam1D&#39;</span><span class="p">,</span><span class="s1">&#39;LOSCam2D&#39;</span><span class="p">]:</span>
        <span class="n">Ves</span><span class="p">,</span> <span class="n">LStruct</span> <span class="o">=</span> <span class="n">_tryloadVesStruct</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Print</span><span class="o">=</span><span class="n">Print</span><span class="p">)</span>
        <span class="n">dobj</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Id&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">_todict</span><span class="p">(),</span> <span class="s1">&#39;dchans&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;dchans&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s1">&#39;geom&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s1">&#39;sino&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;sino&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
        <span class="k">if</span> <span class="s1">&#39;extra&#39;</span> <span class="ow">in</span> <span class="n">Out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;extra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;extra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Ves</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;Ves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;Ves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ves</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">LStruct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;LStruct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;LStruct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">LStruct</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Rays&#39;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">tfg</span><span class="o">.</span><span class="n">Rays</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">dobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;LOSCam1D&#39;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">tfg</span><span class="o">.</span><span class="n">LOSCam1D</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">dobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;LOSCam2D&#39;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">tfg</span><span class="o">.</span><span class="n">LOSCam2D</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">dobj</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Data1D&#39;</span><span class="p">,</span><span class="s1">&#39;Data2D&#39;</span><span class="p">]:</span>
        <span class="n">dobj</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Id&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">_todict</span><span class="p">(),</span> <span class="s1">&#39;Ref&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;Ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s1">&#39;dunits&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;dunits&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;fft&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;fft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s1">&#39;data0&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;data0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;CamCls&#39;</span><span class="p">:</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;CamCls&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
        <span class="n">indt</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span>
        <span class="n">indch</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;indch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;indch&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Cam&#39;</span> <span class="ow">in</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">LCam</span> <span class="o">=</span> <span class="p">[</span><span class="n">Open</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]]</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LCam&#39;</span><span class="p">:</span><span class="n">LCam</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Ves</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">LStruct</span> <span class="o">=</span> <span class="p">[</span><span class="n">Open</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">LStruct</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">geom</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LCam&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Ves&#39;</span><span class="p">:</span><span class="n">Ves</span><span class="p">,</span> <span class="s1">&#39;LStruct&#39;</span><span class="p">:</span><span class="n">LStruct</span><span class="p">}</span>
        <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indt</span>
        <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;indch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indch</span>
        <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geom</span>
        <span class="k">if</span> <span class="s1">&#39;dMag&#39;</span> <span class="ow">in</span> <span class="n">Out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dMag</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s1">&#39;dMag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dMag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dobj</span><span class="p">[</span><span class="s1">&#39;dMag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMag</span>
        <span class="k">if</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Data1D&#39;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Data1D</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">dobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s1">&#39;Data2D&#39;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Data2D</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">dobj</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    elif Id.Cls == &#39;GLOS&#39;:</span>
<span class="sd">        Ves = _tryloadVes(Id)</span>
<span class="sd">        LLOS, IdLOS = [], Id.LObj[&#39;LOS&#39;]</span>
<span class="sd">        for ii in range(0,len(IdLOS[&#39;Name&#39;])):</span>
<span class="sd">            Idl = _Id_recreateFromdict(Out[&#39;LIdLOS&#39;][ii])</span>
<span class="sd">            ll = TFG.LOS(Idl, Du=(Out[&#39;LDs&#39;][:,ii],Out[&#39;Lus&#39;][:,ii]), Ves=Ves, Sino_RefPt=Out[&#39;Sino_RefPt&#39;], arrayorder=str(Out[&#39;arrayorder&#39;]))</span>
<span class="sd">            LLOS.append(ll)</span>
<span class="sd">        obj = TFG.GLOS(Id, LLOS, Ves=Ves, Type=Id.Type, Exp=Id.Exp, Diag=Id.Diag, shot=Id.shot, Sino_RefPt=Out[&#39;Sino_RefPt&#39;], SavePath=Id.SavePath, arrayorder=str(Out[&#39;arrayorder&#39;]), Clock=bool(Out[&#39;Clock&#39;]),</span>
<span class="sd">                       dtime=Id.dtime)</span>

<span class="sd">    elif Id.Cls == &#39;Lens&#39;:</span>
<span class="sd">        Ves = _tryloadVes(Id, Ves=Ves)</span>
<span class="sd">        obj = TFG.Lens(Id, Out[&#39;O&#39;], Out[&#39;nIn&#39;], Out[&#39;Rad&#39;][0], Out[&#39;F1&#39;][0], F2=Out[&#39;F2&#39;][0], Type=Id.Type, R1=Out[&#39;R1&#39;][0], R2=Out[&#39;R2&#39;][0], dd=Out[&#39;dd&#39;][0], Ves=Ves,</span>
<span class="sd">                Exp=Id.Exp, Clock=bool(Out[&#39;Clock&#39;]), Diag=Id.Diag, shot=Id.shot, arrayorder=str(Out[&#39;arrayorder&#39;]), SavePath=Id.SavePath, dtime=Id.dtime)</span>

<span class="sd">    elif Id.Cls == &#39;Apert&#39;:</span>
<span class="sd">        Ves = _tryloadVes(Id, Ves=Ves)</span>
<span class="sd">        obj = TFG.Apert(Id, Out[&#39;Poly&#39;], Clock=bool(Out[&#39;Clock&#39;]), arrayorder=str(Out[&#39;arrayorder&#39;]), Ves=Ves, Exp=Id.Exp, Diag=Id.Diag, shot=Id.shot, dtime=Id.dtime)</span>

<span class="sd">    elif Id.Cls == &#39;Detect&#39;:</span>
<span class="sd">        Ves = _tryloadVes(Id, Ves=Ves)</span>
<span class="sd">        if &#39;VesCalc&#39;in Out.keys() and Out[&#39;VesCalc&#39;][0][&#39;SavePath&#39;] is not None:</span>
<span class="sd">            VesCalc = Open(Out[&#39;VesCalc&#39;][0][&#39;SavePath&#39;]+Out[&#39;VesCalc&#39;][0][&#39;SaveName&#39;]+&#39;.npz&#39;)</span>
<span class="sd">        else:</span>
<span class="sd">            VesCalc = None</span>
<span class="sd">        LOSprops, Sino, Span, Cone, SAng, Opt = Out[&#39;LOSprops&#39;][0], Out[&#39;Sino&#39;][0], Out[&#39;Span&#39;][0], Out[&#39;Cone&#39;][0], Out[&#39;SAng&#39;][0], Out[&#39;Optics&#39;][0]</span>
<span class="sd">        (SynthDiag,Res) = (Out[&#39;SynthDiag&#39;][0],Out[&#39;Res&#39;][0]) if out==&#39;full&#39; else _get_light_SynthDiag_Res()</span>
<span class="sd">        Optics = _tryLoadOpticsElseCreate(Id, Opt=Opt, Ves=Ves, Verb=Verb)</span>

<span class="sd">        Poly = Out[&#39;Poly&#39;] if type(Optics) is list else dict(Rad=float(Out[&#39;Rad&#39;]),O=Out[&#39;BaryS&#39;],nIn=Out[&#39;nIn&#39;])</span>
<span class="sd">        obj = TFG.Detect(Id, Poly, Optics=Optics, Ves=Ves, VesCalc=VesCalc, Sino_RefPt=Sino[&#39;_Sino_RefPt&#39;], CalcEtend=False, CalcSpanImp=False, CalcCone=False, CalcPreComp=False, Calc=True, Verb=Verb,</span>
<span class="sd">                         arrayorder=str(Out[&#39;arrayorder&#39;]), Clock=bool(Out[&#39;Clock&#39;]))</span>
<span class="sd">        obj = _resetDetectAttr(obj, {&#39;LOSprops&#39;:LOSprops, &#39;Sino&#39;:Sino, &#39;Span&#39;:Span, &#39;Cone&#39;:Cone, &#39;SAng&#39;:SAng, &#39;SynthDiag&#39;:SynthDiag, &#39;Res&#39;:Res, &#39;Optics&#39;:Opt})</span>
<span class="sd">        obj._LOS_NP = Out[&#39;LOSNP&#39;]</span>
<span class="sd">        if obj._SynthDiag_Done and obj._SynthDiag_Points is None:</span>
<span class="sd">            obj.set_SigPrecomp()</span>

<span class="sd">    elif Id.Cls == &#39;GDetect&#39;:</span>
<span class="sd">        LDetsave = list(Out[&#39;LDetsave&#39;])</span>
<span class="sd">        LDet = []</span>
<span class="sd">        Ves = _tryloadVes(Id, Ves=Ves)</span>
<span class="sd">        if out==&#39;light&#39;:</span>
<span class="sd">            SynthDiag, Res = _get_light_SynthDiag_Res()</span>
<span class="sd">        else:</span>
<span class="sd">            LDetSynthRes = Out[&#39;LDetSynthRes&#39;]</span>
<span class="sd">        for ii in range(0,len(LDetsave)):</span>
<span class="sd">            ddIdsave = _Id_recreateFromdict(LDetsave[ii][&#39;Idsave&#39;])</span>
<span class="sd">            if &#39;VesCalc&#39;in LDetsave[ii].keys() and LDetsave[ii][&#39;VesCalc&#39;][0][&#39;SavePath&#39;] is not None:</span>
<span class="sd">                VesCalc = Open(LDetsave[ii][&#39;VesCalc&#39;][0][&#39;SavePath&#39;]+LDetsave[ii][&#39;VesCalc&#39;][0][&#39;SaveName&#39;]+&#39;.npz&#39;)</span>
<span class="sd">            else:</span>
<span class="sd">                VesCalc = None</span>
<span class="sd">            LOSprops, Sino, Span, Cone, SAng, Opt = LDetsave[ii][&#39;LOSprops&#39;][0], LDetsave[ii][&#39;Sino&#39;][0], LDetsave[ii][&#39;Span&#39;][0], LDetsave[ii][&#39;Cone&#39;][0], LDetsave[ii][&#39;SAng&#39;][0], LDetsave[ii][&#39;Optics&#39;][0]</span>
<span class="sd">            if out==&#39;full&#39;:</span>
<span class="sd">                SynthDiag, Res = LDetSynthRes[ii][&#39;SynthDiag&#39;][0], LDetSynthRes[ii][&#39;Res&#39;][0]</span>
<span class="sd">            Optics = _tryLoadOpticsElseCreate(ddIdsave, Opt=Opt, Ves=Ves, Verb=Verb)</span>
<span class="sd">            Poly = LDetsave[ii][&#39;Poly&#39;] if type(Optics) is list else dict(Rad=float(LDetsave[ii][&#39;Rad&#39;]),O=LDetsave[ii][&#39;BaryS&#39;],nIn=LDetsave[ii][&#39;nIn&#39;])</span>
<span class="sd">            Sino_RefPt = None if Out[&#39;Sino_RefPt&#39;].shape==() else Out[&#39;Sino_RefPt&#39;]</span>
<span class="sd">            dd = TFG.Detect(ddIdsave, Poly, Optics=Optics, Ves=Ves, VesCalc=VesCalc, Sino_RefPt=Sino_RefPt, CalcEtend=False, CalcSpanImp=False, CalcCone=False, CalcPreComp=False, Calc=True, Verb=Verb,</span>
<span class="sd">                            arrayorder=str(Out[&#39;arrayorder&#39;]), Clock=bool(Out[&#39;Clock&#39;]))</span>
<span class="sd">            dd = _resetDetectAttr(dd, {&#39;LOSprops&#39;:LOSprops, &#39;Sino&#39;:Sino, &#39;Span&#39;:Span, &#39;Cone&#39;:Cone, &#39;SAng&#39;:SAng, &#39;SynthDiag&#39;:SynthDiag, &#39;Res&#39;:Res, &#39;Optics&#39;:Opt})</span>
<span class="sd">            dd._LOS_NP = LDetsave[ii][&#39;LOSNP&#39;]</span>
<span class="sd">            if dd._SynthDiag_Done and dd._SynthDiag_Points is None:</span>
<span class="sd">                dd.set_SigPrecomp()</span>
<span class="sd">            LDet.append(dd)</span>
<span class="sd">        obj = TFG.GDetect(Id, LDet, Type=Id.Type, Exp=Id.Exp, Diag=Id.Diag, shot=Id.shot, dtime=Id.dtime, Sino_RefPt=Out[&#39;Sino_RefPt&#39;], LOSRef=str(Out[&#39;LOSRef&#39;]),</span>
<span class="sd">                          arrayorder=str(Out[&#39;arrayorder&#39;]), Clock=bool(Out[&#39;Clock&#39;]), SavePath=Id.SavePath)</span>
<span class="sd">        Res = Out[&#39;Res&#39;][0] if out==&#39;full&#39; else Res</span>
<span class="sd">        for kk in Res.keys():</span>
<span class="sd">            setattr(obj,kk,Res[kk])</span>

<span class="sd">    elif Id.Cls==&#39;Eq2D&#39;:</span>
<span class="sd">        Sep = [np.array(ss) for ss in Out[&#39;Sep&#39;].tolist()]</span>
<span class="sd">        obj = tfEq.Eq2D(Id, Out[&#39;PtsCross&#39;], t=Out[&#39;t&#39;], MagAx=Out[&#39;MagAx&#39;], Sep=Sep, rho_p=Out[&#39;rho_p&#39;].tolist(), rho_t=Out[&#39;rho_t&#39;].tolist(), surf=Out[&#39;surf&#39;].tolist(), vol=Out[&#39;vol&#39;].tolist(),</span>
<span class="sd">                        q=Out[&#39;q&#39;].tolist(), jp=Out[&#39;jp&#39;].tolist(), pf=Out[&#39;pf&#39;].tolist(), tf=Out[&#39;tf&#39;].tolist(), theta=Out[&#39;theta&#39;].tolist(), thetastar=Out[&#39;thetastar&#39;].tolist(),</span>
<span class="sd">                        BTX=Out[&#39;BTX&#39;].tolist(), BRY=Out[&#39;BRY&#39;].tolist(), BZ=Out[&#39;BZ&#39;].tolist(), Ref=str(Out[&#39;Ref&#39;]))</span>

<span class="sd">    elif Id.Cls==&#39;Mesh1D&#39;:</span>
<span class="sd">        obj = TFM.Mesh1D(Id, Out[&#39;Knots&#39;])</span>

<span class="sd">    elif Id.Cls==&#39;Mesh2D&#39;:</span>
<span class="sd">        obj = TFM.Mesh2D(Id, [Out[&#39;Knots&#39;][0],Out[&#39;Knots&#39;][1]])</span>
<span class="sd">        obj = TFM.Mesh2D(Id, Knots=obj, ind=Out[&#39;IndBg&#39;])</span>
<span class="sd">        for ii in range(0,len(Out[&#39;SubMinds&#39;])):</span>
<span class="sd">            obj.add_SubMesh(Name=Out[&#39;SubMinds&#39;][ii][&#39;Name&#39;], ind=Out[&#39;SubMinds&#39;][ii][&#39;ind&#39;])</span>

<span class="sd">    elif Id.Cls==&#39;Metric1D&#39;:</span>
<span class="sd">        obj = TFM.Metric1D(Id)</span>

<span class="sd">    elif Id.Cls==&#39;Metric2D&#39;:</span>
<span class="sd">        obj = TFM.Metric2D(Id)</span>


<span class="sd">    elif Id.Cls in &#39;BF2D&#39;:</span>
<span class="sd">        IdMesh = ID(str(Out[&#39;IdMesh&#39;][0]), str(Out[&#39;IdMesh&#39;][1]), SaveName=str(Out[&#39;IdMesh&#39;][2]), SavePath=str(Out[&#39;IdMesh&#39;][3]), dtime=Out[&#39;dtimeMesh&#39;][0], dtFormat=str(Out[&#39;IdMesh&#39;][4]))</span>
<span class="sd">        M2 = TFM.Mesh2D(IdMesh, Knots=[Out[&#39;KnotsR&#39;],Out[&#39;KnotsZ&#39;]])</span>
<span class="sd">        M2bis = TFM.Mesh2D(IdMesh,Knots=M2,Ind=Out[&#39;Ind&#39;])</span>
<span class="sd">        obj = TFM.BF2D(Id, M2bis, int(Out[&#39;Deg&#39;][0]))</span>
<span class="sd">    elif Id.Cls==&#39;GMat2D&#39;:</span>
<span class="sd">        import ToFu_MatComp as TFMC</span>
<span class="sd">        import scipy.sparse as scpsp</span>
<span class="sd">        Id.set_LObj(open_np_IdObj([&#39;Ves&#39;,&#39;BF2D&#39;,&#39;Detect&#39;], [Out[&#39;Ves&#39;],Out[&#39;BF2&#39;],Out[&#39;LDetect&#39;]], [Out[&#39;VesUSR&#39;],Out[&#39;BF2USR&#39;],Out[&#39;LDetectUSR&#39;]]))</span>
<span class="sd">        Mat = scpsp.csr_matrix((Out[&#39;Matdata&#39;], Out[&#39;Matind&#39;], Out[&#39;Matindpr&#39;]), shape=Out[&#39;Matshape&#39;])</span>
<span class="sd">        MatLOS = scpsp.csr_matrix((Out[&#39;MatLOSdata&#39;], Out[&#39;MatLOSind&#39;], Out[&#39;MatLOSindpr&#39;]), shape=Out[&#39;MatLOSshape&#39;])</span>
<span class="sd">        obj = TFMC.GMat2D(Id, None, None, Mat=None, indMat=None, MatLOS=None, Calcind=False, Calc=False, CalcLOS=False)</span>
<span class="sd">        obj._init_CompParam(Mode=str(Out[&#39;CompParamStr&#39;][0]), epsrel=Out[&#39;CompParamVal&#39;][0], SubP=Out[&#39;CompParamVal&#39;][1], SubMode=str(Out[&#39;CompParamStr&#39;][1]), SubTheta=Out[&#39;CompParamVal&#39;][2], SubThetaMode=str(Out[&#39;CompParamStr&#39;][2]), Fast=bool(Out[&#39;CompParamVal&#39;][-1]), SubPind=Out[&#39;CompParamVal&#39;][3], ModeLOS=str(Out[&#39;CompParamStr&#39;][3]), epsrelLOS=Out[&#39;CompParamVal&#39;][4], SubPLOS=Out[&#39;CompParamVal&#39;][5], SubModeLOS=str(Out[&#39;CompParamStr&#39;][4]))</span>
<span class="sd">        obj._BF2 = None</span>
<span class="sd">        obj._BF2_Deg = int(Out[&#39;BF2Par&#39;][0])</span>
<span class="sd">        obj._BF2_NCents = int(Out[&#39;BF2Par&#39;][2])</span>
<span class="sd">        obj._BF2_NFunc = int(Out[&#39;BF2Par&#39;][1])</span>
<span class="sd">        obj._Ves = None</span>
<span class="sd">        obj._LD = None</span>
<span class="sd">        obj._LD_nDetect = int(Out[&#39;LD_nD&#39;])</span>
<span class="sd">        obj._set_indMat(indMat=Out[&#39;indMat&#39;], Verb=False)</span>
<span class="sd">        obj._set_MatLOS(MatLOS=MatLOS, Verb=False)</span>
<span class="sd">        obj._set_Mat(Mat=Mat, Verb=False)</span>



<span class="sd">    elif Id.Cls==&#39;PreData&#39;:</span>
<span class="sd">        LIdDet = Id.get_LObjasLId(&#39;Detect&#39;) if &#39;Detect&#39; in Id.LObj.keys() else None</span>
<span class="sd">        Init, Update = Out[&#39;Init&#39;][0], Out[&#39;Update&#39;][0]</span>
<span class="sd">        obj = tft.PreData(Init[&#39;data&#39;], Id=Id, t=Init[&#39;t&#39;], Chans=Init[&#39;Chans&#39;], DtRef=Init[&#39;DtRef&#39;], LIdDet=LIdDet)</span>
<span class="sd">        obj.set_Dt(Update[&#39;Dt&#39;], Calc=False)</span>
<span class="sd">        obj.set_Resamp(t=Update[&#39;Resamp_t&#39;], f=Update[&#39;Resamp_f&#39;], Method=Update[&#39;Resamp_Method&#39;], interpkind=Update[&#39;Resamp_interpkind&#39;], Calc=False)</span>
<span class="sd">        obj.Out_add(indOut=Update[&#39;indOut&#39;], Calc=False)</span>
<span class="sd">        obj.Corr_add(indCorr=Update[&#39;indCorr&#39;], Calc=False)</span>
<span class="sd">        obj.interp(lt=Update[&#39;interp_lt&#39;], lNames=Update[&#39;interp_lNames&#39;], Calc=False)</span>
<span class="sd">        obj.substract_Dt(tsub=Update[&#39;Subtract_tsub&#39;], Calc=False)</span>
<span class="sd">        obj.set_fft(Calc=True, **Update[&#39;FFTPar&#39;])</span>
<span class="sd">        if not Update[&#39;PhysNoiseParam&#39;] is None:</span>
<span class="sd">            Method = &#39;svd&#39; if &#39;Modes&#39; in Update[&#39;PhysNoiseParam&#39;].keys() else &#39;fft&#39;</span>
<span class="sd">            obj.set_PhysNoise(**Update[&#39;PhysNoiseParam&#39;].update({&#39;Method&#39;:Method}))</span>


<span class="sd">        #Id.set_LObj(open_np_IdObj([&#39;Detect&#39;],[Out[&#39;LDetect&#39;]], [Out[&#39;LDetectUSR&#39;]]))</span>
<span class="sd">        #obj = TFT.PreData(Id=Id, shot=int(Out[&#39;shot&#39;]), DLPar=Out[&#39;DLPar&#39;].item(), Exp=str(Out[&#39;StrPar&#39;][0]), Dt=list(Out[&#39;Dt&#39;]), DtMargin=float(Out[&#39;DtMarg&#39;]), MovMeanfreq=float(Out[&#39;MovMeanfreq&#39;]), Resamp=bool(Out[&#39;Resamp&#39;]),</span>
<span class="sd">        #        interpkind=str(Out[&#39;StrPar&#39;][1]), indOut=Out[&#39;indOut&#39;], indCorr=Out[&#39;indCorr&#39;], lt=Out[&#39;interp_lt&#39;], lNames=Out[&#39;interp_lN&#39;].tolist(), Test=True)</span>
<span class="sd">        #if not Out[&#39;PhysNoise&#39;].item() is None:</span>
<span class="sd">        #    obj.set_PhysNoise(Deg=int(Out[&#39;NoiseMod&#39;].item()[&#39;Deg&#39;]), Nbin=int(Out[&#39;NoiseMod&#39;].item()[&#39;Nbin&#39;]), LimRatio=float(Out[&#39;NoiseMod&#39;].item()[&#39;LimRatio&#39;]), **Out[&#39;PhysNoise&#39;].item()[&#39;Param&#39;])</span>


<span class="sd">    elif Id.Cls==&#39;Sol2D&#39;:</span>
<span class="sd">        Id.set_LObj(open_np_IdObj([&#39;PreData&#39;,&#39;GMat2D&#39;,&#39;BF2D&#39;],[Out[&#39;PreData&#39;], Out[&#39;GMat2D&#39;], Out[&#39;BF2D&#39;]], [Out[&#39;PreDataUSR&#39;],Out[&#39;GMatUSR&#39;],Out[&#39;BF2DUSR&#39;]]))</span>
<span class="sd">        GMSaveName = Id.LObj[&#39;GMat2D&#39;][&#39;SaveName&#39;][0]</span>
<span class="sd">        try:</span>
<span class="sd">            GMat = Open(Id.LObj[&#39;GMat2D&#39;][&#39;SavePath&#39;][0]+GMSaveName+&#39;.npz&#39;)</span>
<span class="sd">        except Exception:</span>
<span class="sd">            GMSaveName = GMSaveName[:GMSaveName.index(&#39;All_&#39;)+4]+&#39;sh&#39;+GMSaveName[GMSaveName.index(&#39;All_&#39;)+4:]</span>
<span class="sd">            GMat = Open(Id.LObj[&#39;GMat2D&#39;][&#39;SavePath&#39;][0]+GMSaveName+&#39;.npz&#39;)</span>
<span class="sd">        obj = TFI.Sol2D(Id, PreData=None, GMat=GMat, InvParam=Out[&#39;InvParam&#39;].item(), SVesePreData=False, SVeseGMat=True, SVeseBF=True)</span>
<span class="sd">        obj._PreData = None</span>
<span class="sd">        obj._GMat = obj.GMat.get_SubGMat2D(Val=list(Out[&#39;LNames&#39;]), Crit=&#39;Name&#39;,InOut=&#39;In&#39;)</span>
<span class="sd">        obj._shot = int(Out[&#39;shot&#39;])</span>
<span class="sd">        try:</span>
<span class="sd">            obj._LNames = Out[&#39;LNames&#39;].tolist()</span>
<span class="sd">        except Exception:</span>
<span class="sd">            obj._LNames = obj.PreData.In_list()</span>
<span class="sd">        obj._run = bool(Out[&#39;Run&#39;])</span>
<span class="sd">        if bool(Out[&#39;Run&#39;]):</span>
<span class="sd">            obj._LOS = bool(Out[&#39;LOS&#39;])</span>
<span class="sd">            obj._t, obj._data = Out[&#39;t&#39;], Out[&#39;data&#39;]</span>
<span class="sd">            obj._Coefs, obj._sigma = Out[&#39;Coefs&#39;], Out[&#39;sigma&#39;]</span>
<span class="sd">            obj._Mu, obj._Chi2N, obj._R, obj._Nit = Out[&#39;Mu&#39;], Out[&#39;Chi2N&#39;], Out[&#39;R&#39;], Out[&#39;Nit&#39;]</span>
<span class="sd">            obj._Spec = list(Out[&#39;Spec&#39;])</span>
<span class="sd">            obj._timing = Out[&#39;t2&#39;]</span>
<span class="sd">            obj._PostTreat = list(Out[&#39;PostTreat&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">obj</span>




</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2016-2021, Tofu contributors.<br/>
      Last updated on Nov 15, 2021.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>